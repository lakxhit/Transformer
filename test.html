<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dry Type Transformer</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prop-types/15.8.1/prop-types.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.2/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @media print {
      body * {
        visibility: hidden;
      }
      #report-section, #report-section * {
        visibility: visible;
      }
      #report-section {
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
        padding: 20px;
      }
      #report-section .print-button {
        display: none;
      }
      .page-break { page-break-before: always; break-before: page; }
    }
    @media (max-width: 640px) {
      .logo-header {
        flex-direction: column;
        align-items: center;
        text-align: center;
      }
      .logo-header img {
        margin-right: 0;
        margin-bottom: 1rem;
      }
    }
  </style>
</head>
<body className="bg-gray-100">
  <div id="root"></div>

  <script type="text/babel">
    // MultiSelectComboBox Component
    function MultiSelectComboBox({ options, value, onChange, placeholder }) {
      const [open, setOpen] = React.useState(false);
      const [inputValue, setInputValue] = React.useState('');
      const containerRef = React.useRef(null);

      // SAFETY CHECK: Ensure value is always an array
      const safeValue = Array.isArray(value) ? value : [];

      React.useEffect(() => {
        function handleClickOutside(event) {
          if (containerRef.current && !containerRef.current.contains(event.target)) {
            setOpen(false);
          }
        }
        if (open) {
          document.addEventListener('mousedown', handleClickOutside);
        } else {
          document.removeEventListener('mousedown', handleClickOutside);
        }
        return () => {
          document.removeEventListener('mousedown', handleClickOutside);
        };
      }, [open]);

      const handleSelect = (option) => {
        if (!safeValue.includes(option)) {
          onChange([...safeValue, option]);
        }
        setInputValue('');
        setOpen(false);
      };

      const handleRemove = (option) => {
        onChange(safeValue.filter(v => v !== option));
      };

      const handleInputChange = (e) => {
        setInputValue(e.target.value);
        setOpen(true);
      };

      const handleInputKeyDown = (e) => {
        if ((e.key === 'Enter' || e.key === ',') && inputValue.trim()) {
          e.preventDefault();
          if (!safeValue.includes(inputValue.trim())) {
            onChange([...safeValue, inputValue.trim()]);
          }
          setInputValue('');
          setOpen(false);
        } else if (e.key === 'Backspace' && !inputValue && safeValue.length > 0) {
          onChange(safeValue.slice(0, -1));
        }
      };

      const handleBlur = () => {
        if (inputValue.trim() && !safeValue.includes(inputValue.trim())) {
          onChange([...safeValue, inputValue.trim()]);
          setInputValue('');
        }
        setOpen(false);
      };

      return (
        <div className="relative" ref={containerRef}>
          <div className="flex flex-wrap gap-1 items-center border rounded p-1 bg-white focus-within:ring-2 focus-within:ring-blue-500">
            {safeValue.map((v, idx) => (
              <span key={idx} className="bg-blue-100 text-blue-800 px-2 py-0.5 rounded flex items-center text-xs">
                {v}
                <button 
                  type="button" 
                  className="ml-1 text-blue-500 hover:text-red-500" 
                  onClick={() => handleRemove(v)}
                >
                  &times;
                </button>
              </span>
            ))}
            <input
              type="text"
              className="flex-1 min-w-[80px] p-1 outline-none"
              value={inputValue}
              onChange={handleInputChange}
              onKeyDown={handleInputKeyDown}
              onBlur={handleBlur}
              placeholder={placeholder}
              onFocus={() => setOpen(true)}
              autoComplete="off"
            />
          </div>
          {open && options.length > 0 && (
            <div className="absolute z-10 bg-white border rounded shadow w-full max-h-48 overflow-y-auto mt-1">
              {options
                .filter(opt => opt.toLowerCase().includes(inputValue.toLowerCase()) && !safeValue.includes(opt))
                .map((option) => (
                  <div
                    key={option}
                    className="px-2 py-1 hover:bg-blue-50 cursor-pointer"
                    onMouseDown={() => handleSelect(option)}
                  >
                    {option}
                  </div>
                ))}
            </div>
          )}
        </div>
      );
    }

    const insulationLevels = {
      1.1: {
        hvPowerFreq: 3, hvInduced: "Twice to Rated Voltage", hvImpulse: "NA",
        lvPowerFreq: 3, lvInduced: "Twice to Rated Voltage", lvImpulse: "NA"
      },
      3.6: {
        hvPowerFreq: 10, hvInduced: "Twice to Rated Voltage", hvImpulse: 20,
        lvPowerFreq: 10, lvInduced: "Twice to Rated Voltage", lvImpulse: 20
      },
      6.6: {
        hvPowerFreq: 20, hvInduced: "Twice to Rated Voltage", hvImpulse: 60,
        lvPowerFreq: 20, lvInduced: "Twice to Rated Voltage", lvImpulse: 60
      },
      11: {
        hvPowerFreq: 28, hvInduced: "Twice to Rated Voltage", hvImpulse: 75,
        lvPowerFreq: 28, lvInduced: "Twice to Rated Voltage", lvImpulse: 75
      },
      15: {
        hvPowerFreq: 38, hvInduced: "Twice to Rated Voltage", hvImpulse: 95,
        lvPowerFreq: 38, lvInduced: "Twice to Rated Voltage", lvImpulse: 95
      },
      22: {
        hvPowerFreq: 50, hvInduced: "Twice to Rated Voltage", hvImpulse: 125,
        lvPowerFreq: 50, lvInduced: "Twice to Rated Voltage", lvImpulse: 125
      },
      33: {
        hvPowerFreq: 70, hvInduced: "Twice to Rated Voltage", hvImpulse: 170,
        lvPowerFreq: 70, lvInduced: "Twice to Rated Voltage", lvImpulse: 170
      },
      66: {
        hvPowerFreq: 140, hvInduced: "Twice to Rated Voltage", hvImpulse: 325,
        lvPowerFreq: 140, lvInduced: "Twice to Rated Voltage", lvImpulse: 325
      },
      110: {
        hvPowerFreq: 185, hvInduced: "Twice to Rated Voltage", hvImpulse: 450,
        lvPowerFreq: 185, lvInduced: "Twice to Rated Voltage", lvImpulse: 450
      },
      132: {
        hvPowerFreq: 230, hvInduced: "Twice to Rated Voltage", hvImpulse: 550,
        lvPowerFreq: 230, lvInduced: "Twice to Rated Voltage", lvImpulse: 550
      },
      220: {
        hvPowerFreq: 395, hvInduced: "Twice to Rated Voltage", hvImpulse: 950,
        lvPowerFreq: 395, lvInduced: "Twice to Rated Voltage", lvImpulse: 950
      },
      400: {
        hvPowerFreq: 570, hvInduced: "Twice to Rated Voltage", hvImpulse: 1300,
        lvPowerFreq: 570, lvInduced: "Twice to Rated Voltage", lvImpulse: 1300
      },
      420.1: {
        hvPowerFreq: 630, hvInduced: "Twice to Rated Voltage", hvImpulse: 1425,
        lvPowerFreq: 630, lvInduced: "Twice to Rated Voltage", lvImpulse: 1425
      }
    };

    const minimumClearances = {
      0: { phaseToPhase: 25, phaseToEarth: 20 },
      1.1: { phaseToPhase: 30, phaseToEarth: 25 },
      3.6: { phaseToPhase: 75, phaseToEarth: 60 },
      7.2: { phaseToPhase: 120, phaseToEarth: 90 },
      12: { phaseToPhase: 280, phaseToEarth: 140 },
      24: { phaseToPhase: 330, phaseToEarth: 230 },
      36: { phaseToPhase: 350, phaseToEarth: 320 },
      52: { phaseToPhase: 530, phaseToEarth: 480 },
      72.5: { phaseToPhase: 700, phaseToEarth: 660 },
      145: {
        default: { phaseToPhase: 1220, phaseToEarth: 1050 },
        550: { phaseToPhase: 1220, phaseToEarth: 1050 },
        650: { phaseToPhase: 1430, phaseToEarth: 1270 }
      },
      245: {
        default: { phaseToPhase: 2000, phaseToEarth: 1800 },
        950: { phaseToPhase: 2000, phaseToEarth: 1800 },
        1050: { phaseToPhase: 2350, phaseToEarth: 2150 }
      },
      420: { phaseToPhase: 4000, phaseToEarth: 3500 },
      800: { phaseToPhase: 6700, phaseToEarth: 5800 }
    };

    const cableBoxClearances = {
      0: { phaseToPhase: 25, phaseToEarth: 20 },
      1.1: { phaseToPhase: 25, phaseToEarth: 20 },
      3.6: { phaseToPhase: 50, phaseToEarth: 50 },
      7.2: { phaseToPhase: 90, phaseToEarth: 70 },
      12: { phaseToPhase: 130, phaseToEarth: 80 },
      24: { phaseToPhase: 241, phaseToEarth: 140 },
      36: { phaseToPhase: 351, phaseToEarth: 222 },
    };

    function App() {
      const allStandardFittings = [
        'Rating & Diagram Plate:',
        'Earthing Terminals: ',
        'Lifting Lugs: ',
        'Jacking Pads: ',
        'Thermometer Pocket: ',
        'Under Base Skids with Flat Rollers: ',
        'Stem Type Thermometer: ',
        'Winding Temperature Indicator with WTI CT: ',
        'Marshalling Box: ',
        'Neutral Bushing: '
      ];

      const [formData, setFormData] = React.useState({
        manufacturer: 'Mahati Industries Pvt. Ltd',
        customer: '',
        application: '',
        annexureNumber: 'I',
        numberOfTransformers: '',
        referenceStandards: [],  
        service: [],  
        kva: '',
        kvaList: [],
        hvVoltage: '',
        lvVoltage: '',
        frequency: [],  
        phases: [],  
        hvConnection: [],  
        lvConnection: [],  
        vectorGroup: [],  
        tapChangerType: [],  
        tapChangerMake: '',
        tappingRange: [],  
        tapSteps: [],  
        coolingType: [],
        windingTemp: '',
        impedanceVoltage: '',
        insulationClass: [],  
        windingMaterial: [],  
        hvTerminal: [],
        lvTerminal: [],
        paint: [],
        hvCurrent: '',
        lvCurrent: '',
        noLoadLosses: '',
        loadLosses: '',
        maxLosses50: '',
        maxLosses100: '',
        hvPowerFreq: '',
        lvPowerFreq: '',
        hvInduced: '',
        lvInduced: '',
        hvImpulse: '',
        lvImpulse: '',
        efficiency100: '',
        efficiency75: '',
        efficiency50: '',
        efficiency100_08pf: '',
        efficiency75_08pf: '',
        efficiency50_08pf: '',
        length: '',
        width: '',
        height: '',
        coreWindingsWeight: '',
        tankFittingsWeight: '',
        totalWeight: '',
        ambient: '',
        reactance: '',
        resistance: '',
        enclosureProtection: 'IP 32',
        altitude: '≤ 1000 mtrs',
        noiseLevel: 'As per NEMA Tr-1',
        overloading: 'As per IS 2026-7'
      });
      const [registerOutput, setRegisterOutput] = React.useState('');
      const [showAdditionalDetails, setShowAdditionalDetails] = React.useState(false);
      const [showAdditionalFittings, setShowAdditionalFittings] = React.useState(false);
      const [newFitting, setNewFitting] = React.useState('');
      const [newFittingQty, setNewFittingQty] = React.useState(1);
      const [report, setReport] = React.useState(null);
      const [error, setError] = React.useState('');
      const [kvaInput, setKvaInput] = React.useState('');
      const [selectedHvBil, setSelectedHvBil] = React.useState(null);
      const [selectedLvBil, setSelectedLvBil] = React.useState(null);
      const [fittingQuantities, setFittingQuantities] = React.useState(() => {
        const obj = {};
        allStandardFittings.forEach(f => { obj[f] = 1; });
        return obj;
      });
      const [additionalFittings, setAdditionalFittings] = React.useState([]);
      const [errors, setErrors] = React.useState({});
      const [terminalFittings, setTerminalFittings] = React.useState([]);
      const [terminalFittingQuantities, setTerminalFittingQuantities] = React.useState({});
      const [editFittings, setEditFittings] = React.useState(false);
      const [selectedFittings, setSelectedFittings] = React.useState(allStandardFittings);

      const bilOptionsTable = {
        110: [
          { impulse: 450, freq: 185 },
          { impulse: 550, freq: 230 }
        ],
        132: [
          { impulse: 550, freq: 230 },
          { impulse: 650, freq: 275 }
        ],
        220: [
          { impulse: 950, freq: 395 },
          { impulse: 1050, freq: 460 }
        ],
        400: [
          { impulse: 1300, freq: 570 },
          { impulse: 1425, freq: 630 }
        ]
      };

      function getFloorBILChoices(voltage) {
        if (isNaN(voltage) || voltage < 110) return null;
        const keys = Object.keys(bilOptionsTable).map(Number).sort((a, b) => a - b);
        let floor = keys[0];
        for (let i = 0; i < keys.length; i++) {
          if (keys[i] <= voltage) floor = keys[i];
        }
        return bilOptionsTable[floor];
      }

      const handleInputChange = (e) => {
        const { name, value } = e.target;
        setFormData((prev) => ({ ...prev, [name]: value }));

        setErrors(prevErrors => {
          const newErrors = { ...prevErrors };
          if (name === 'ambient' && value && !isNaN(parseFloat(value)) && parseFloat(value) > 0) {
            delete newErrors.ambient;
          }
          if (name === 'windingTemp' && value && !isNaN(parseFloat(value)) && parseFloat(value) > 0) {
            delete newErrors.windingTemp;
          }
          if (name === 'kvaInput' && value && !isNaN(parseFloat(value)) && parseFloat(value) > 0) {
            delete newErrors.kva;
          }
          if (name === 'hvVoltage' && value && !isNaN(parseFloat(value)) && parseFloat(value) > 0) {
            delete newErrors.hvVoltage;
          }
          if (name === 'lvVoltage' && value && !isNaN(parseFloat(value)) && parseFloat(value) > 0) {
            delete newErrors.lvVoltage;
          }
          if (name === 'numberOfTransformers' && value && !isNaN(parseFloat(value)) && parseFloat(value) > 0) {
            delete newErrors.numberOfTransformers;
          }
          if (name === 'manufacturer' && value) {
            delete newErrors.manufacturer;
          }
          if (name === 'impedanceVoltage' && value) {
            delete newErrors.impedanceVoltage;
          }
          return newErrors;
        });
      };

      const handleCheckboxChange = (e) => {
        setShowAdditionalDetails(e.target.checked);
        if (!e.target.checked) {
          setFormData(prev => ({
            ...prev,
            length: '',
            width: '',
            height: '',
            coreWindingsWeight: '',
            tankFittingsWeight: '',
            totalWeight: ''
          }));
        }
      };

      const handleAddFitting = () => {
        if (newFitting.trim()) {
          setAdditionalFittings(prev => [...prev, { desc: newFitting.trim(), qty: newFittingQty }]);
          setNewFitting('');
          setNewFittingQty(1);
        }
      };

      const handleRemoveFitting = (index) => {
        setAdditionalFittings(prev => prev.filter((_, i) => i !== index));
      };

      const handleAddKva = () => {
        const value = parseFloat(kvaInput);
        if (!isNaN(value) && value > 0 && !formData.kvaList.includes(value)) {
          setFormData(prev => ({
            ...prev,
            kvaList: [...prev.kvaList, value].sort((a, b) => a - b),
            kva: ''
          }));
          setKvaInput('');
          setErrors(prevErrors => {
            const newErrors = { ...prevErrors };
            if ([...formData.kvaList, value].length > 0) {
              delete newErrors.kva;
            }
            return newErrors;
          });
        }
      };

      const handleRemoveKva = (value) => {
        setFormData(prev => ({
          ...prev,
          kvaList: prev.kvaList.filter(kva => kva !== value)
        }));
      };

      const calculateRegulation = (loadPercentage, powerFactor) => {
        const kva = formData.kvaList.length > 0 ? Math.max(...formData.kvaList) : parseFloat(formData.kva);
        const impedanceVoltage = parseFloat(formData.impedanceVoltage);
        let loadLossesKw = parseFloat(formData.loadLosses) / 1000;

        if (!kva || !impedanceVoltage || !loadLossesKw) {
          return 'N/A';
        }

        const resistance = (loadLossesKw * 100) / kva;
        const valInsideSqrt = Math.pow(impedanceVoltage, 2) - Math.pow(resistance, 2);
        const reactance = Math.sqrt(Math.max(0, valInsideSqrt));

        const n = loadPercentage / 100;
        const theta = Math.acos(powerFactor);
        const cosTheta = Math.cos(theta);
        const sinTheta = Math.sin(theta);

        const firstPart = n * ((resistance * cosTheta) + (reactance * sinTheta));
        const secondPartNumerator = Math.pow((n * reactance * cosTheta) - (n * resistance * sinTheta), 2);
        const secondPart = secondPartNumerator / 200;

        const regulation = firstPart + secondPart;
        return regulation.toFixed(2);
      };

      const calculateParameters = () => {
        const newErrors = {};
        if (!formData.manufacturer) newErrors.manufacturer = 'Please enter a manufacturer name.';
        if (!formData.numberOfTransformers || isNaN(parseFloat(formData.numberOfTransformers)) || parseFloat(formData.numberOfTransformers) <= 0) {
          newErrors.numberOfTransformers = 'Please enter a valid number of transformers (> 0).';
        }
        if ((!formData.kva || isNaN(parseFloat(formData.kva)) || parseFloat(formData.kva) <= 0) && formData.kvaList.length === 0) {
          newErrors.kva = 'Please enter a valid kVA rating (> 0) or add kVA values to the list.';
        }
        if (!formData.hvVoltage || isNaN(parseFloat(formData.hvVoltage)) || parseFloat(formData.hvVoltage) <= 0) {
          newErrors.hvVoltage = 'Please enter a valid HV voltage (> 0).';
        }
        if (!formData.lvVoltage || isNaN(parseFloat(formData.lvVoltage)) || parseFloat(formData.lvVoltage) <= 0) {
          newErrors.lvVoltage = 'Please enter a valid LV voltage (> 0).';
        }
        if (!formData.windingTemp || isNaN(parseFloat(formData.windingTemp)) || parseFloat(formData.windingTemp) <= 0) {
          newErrors.windingTemp = 'Please enter a valid winding temperature rise (> 0).';
        }
        if (!formData.referenceStandards || formData.referenceStandards.length === 0) newErrors.referenceStandards = 'Please select at least one reference standard.';
        if (!formData.frequency || formData.frequency.length === 0) newErrors.frequency = 'Please select at least one frequency.';
        if (!formData.phases || formData.phases.length === 0) newErrors.phases = 'Please select at least one phase.';
        if (!formData.hvConnection || formData.hvConnection.length === 0) newErrors.hvConnection = 'Please select at least one HV connection.';
        if (!formData.lvConnection || formData.lvConnection.length === 0) newErrors.lvConnection = 'Please select at least one LV connection.';
        if (!formData.vectorGroup || formData.vectorGroup.length === 0) newErrors.vectorGroup = 'Please select at least one vector group.';
        if (!formData.tapChangerType || formData.tapChangerType.length === 0) newErrors.tapChangerType = 'Please select at least one tap changer type.';
        if (!formData.tappingRange || formData.tappingRange.length === 0) newErrors.tappingRange = 'Please select at least one tapping range.';
        if (!formData.tapSteps || formData.tapSteps.length === 0) newErrors.tapSteps = 'Please select at least one tap step.';
        if (!formData.windingMaterial || formData.windingMaterial.length === 0) newErrors.windingMaterial = 'Please select at least one winding material.';
        if (!formData.insulationClass || formData.insulationClass.length === 0) newErrors.insulationClass = 'Please select at least one insulation class.';
        if (!formData.service || formData.service.length === 0) newErrors.service = 'Please select at least one service type.';
        if (!formData.impedanceVoltage) newErrors.impedanceVoltage = 'Please enter an impedance voltage.';
        if (!formData.coolingType || formData.coolingType.length === 0) newErrors.coolingType = 'Please select at least one cooling type.';
        if (!formData.noLoadLosses || isNaN(parseFloat(formData.noLoadLosses)) || parseFloat(formData.noLoadLosses) < 0) {
          newErrors.noLoadLosses = 'Please enter a valid no load loss (≥ 0).';
        }
        if (!formData.loadLosses || isNaN(parseFloat(formData.loadLosses)) || parseFloat(formData.loadLosses) < 0) {
          newErrors.loadLosses = 'Please enter a valid load loss (≥ 0).';
        }
        if (showAdditionalDetails) {
          if (!formData.length || isNaN(parseFloat(formData.length)) || parseFloat(formData.length) <= 0) newErrors.length = 'Please enter a valid length (> 0).';
          if (!formData.width || isNaN(parseFloat(formData.width)) || parseFloat(formData.width) <= 0) newErrors.width = 'Please enter a valid width (> 0).';
          if (!formData.height || isNaN(parseFloat(formData.height)) || parseFloat(formData.height) <= 0) newErrors.height = 'Please enter a valid height (> 0).';
          if (!formData.coreWindingsWeight || isNaN(parseFloat(formData.coreWindingsWeight)) || parseFloat(formData.coreWindingsWeight) <= 0) newErrors.coreWindingsWeight = 'Please enter a valid core & windings weight (> 0).';
          if (!formData.tankFittingsWeight || isNaN(parseFloat(formData.tankFittingsWeight)) || parseFloat(formData.tankFittingsWeight) <= 0) newErrors.tankFittingsWeight = 'Please enter a valid tank & fittings weight (> 0).';
          if (!formData.totalWeight || isNaN(parseFloat(formData.totalWeight)) || parseFloat(formData.totalWeight) <= 0) newErrors.totalWeight = 'Please enter a valid total weight (> 0).';
        }

        if (Object.keys(newErrors).length > 0) {
          setErrors(newErrors);
          setError('Please fill in all required fields correctly.');
          return;
        }
        setErrors({});
        setError('');

        const kva = formData.kvaList.length > 0 ? Math.max(...formData.kvaList) : parseFloat(formData.kva);
        const hvVoltageKv = parseFloat(formData.hvVoltage);
        const lvVoltageKv = parseFloat(formData.lvVoltage);

        let phases = 3;
        if (formData.phases && formData.phases.length > 0) {
          const phaseStr = formData.phases[0];
          const phaseMatch = phaseStr.match(/\d+/);
          if (phaseMatch) {
            phases = parseInt(phaseMatch[0]);
          }
        }

        let hvCurrent, lvCurrent;
        if (phases === 3) {
          hvCurrent = kva / (Math.sqrt(3) * hvVoltageKv);
          lvCurrent = kva / (Math.sqrt(3) * lvVoltageKv);
        } else {
          hvCurrent = kva / hvVoltageKv;
          lvCurrent = kva / lvVoltageKv;
        }

        const totalLossAt50Kw = parseFloat(formData.noLoadLosses);
        const totalLossAt100Kw = parseFloat(formData.loadLosses);

        const loadLossesKw = (totalLossAt100Kw - totalLossAt50Kw) / 0.75;
        const noLoadLossesKw = totalLossAt100Kw - loadLossesKw;

        const maxLosses50 = totalLossAt50Kw.toFixed(2);
        const maxLosses100 = totalLossAt100Kw.toFixed(2);
        const totalLosses = totalLossAt100Kw;

        const calculateEfficiency = (loadPercentage, powerFactor = 1.0) => {
          const outputPowerKw = (kva * (loadPercentage / 100)) * powerFactor;
          const loadLossAtPercentage = loadLossesKw * Math.pow(loadPercentage / 100, 2);
          const totalLossesAtLoad = noLoadLossesKw + loadLossAtPercentage;
          if ((outputPowerKw + totalLossesAtLoad) === 0) return '0.00';
          const efficiency = (outputPowerKw / (outputPowerKw + totalLossesAtLoad)) * 100;
          return efficiency.toFixed(2);
        };

        const efficiency100 = calculateEfficiency(100, 1.0);
        const efficiency75 = calculateEfficiency(75, 1.0);
        const efficiency50 = calculateEfficiency(50, 1.0);
        const efficiency100_08pf = calculateEfficiency(100, 0.8);
        const efficiency75_08pf = calculateEfficiency(75, 0.8);
        const efficiency50_08pf = calculateEfficiency(50, 0.8);

        const voltages = Object.keys(insulationLevels).map(Number).sort((a, b) => a - b);
        const floorHvVoltage = voltages.reduce((prev, curr) => (curr <= hvVoltageKv ? curr : prev), voltages[0]);
        let insulation = insulationLevels[floorHvVoltage] || insulationLevels[1.1];

        let hvPowerFreq = insulation.hvPowerFreq;
        let hvImpulse = insulation.hvImpulse;
        if (selectedHvBil) {
          hvPowerFreq = selectedHvBil.freq;
          hvImpulse = selectedHvBil.impulse;
        }

        const hvInducedValue = insulation.hvInduced === "Twice to Rated Voltage" ? (2 * hvVoltageKv).toFixed(3) : insulation.hvInduced;

        let lvInsulation;
        if (lvVoltageKv < 1.1) {
          lvInsulation = insulationLevels[1.1];
        } else {
          const lvVoltages = Object.keys(insulationLevels).map(Number).sort((a, b) => a - b);
          const floorLvVoltage = lvVoltages.reduce((prev, curr) => (curr <= lvVoltageKv ? curr : prev), lvVoltages[0]);
          lvInsulation = insulationLevels[floorLvVoltage] || insulationLevels[1.1];
        }

        let lvPowerFreq = lvInsulation.lvPowerFreq;
        let lvImpulse = lvInsulation.lvImpulse;
        if (selectedLvBil) {
          lvPowerFreq = selectedLvBil.freq;
          lvImpulse = selectedLvBil.impulse;
        }

        const lvInducedValue = lvInsulation.lvInduced === "Twice to Rated Voltage" ? (2 * lvVoltageKv).toFixed(3) : lvInsulation.lvInduced;

        const resistance = (loadLossesKw / kva) * 100;
        const reactance = Math.sqrt(Math.max(0, Math.pow(formData.impedanceVoltage, 2) - Math.pow(resistance, 2)));

        setReport({
          ...formData,
          kvaList: formData.kvaList,
          hvCurrent: hvCurrent.toFixed(3),
          lvCurrent: lvCurrent.toFixed(2),
          noLoadLosses: noLoadLossesKw.toFixed(3),
          loadLosses: loadLossesKw.toFixed(3),
          maxLosses50: maxLosses50,
          maxLosses100: maxLosses100,
          hvPowerFreq: hvPowerFreq,
          totalLosses: totalLosses,
          lvPowerFreq: lvPowerFreq,
          hvInduced: hvInducedValue,
          lvInduced: lvInducedValue,
          hvImpulse: hvImpulse,
          lvImpulse: lvImpulse,
          efficiency100: efficiency100,
          efficiency75: efficiency75,
          efficiency50: efficiency50,
          efficiency100_08pf: efficiency100_08pf,
          efficiency75_08pf: efficiency75_08pf,
          efficiency50_08pf: efficiency50_08pf,
          length: showAdditionalDetails ? formData.length : 'N/A',
          width: showAdditionalDetails ? formData.width : 'N/A',
          height: showAdditionalDetails ? formData.height : 'N/A',
          coreWindingsWeight: showAdditionalDetails ? formData.coreWindingsWeight : 'N/A',
          tankFittingsWeight: showAdditionalDetails ? formData.tankFittingsWeight : 'N/A',
          totalWeight: showAdditionalDetails ? formData.totalWeight : 'N/A',
          reactance: reactance.toFixed(2),
          resistance: resistance.toFixed(2),
          regulationUnity: calculateRegulation(100, 1.0),
          regulation08: calculateRegulation(100, 0.8),
          selectedFittings,
          fittingQuantities,
          additionalFittings,
          terminalFittings,
          terminalFittingQuantities
        });
      };

      const handleHvTerminalChange = (option) => {
        setFormData(prev => {
          const currentHvTerminals = [...prev.hvTerminal];
          const index = currentHvTerminals.indexOf(option);
          if (index === -1) {
            currentHvTerminals.push(option);
          } else {
            currentHvTerminals.splice(index, 1);
          }
          setErrors(prevErrors => {
            const newErrors = { ...prevErrors };
            if (currentHvTerminals.length > 0) {
              delete newErrors.hvTerminal;
            }
            return newErrors;
          });
          return { ...prev, hvTerminal: currentHvTerminals };
        });
      };

      const handleLvTerminalChange = (option) => {
        setFormData(prev => {
          const currentLvTerminals = [...prev.lvTerminal];
          const index = currentLvTerminals.indexOf(option);
          if (index === -1) {
            currentLvTerminals.push(option);
          } else {
            currentLvTerminals.splice(index, 1);
          }
          setErrors(prevErrors => {
            const newErrors = { ...prevErrors };
            if (currentLvTerminals.length > 0) {
              delete newErrors.lvTerminal;
            }
            return newErrors;
          });
          return { ...prev, lvTerminal: currentLvTerminals };
        });
      };

      React.useEffect(() => {
        const prefixLookup = {
          hvTerminal: 'HV Terminal – ',
          lvTerminal: 'LV Terminal – ',
        };

        const buildLabels = (name, values = []) =>
          values.map(option => `${prefixLookup[name] || ''}${option}`);

        const updated = [
          ...buildLabels('hvTerminal', formData.hvTerminal),
          ...buildLabels('lvTerminal', formData.lvTerminal),
        ].filter(Boolean);

        setTerminalFittings(updated);

        setTerminalFittingQuantities(prev => {
          const newQtys = { ...prev };
          updated.forEach(fitting => {
            if (!newQtys[fitting]) {
              newQtys[fitting] = 1;
            }
          });
          Object.keys(newQtys).forEach(key => {
            if (!updated.includes(key)) {
              delete newQtys[key];
            }
          });
          return newQtys;
        });
      }, [formData.hvTerminal, formData.lvTerminal]);

      React.useEffect(() => {
        const extractNumber = (text) => {
          if (!text) return 0;
          const match = text.toString().match(/\d+(?:\.\d+)?/);
          return match ? parseFloat(match[0]) : 0;
        };

        const core = extractNumber(formData.coreWindingsWeight);
        const tank = extractNumber(formData.tankFittingsWeight);
        const total = core + tank;

        if (total > 0) {
          setFormData(prev => ({ ...prev, totalWeight: total.toFixed(2) }));
        } else {
          setFormData(prev => ({ ...prev, totalWeight: '' }));
        }
      }, [formData.coreWindingsWeight, formData.tankFittingsWeight]);

      const impedanceChart = [
        { kva: 250, impedance: 4.5 },
        { kva: 315, impedance: 4.5 },
        { kva: 400, impedance: 4.5 },
        { kva: 500, impedance: 4.5 },
        { kva: 630, impedance: 4.5 },
        { kva: 800, impedance: 5.0 },
        { kva: 1000, impedance: 5.0 },
        { kva: 1250, impedance: 5.0 },
        { kva: 1600, impedance: 6.25 },
        { kva: 2000, impedance: 6.25 },
        { kva: 2500, impedance: 6.25 }
      ];

      function getImpedanceForKva(kva) {
        if (!kva || isNaN(kva) || kva <= 0) return '';
        if (kva <= 630) return 4.5;
        if (kva <= 1250) return 5.0;
        return 6.25;
      }

      function getMinimumClearances(voltage, bil = null, terminalType = []) {
        if (!voltage || isNaN(voltage) || voltage <= 0) {
          return { phaseToPhase: 0, phaseToEarth: 0 };
        }

        const isCableBox = terminalType.includes('Cable Box');
        let clearancesTable = isCableBox ? cableBoxClearances : minimumClearances;

        const voltageKeys = Object.keys(clearancesTable).map(Number).sort((a, b) => a - b);

        let selectedVoltage = voltageKeys[0];
        for (let i = 0; i < voltageKeys.length; i++) {
          if (voltageKeys[i] <= voltage) {
            selectedVoltage = voltageKeys[i];
          } else {
            break;
          }
        }

        let clearanceData = clearancesTable[selectedVoltage];

        if (isCableBox && voltage > 36) {
          clearancesTable = minimumClearances;
          const voltageKeys = Object.keys(clearancesTable).map(Number).sort((a, b) => a - b);
          selectedVoltage = voltageKeys[0];
          for (let i = 0; i < voltageKeys.length; i++) {
            if (voltageKeys[i] <= voltage) {
              selectedVoltage = voltageKeys[i];
            } else {
              break;
            }
          }
          clearanceData = clearancesTable[selectedVoltage];
        }

        if (bil && clearanceData && typeof clearanceData === 'object' && clearanceData[bil]) {
          return clearanceData[bil];
        } else if (clearanceData && clearanceData.default) {
          return clearanceData.default;
        }

        return clearanceData;
      }

      function getTapChangerText(type) {
        if (!type) return '';
        if (type.includes('On Load Tap Changer')) return 'On Load Tap Changer with RTCC Panel & AVR: 1 No.';
        if (type.includes('Off Circuit tap changer')) return 'Off Circuit Tap Changer: 1 No.';
        return type;
      }

      React.useEffect(() => {
        const onLoadText = getTapChangerText('On Load Tap Changer');
        const offCircuitText = getTapChangerText('Off Circuit tap changer');
        setSelectedFittings(prev => prev.filter(f => f !== onLoadText && f !== offCircuitText));
        setFittingQuantities(prev => {
          const newQuantities = { ...prev };
          delete newQuantities[onLoadText];
          delete newQuantities[offCircuitText];
          return newQuantities;
        });
        if (formData.tapChangerType.length > 0) {
          const tapChangerText = getTapChangerText(formData.tapChangerType[0]);
          if (tapChangerText && !selectedFittings.includes(tapChangerText)) {
            setSelectedFittings(prev => [...prev, tapChangerText]);
            setFittingQuantities(prev => ({ ...prev, [tapChangerText]: 1 }));
          }
        }
      }, [formData.tapChangerType]);

      React.useEffect(() => {
        const kva = formData.kvaList.length > 0 ? Math.max(...formData.kvaList) : parseFloat(formData.kva);
        if (!isNaN(kva) && kva > 0) {
          const autoImpedance = getImpedanceForKva(kva);
          setFormData(prev => {
            if (
              !prev.impedanceVoltage ||
              prev.impedanceVoltage === '' ||
              parseFloat(prev.impedanceVoltage) === parseFloat(getImpedanceForKva(kva))
            ) {
              return { ...prev, impedanceVoltage: autoImpedance.toString() };
            }
            return prev;
          });
        } else {
          setFormData(prev => ({ ...prev, impedanceVoltage: '' }));
        }
      }, [formData.kvaList, formData.kva]);

      const hvVoltageNum = parseFloat(formData.hvVoltage);
      const lvVoltageNum = parseFloat(formData.lvVoltage);
      const hvBilChoices = getFloorBILChoices(hvVoltageNum);
      const lvBilChoices = lvVoltageNum >= 1 ? getFloorBILChoices(lvVoltageNum) : null;

      const handleDownloadPDF = () => {
        window.print();
      };

      let indexInput = 1;
      let indexOutput = 1;

      return (
        <div className="container mx-auto p-4 max-w-6xl">
          <div className="logo-header flex flex-wrap items-center justify-center mb-8 space-x-4">
            <img
              src="https://images.squarespace-cdn.com/content/v1/67c6cd6aa7237560f57b1238/5dc6f094-8e85-4639-9c96-e5aa5e773ec0/BCS-Mahati-with-C_TM-revised-02.png?format=1500w"
              alt="Company Logo"
              className="h-20 max-w-full object-contain"
            />
            <h1 className="text-3xl font-bold text-blue-800">
              Dry Type Transformer
            </h1>
          </div>

          <div className="bg-white p-6 rounded-lg shadow-md mb-6">
            <h2 className="text-xl font-bold mb-4 text-center">ANNEXURE – {formData.annexureNumber}</h2>
            <h3 className="text-lg font-semibold mb-4 text-center">
              GUARANTEED TECHNICAL PARTICULARS FOR DRY TYPE TRANSFORMER
            </h3>
            <div className="flex justify-end mb-2 gap-4">
              <label className="flex items-center gap-2">
                <span className="font-semibold">Annexure No.:</span>
                <input
                  type="text"
                  name="annexureNumber"
                  value={formData.annexureNumber}
                  onChange={handleInputChange}
                  className="w-20 p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                  placeholder="I"
                />
              </label>
              <label className="flex items-center gap-2">
                <span className="font-semibold">Revision No.:</span>
                <input
                  type="number"
                  min="1"
                  value={registerOutput}
                  onChange={e => setRegisterOutput(e.target.value.replace(/[^0-9]/g, ''))}
                  className="w-20 p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                  placeholder="n"
                />
              </label>
            </div>
            <table className="w-full border-collapse border border-gray-300 text-sm">
              <thead>
                <tr className="bg-blue-100">
                  <th className="border border-gray-300 p-4">Sr. No.</th>
                  <th className="border border-gray-300 p-4">Description</th>
                  <th className="border border-gray-300 p-4">Particulars</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td className="border border-gray-300 p-4 font-bold">{indexInput++}</td>
                  <td className="border border-gray-300 p-4 font-bold">Name of the Manufacturer <span className="text-red-600">*</span></td>
                  <td className="border border-gray-300 p-4">
                    <div className="w-full p-1 border rounded bg-gray-100 text-gray-800">{formData.manufacturer}</div>
                    {errors.manufacturer && <div className="text-red-600 text-xs mt-1">{errors.manufacturer}</div>}
                  </td>
                </tr>
                <tr>
                  <td className="border border-gray-300 p-4 font-bold">{indexInput++}</td>
                  <td className="border border-gray-300 p-4 font-bold">Customer</td>
                  <td className="border border-gray-300 p-4">
                    <input
                      type="text"
                      name="customer"
                      value={formData.customer}
                      onChange={handleInputChange}
                      className="w-full p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                      placeholder="(Optional)"
                    />
                  </td>
                </tr>
                <tr>
                  <td className="border border-gray-300 p-4 font-bold">{indexInput++}</td>
                  <td className="border border-gray-300 p-4 font-bold">Number of Transformers <span className="text-red-600">*</span></td>
                  <td className="border border-gray-300 p-4">
                    <input
                      type="number"
                      name="numberOfTransformers"
                      value={formData.numberOfTransformers}
                      onChange={handleInputChange}
                      className="w-full p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                      min="1"
                      placeholder="Enter number of transformers"
                    />
                    {errors.numberOfTransformers && <div className="text-red-600 text-xs mt-1">{errors.numberOfTransformers}</div>}
                  </td>
                </tr>
                <tr>
                  <td className="border border-gray-300 p-4 font-bold">{indexInput++}</td>
                  <td className="border border-gray-300 p-4 font-bold">Application</td>
                  <td className="border border-gray-300 p-4">
                    <input
                      type="text"
                      name="application"
                      value={formData.application}
                      onChange={handleInputChange}
                      className="w-full p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                      placeholder="Distribution Transformer"
                    />
                  </td>
                </tr>
                <tr>
                  <td className="border border-gray-300 p-4 font-bold">{indexInput++}</td>
                  <td className="border border-gray-300 p-4 font-bold">Reference Standard <span className="text-red-600">*</span></td>
                  <td className="border border-gray-300 p-4">
                    <MultiSelectComboBox
                      options={['IS 2026 - 11', 'IEC 60076', 'IEEE C57.12.00', 'ANSI C57.12.01']}
                      value={formData.referenceStandards}
                      onChange={(newValue) => {
                        setFormData(prev => ({ ...prev, referenceStandards: newValue }));
                        setErrors(prevErrors => {
                          const newErrors = { ...prevErrors };
                          if (newValue.length > 0) delete newErrors.referenceStandards;
                          return newErrors;
                        });
                      }}
                      placeholder="Select or type standards"
                    />
                    {errors.referenceStandards && <div className="text-red-600 text-xs mt-1">{errors.referenceStandards}</div>}
                  </td>
                </tr>
                <tr>
                  <td className="border border-gray-300 p-4 font-bold">{indexInput++}</td>
                  <td className="border border-gray-300 p-4 font-bold">KVA Rating (HV / LV Winding) <span className="text-red-600">*</span></td>
                  <td className="border border-gray-300 p-4">
                    <div className="flex gap-2 mb-2">
                      <input
                        type="number"
                        name="kvaInput"
                        value={kvaInput}
                        onChange={e => setKvaInput(e.target.value)}
                        className="w-full p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                        step="any"
                        placeholder="Enter kVA"
                      />
                      <button
                        type="button"
                        onClick={handleAddKva}
                        className="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"
                      >
                        Add
                      </button>
                    </div>
                    {errors.kva && <div className="text-red-600 text-xs mt-1">{errors.kva}</div>}
                    <div>
                      {formData.kvaList.map((kva, idx) => (
                        <div key={kva} className="flex items-center mb-1">
                          <span className="font-bold mr-2">{kva} kVA</span>
                          <button
                            type="button"
                            onClick={() => handleRemoveKva(kva)}
                            className="text-red-500 hover:underline ml-2"
                          >
                            Remove
                          </button>
                        </div>
                      ))}
                    </div>
                  </td>
                </tr>
                <tr>
                  <td className="border border-gray-300 p-4 font-bold">{indexInput++}</td>
                  <td className="border border-gray-300 p-4 font-bold">Rated Voltage (enter in kV): <span className="text-red-600">*</span></td>
                  <td className="border border-gray-300 p-4">
                    A. H.V. Winding: <input
                      type="number"
                      name="hvVoltage"
                      value={formData.hvVoltage}
                      onChange={handleInputChange}
                      className="w-full p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500 mb-1"
                      step="any"
                      placeholder="e.g., 11"
                    />
                    {errors.hvVoltage && <div className="text-red-600 text-xs mt-1">{errors.hvVoltage}</div>}
                    {hvBilChoices && (
                      <div className="mt-2">
                        <label className="block text-xs text-gray-700 mb-1">Select Lightning Impulse (BIL) for HV:</label>
                        <select
                          value={selectedHvBil ? selectedHvBil.impulse : ''}
                          onChange={e => {
                            const val = parseInt(e.target.value);
                            setSelectedHvBil(hvBilChoices.find(opt => opt.impulse === val));
                          }}
                          className="w-full p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                        >
                          <option value="">Select BIL</option>
                          {hvBilChoices.map(opt => (
                            <option key={opt.impulse} value={opt.impulse}>{opt.impulse} kVp</option>
                          ))}
                        </select>
                      </div>
                    )}
                    <br />
                    B. L.V. Winding: <input
                      type="number"
                      name="lvVoltage"
                      value={formData.lvVoltage}
                      onChange={handleInputChange}
                      className="w-full p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                      step="any"
                      placeholder="e.g., 0.433"
                    />
                    {errors.lvVoltage && <div className="text-red-600 text-xs mt-1">{errors.lvVoltage}</div>}
                    {lvBilChoices && (
                      <div className="mt-2">
                        <label className="block text-xs text-gray-700 mb-1">Select Lightning Impulse (BIL) for LV:</label>
                        <select
                          value={selectedLvBil ? selectedLvBil.impulse : ''}
                          onChange={e => {
                            const val = parseInt(e.target.value);
                            setSelectedLvBil(lvBilChoices.find(opt => opt.impulse === val));
                          }}
                          className="w-full p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                        >
                          <option value="">Select BIL</option>
                          {lvBilChoices.map(opt => (
                            <option key={opt.impulse} value={opt.impulse}>{opt.impulse} kVp</option>
                          ))}
                        </select>
                      </div>
                    )}
                  </td>
                </tr>
                <tr>
                  <td className="border border-gray-300 p-4 font-bold">{indexInput++}</td>
                  <td className="border border-gray-300 p-4 font-bold">Rated Frequency <span className="text-red-600">*</span></td>
                  <td className="border border-gray-300 p-4">
                    <MultiSelectComboBox
                      options={['50 Hz', '60 Hz', '50/60 Hz']}
                      value={formData.frequency}
                      onChange={(newValue) => {
                        setFormData(prev => ({ ...prev, frequency: newValue }));
                        setErrors(prevErrors => {
                          const newErrors = { ...prevErrors };
                          if (newValue.length > 0) delete newErrors.frequency;
                          return newErrors;
                        });
                      }}
                      placeholder="Select or type frequency"
                    />
                    {errors.frequency && <div className="text-red-600 text-xs mt-1">{errors.frequency}</div>}
                  </td>
                </tr>
                <tr>
                  <td className="border border-gray-300 p-4 font-bold">{indexInput++}</td>
                  <td className="border border-gray-300 p-4 font-bold">No Of Phases <span className="text-red-600">*</span></td>
                  <td className="border border-gray-300 p-4">
                    <MultiSelectComboBox
                      options={['1 Phase', '3 Phases']}
                      value={formData.phases}
                      onChange={(newValue) => {
                        setFormData(prev => ({ ...prev, phases: newValue }));
                        setErrors(prevErrors => {
                          const newErrors = { ...prevErrors };
                          if (newValue.length > 0) delete newErrors.phases;
                          return newErrors;
                        });
                      }}
                      placeholder="Select or type phases"
                    />
                    {errors.phases && <div className="text-red-600 text-xs mt-1">{errors.phases}</div>}
                  </td>
                </tr>
                <tr>
                  <td className="border border-gray-300 p-4 font-bold">{indexInput++}</td>
                  <td className="border border-gray-300 p-4 font-bold">Winding Connection <span className="text-red-600">*</span></td>
                  <td className="border border-gray-300 p-4">
                    <div className="space-y-3">
                      <div>
                        <label className="block text-sm font-medium mb-1">A. H.V. Winding:</label>
                        <MultiSelectComboBox
                          options={['Delta', 'Star with Neutral', 'Star', 'Zigzag', 'Auto']}
                          value={formData.hvConnection}
                          onChange={(newValue) => {
                            setFormData(prev => ({ ...prev, hvConnection: newValue }));
                            setErrors(prevErrors => {
                              const newErrors = { ...prevErrors };
                              if (newValue.length > 0) delete newErrors.hvConnection;
                              return newErrors;
                            });
                          }}
                          placeholder="Select or type HV connection"
                        />
                        {errors.hvConnection && <div className="text-red-600 text-xs mt-1">{errors.hvConnection}</div>}
                      </div>
                      <div>
                        <label className="block text-sm font-medium mb-1">B. L.V. Winding:</label>
                        <MultiSelectComboBox
                          options={['Star', 'Delta', 'Star with Neutral', 'Zigzag', 'Auto']}
                          value={formData.lvConnection}
                          onChange={(newValue) => {
                            setFormData(prev => ({ ...prev, lvConnection: newValue }));
                            setErrors(prevErrors => {
                              const newErrors = { ...prevErrors };
                              if (newValue.length > 0) delete newErrors.lvConnection;
                              return newErrors;
                            });
                          }}
                          placeholder="Select or type LV connection"
                        />
                        {errors.lvConnection && <div className="text-red-600 text-xs mt-1">{errors.lvConnection}</div>}
                      </div>
                    </div>
                  </td>
                </tr>
                <tr>
                  <td className="border border-gray-300 p-4 font-bold">{indexInput++}</td>
                  <td className="border border-gray-300 p-4 font-bold">Vector Group <span className="text-red-600">*</span></td>
                  <td className="border border-gray-300 p-4">
                    <MultiSelectComboBox
                      options={['Dyn11', 'Dd0', 'Dd6', 'YNd1', 'YNd11', 'YNyn0', 'Dzn0', 'Ya0']}
                      value={formData.vectorGroup}
                      onChange={(newValue) => {
                        setFormData(prev => ({ ...prev, vectorGroup: newValue }));
                        setErrors(prevErrors => {
                          const newErrors = { ...prevErrors };
                          if (newValue.length > 0) delete newErrors.vectorGroup;
                          return newErrors;
                        });
                      }}
                      placeholder="Select or type vector group"
                    />
                    {errors.vectorGroup && <div className="text-red-600 text-xs mt-1">{errors.vectorGroup}</div>}
                  </td>
                </tr>
                <tr>
                  <td className="border border-gray-300 p-4 font-bold">{indexInput++}</td>
                  <td className="border border-gray-300 p-4 font-bold">Tappings On HV <span className="text-red-600">*</span></td>
                  <td className="border border-gray-300 p-4">
                    <div className="space-y-3">
                      <div>
                        <label className="block text-sm font-medium mb-1">A. Type:</label>
                        <MultiSelectComboBox
                          options={['Tap Links', 'On Load Tap Changer', 'Off Circuit tap changer']}
                          value={formData.tapChangerType}
                          onChange={(newValue) => {
                            setFormData(prev => ({ ...prev, tapChangerType: newValue }));
                            setErrors(prevErrors => {
                              const newErrors = { ...prevErrors };
                              if (newValue.length > 0) delete newErrors.tapChangerType;
                              return newErrors;
                            });
                          }}
                          placeholder="Select or type tap changer type"
                        />
                        {errors.tapChangerType && <div className="text-red-600 text-xs mt-1">{errors.tapChangerType}</div>}
                      </div>
                      <div>
                        <label className="block text-sm font-medium mb-1">B. Number Of Steps:</label>
                        <MultiSelectComboBox
                          options={['4 steps , 5 positions', '6 steps , 7 positions', '8 steps , 9 positions', '16/17']}
                          value={formData.tapSteps}
                          onChange={(newValue) => {
                            setFormData(prev => ({ ...prev, tapSteps: newValue }));
                            setErrors(prevErrors => {
                              const newErrors = { ...prevErrors };
                              if (newValue.length > 0) delete newErrors.tapSteps;
                              return newErrors;
                            });
                          }}
                          placeholder="Select or type tap steps"
                        />
                        {errors.tapSteps && <div className="text-red-600 text-xs mt-1">{errors.tapSteps}</div>}
                      </div>
                      <div>
                        <label className="block text-sm font-medium mb-1">C. Tap Range:</label>
                        <MultiSelectComboBox
                          options={['± 5% @ 2.5%', '± 7.5% @ 2.5%', '± 10% @ 2.5%', '+10% to -10% @ 1.25%', '+5% to -15% @ 1.25%']}
                          value={formData.tappingRange}
                          onChange={(newValue) => {
                            setFormData(prev => ({ ...prev, tappingRange: newValue }));
                            setErrors(prevErrors => {
                              const newErrors = { ...prevErrors };
                              if (newValue.length > 0) delete newErrors.tappingRange;
                              return newErrors;
                            });
                          }}
                          placeholder="Select or type tap range"
                        />
                        {errors.tappingRange && <div className="text-red-600 text-xs mt-1">{errors.tappingRange}</div>}
                      </div>
                    </div>
                  </td>
                </tr>
                <tr>
                  <td className="border border-gray-300 p-4 font-bold">{indexInput++}</td>
                  <td className="border border-gray-300 p-4 font-bold">Winding Material <span className="text-red-600">*</span></td>
                  <td className="border border-gray-300 p-4">
                    <MultiSelectComboBox
                      options={['Copper', 'Aluminium', 'Copper-Aluminium Hybrid']}
                      value={formData.windingMaterial}
                      onChange={(newValue) => {
                        setFormData(prev => ({ ...prev, windingMaterial: newValue }));
                        setErrors(prevErrors => {
                          const newErrors = { ...prevErrors };
                          if (newValue.length > 0) delete newErrors.windingMaterial;
                          return newErrors;
                        });
                      }}
                      placeholder="Select or type winding material"
                    />
                    {errors.windingMaterial && <div className="text-red-600 text-xs mt-1">{errors.windingMaterial}</div>}
                  </td>
                </tr>
                <tr>
                  <td className="border border-gray-300 p-4 font-bold">{indexInput++}</td>
                  <td className="border border-gray-300 p-4 font-bold">Insulation Class <span className="text-red-600">*</span></td>
                  <td className="border border-gray-300 p-4">
                    <MultiSelectComboBox
                      options={['F', 'H', 'B', 'A']}
                      value={formData.insulationClass}
                      onChange={(newValue) => {
                        setFormData(prev => ({ ...prev, insulationClass: newValue }));
                        setErrors(prevErrors => {
                          const newErrors = { ...prevErrors };
                          if (newValue.length > 0) delete newErrors.insulationClass;
                          return newErrors;
                        });
                      }}
                      placeholder="Select or type insulation class"
                    />
                    {errors.insulationClass && <div className="text-red-600 text-xs mt-1">{errors.insulationClass}</div>}
                  </td>
                </tr>
                <tr>
                  <td className="border border-gray-300 p-4 font-bold">{indexInput++}</td>
                  <td className="border border-gray-300 p-4 font-bold">Type Of Cooling <span className="text-red-600">*</span></td>
                  <td className="border border-gray-300 p-4">
                    <MultiSelectComboBox
                      options={['AN', 'ANAF', 'ANAN', 'AFAF']}
                      value={formData.coolingType}
                      onChange={(newValue) => {
                        setFormData(prev => ({ ...prev, coolingType: newValue }));
                        setErrors(prevErrors => {
                          const newErrors = { ...prevErrors };
                          if (newValue.length > 0) delete newErrors.coolingType;
                          return newErrors;
                        });
                      }}
                      placeholder="Select or type cooling types"
                    />
                    {errors.coolingType && <div className="text-red-600 text-xs mt-1">{errors.coolingType}</div>}
                  </td>
                </tr>
                <tr>
                  <td className="border border-gray-300 p-4 font-bold">{indexInput++}</td>
                  <td className="border border-gray-300 p-4 font-bold">Temp. Rise Over Reference Amb. Temp. Of 50 °C <span className="text-red-600">*</span></td>
                  <td className="border border-gray-300 p-4">
                    In Winding By Resistance (enter in °C): <input
                      type="number"
                      name="windingTemp"
                      value={formData.windingTemp}
                      onChange={handleInputChange}
                      className="w-full p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                      step="any"
                    />
                    {errors.windingTemp && <div className="text-red-600 text-xs mt-1">{errors.windingTemp}</div>}
                  </td>
                </tr>
                <tr>
                  <td className="border border-gray-300 p-4 font-bold">{indexInput++}</td>
                  <td className="border border-gray-300 p-4 font-bold">Component Losses At Rated Voltage On Principal Tappings & Rated Frequency at 75 Deg C <span className="text-red-600">*</span></td>
                  <td className="border border-gray-300 p-4">
                    A. Total Loss @ 50% Load (Max) (enter in kW): <input
                      type="number"
                      name="noLoadLosses"
                      value={formData.noLoadLosses}
                      onChange={handleInputChange}
                      className="w-full p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500 mb-1"
                      step="any"
                    />
                    {errors.noLoadLosses && <div className="text-red-600 text-xs mt-1">{errors.noLoadLosses}</div>}
                    <br />
                    B. Total Loss @ 100% Load (Max) (enter in kW): <input
                      type="number"
                      name="loadLosses"
                      value={formData.loadLosses}
                      onChange={handleInputChange}
                      className="w-full p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                      step="any"
                    />
                    {errors.loadLosses && <div className="text-red-600 text-xs mt-1">{errors.loadLosses}</div>}
                    <br />
                    C. Total Losses at 100% Load (kW): <input
                      type="text"
                      value={formData.loadLosses}
                      readOnly
                      className="w-full p-1 border rounded bg-gray-100 text-gray-800 focus:outline-none"
                      step="any"
                    />
                  </td>
                </tr>
                <tr>
                  <td className="border border-gray-300 p-4 font-bold">{indexInput++}</td>
                  <td className="border border-gray-300 p-4 font-bold">Impedance At Principal Tap (IS Tol) <span className="text-red-600">*</span></td>
                  <td className="border border-gray-300 p-4">
                    <input
                      type="text"
                      name="impedanceVoltage"
                      value={formData.impedanceVoltage}
                      onChange={handleInputChange}
                      className="w-full p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                    />
                    {errors.impedanceVoltage && <div className="text-red-600 text-xs mt-1">{errors.impedanceVoltage}</div>}
                  </td>
                </tr>
                <tr>
                  <td className="border border-gray-300 p-4 font-bold">{indexInput++}</td>
                  <td className="border border-gray-300 p-4 font-bold">Terminal Arrangements <span className="text-red-600">*</span></td>
                  <td className="border border-gray-300 p-4">
                    <div className="space-y-3">
                      <div>
                        <label className="block text-sm font-medium mb-1">A. HV Side:</label>
                        <MultiSelectComboBox
                          options={['Cable Box', 'Bus Duct', 'Bare Bushing', 'Cable Box + DC']}
                          value={formData.hvTerminal}
                          onChange={handleHvTerminalChange}
                          placeholder="Select or type HV terminals"
                        />
                        {errors.hvTerminal && <div className="text-red-600 text-xs mt-1">{errors.hvTerminal}</div>}
                      </div>
                      <div>
                        <label className="block text-sm font-medium mb-1">B. LV Side:</label>
                        <MultiSelectComboBox
                          options={['Bus Duct', 'Cable Box', 'Bare Bushing']}
                          value={formData.lvTerminal}
                          onChange={handleLvTerminalChange}
                          placeholder="Select or type LV terminals"
                        />
                        {errors.lvTerminal && <div className="text-red-600 text-xs mt-1">{errors.lvTerminal}</div>}
                      </div>
                    </div>
                  </td>
                </tr>
                <tr>
                  <td className="border border-gray-300 p-4 font-bold">{indexInput++}</td>
                  <td className="border border-gray-300 p-4 font-bold">Enclosure Protection</td>
                  <td className="border border-gray-300 p-4">
                    <input
                      type="text"
                      name="enclosureProtection"
                      value={formData.enclosureProtection}
                      onChange={handleInputChange}
                      className="w-full p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                    />
                  </td>
                </tr>
                <tr>
                  <td className="border border-gray-300 p-4 font-bold">{indexInput++}</td>
                  <td className="border border-gray-300 p-4 font-bold">Service <span className="text-red-600">*</span></td>
                  <td className="border border-gray-300 p-4">
                    <MultiSelectComboBox
                      options={['Indoor', 'Outdoor', 'Indoor/Outdoor']}
                      value={formData.service}
                      onChange={(newValue) => {
                        setFormData(prev => ({ ...prev, service: newValue }));
                        setErrors(prevErrors => {
                          const newErrors = { ...prevErrors };
                          if (newValue.length > 0) delete newErrors.service;
                          return newErrors;
                        });
                      }}
                      placeholder="Select or type service"
                    />
                    {errors.service && <div className="text-red-600 text-xs mt-1">{errors.service}</div>}
                  </td>
                </tr>
                <tr>
                  <td className="border border-gray-300 p-4 font-bold">{indexInput++}</td>
                  <td className="border border-gray-300 p-4 font-bold">Altitude(in m)</td>
                  <td className="border border-gray-300 p-4">
                    <input
                      type="text"
                      name="altitude"
                      value={formData.altitude}
                      onChange={handleInputChange}
                      className="w-full p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                    />
                  </td>
                </tr>
                <tr>
                  <td className="border border-gray-300 p-4 font-bold">{indexInput++}</td>
                  <td className="border border-gray-300 p-4 font-bold">Noise Level</td>
                  <td className="border border-gray-300 p-4">
                    <input
                      type="text"
                      name="noiseLevel"
                      value={formData.noiseLevel}
                      onChange={handleInputChange}
                      className="w-full p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                    />
                  </td>
                </tr>
                <tr>
                  <td className="border border-gray-300 p-4 font-bold">{indexInput++}</td>
                  <td className="border border-gray-300 p-4 font-bold">Transformer Overloading</td>
                  <td className="border border-gray-300 p-4">
                    <input
                      type="text"
                      name="overloading"
                      value={formData.overloading}
                      onChange={handleInputChange}
                      className="w-full p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                    />
                  </td>
                </tr>
              </tbody>
            </table>
            {Object.values(errors).length > 0 && (
              <div className="mt-2 mb-4 p-2 font-bold bg-red-100 text-red-800 border border-red-300 rounded text-center text-sm">
                Some fields are missing input.
              </div>
            )}
            <div className="mt-4">
              <label className="inline-flex items-center">
                <input
                  type="checkbox"
                  className="form-checkbox h-5 w-5 text-blue-600"
                  checked={showAdditionalDetails}
                  onChange={handleCheckboxChange}
                />
                <span className="ml-2 text-gray-700">Enter Additional Weight/Dimensions</span>
              </label>
            </div>
            {showAdditionalDetails && (
              <table className="w-full border-collapse border border-gray-300 text-sm mt-4">
                <thead>
                  <tr className="bg-blue-100">
                    <th className="border border-gray-300 p-4">Sr. No.</th>
                    <th className="border border-gray-300 p-4">Description</th>
                    <th className="border border-gray-300 p-4">Particulars</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td className="border border-gray-300 p-4 font-bold">{indexInput++}</td>
                    <td className="border border-gray-300 p-4 font-bold">Dimensions <span className="text-red-600">*</span></td>
                    <td className="border border-gray-300 p-4">
                      a) Length (enter in mm): <input
                        type="text"
                        name="length"
                        value={formData.length}
                        onChange={handleInputChange}
                        className="w-full p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500 mb-1"
                      />
                      {errors.length && <div className="text-red-600 text-xs mt-1">{errors.length}</div>}
                      <br />
                      b) Width (enter in mm): <input
                        type="text"
                        name="width"
                        value={formData.width}
                        onChange={handleInputChange}
                        class                        className="w-full p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500 mb-1"
                      />
                      {errors.width && <div className="text-red-600 text-xs mt-1">{errors.width}</div>}
                      <br />
                      c) Height (enter in mm): <input
                        type="text"
                        name="height"
                        value={formData.height}
                        onChange={handleInputChange}
                        className="w-full p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                      />
                      {errors.height && <div className="text-red-600 text-xs mt-1">{errors.height}</div>}
                    </td>
                  </tr>
                  <tr>
                    <td className="border border-gray-300 p-4 font-bold">{indexInput++}</td>
                    <td className="border border-gray-300 p-4 font-bold">Weight <span className="text-red-600">*</span></td>
                    <td className="border border-gray-300 p-4">
                      a) Core & Windings (enter in kg): <input
                        type="text"
                        name="coreWindingsWeight"
                        value={formData.coreWindingsWeight}
                        onChange={handleInputChange}
                        className="w-full p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500 mb-1"
                      />
                      {errors.coreWindingsWeight && <div className="text-red-600 text-xs mt-1">{errors.coreWindingsWeight}</div>}
                      <br />
                      b) Tank & Fittings (enter in kg): <input
                        type="text"
                        name="tankFittingsWeight"
                        value={formData.tankFittingsWeight}
                        onChange={handleInputChange}
                        className="w-full p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500 mb-1"
                      />
                      {errors.tankFittingsWeight && <div className="text-red-600 text-xs mt-1">{errors.tankFittingsWeight}</div>}
                      <br />
                      c) Total Weight (kg): <input
                        type="text"
                        name="totalWeight"
                        value={formData.totalWeight}
                        readOnly
                        className="w-full p-1 border rounded bg-gray-100 text-gray-800 focus:outline-none"
                      />
                      {errors.totalWeight && <div className="text-red-600 text-xs mt-1">{errors.totalWeight}</div>}
                    </td>
                  </tr>
                </tbody>
              </table>
            )}
            <div className="mt-4">
              <label className="inline-flex items-center">
                <input
                  type="checkbox"
                  className="form-checkbox h-5 w-5 text-blue-600"
                  checked={showAdditionalFittings}
                  onChange={(e) => setShowAdditionalFittings(e.target.checked)}
                />
                <span className="ml-2 text-gray-700">Add/Modify Fittings</span>
              </label>
            </div>
            {showAdditionalFittings && (
              <div className="mt-4">
                <h3 className="text-lg font-semibold mb-2">Fittings</h3>
                <div className="mb-4">
                  <label className="inline-flex items-center">
                    <input
                      type="checkbox"
                      className="form-checkbox h-5 w-5 text-blue-600"
                      checked={editFittings}
                      onChange={(e) => setEditFittings(e.target.checked)}
                    />
                    <span className="ml-2 text-gray-700">Edit Standard Fittings</span>
                  </label>
                </div>
                {editFittings && (
                  <div className="mb-4">
                    <h4 className="text-md font-semibold mb-2">Standard Fittings</h4>
                    {allStandardFittings.map((fitting) => (
                      <div key={fitting} className="flex items-center mb-2">
                        <input
                          type="checkbox"
                          checked={selectedFittings.includes(fitting)}
                          onChange={() => {
                            setSelectedFittings((prev) =>
                              prev.includes(fitting)
                                ? prev.filter((f) => f !== fitting)
                                : [...prev, fitting]
                            );
                          }}
                          className="form-checkbox h-5 w-5 text-blue-600"
                        />
                        <span className="ml-2">{fitting}</span>
                        {selectedFittings.includes(fitting) && (
                          <input
                            type="number"
                            min="1"
                            value={fittingQuantities[fitting] || 1}
                            onChange={(e) =>
                              setFittingQuantities((prev) => ({
                                ...prev,
                                [fitting]: parseInt(e.target.value) || 1,
                              }))
                            }
                            className="ml-4 w-20 p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                          />
                        )}
                      </div>
                    ))}
                  </div>
                )}
                <div className="mb-4">
                  <h4 className="text-md font-semibold mb-2">Additional Fittings</h4>
                  <div className="flex gap-2 mb-2">
                    <input
                      type="text"
                      value={newFitting}
                      onChange={(e) => setNewFitting(e.target.value)}
                      className="w-full p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                      placeholder="Enter new fitting"
                    />
                    <input
                      type="number"
                      min="1"
                      value={newFittingQty}
                      onChange={(e) => setNewFittingQty(parseInt(e.target.value) || 1)}
                      className="w-20 p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                    />
                    <button
                      type="button"
                      onClick={handleAddFitting}
                      className="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"
                    >
                      Add
                    </button>
                  </div>
                  {additionalFittings.map((fitting, index) => (
                    <div key={index} className="flex items-center mb-1">
                      <span className="mr-2">{fitting.desc} (Qty: {fitting.qty})</span>
                      <button
                        type="button"
                        onClick={() => handleRemoveFitting(index)}
                        className="text-red-500 hover:underline"
                      >
                        Remove
                      </button>
                    </div>
                  ))}
                </div>
              </div>
            )}
            <div className="mt-6 flex justify-center">
              <button
                type="button"
                onClick={calculateParameters}
                className="px-6 py-2 bg-green-500 text-white rounded hover:bg-green-600"
              >
                Generate Report
              </button>
            </div>
          </div>

          {report && (
            <div id="report-section" className="bg-white p-6 rounded-lg shadow-md">
              <div className="logo-header flex items-center justify-center mb-8 space-x-4">
                <img
                  src="https://images.squarespace-cdn.com/content/v1/67c6cd6aa7237560f57b1238/5dc6f094-8e85-4639-9c96-e5aa5e773ec0/BCS-Mahati-with-C_TM-revised-02.png?format=1500w"
                  alt="Company Logo"
                  className="h-20 max-w-full object-contain"
                />
                <h1 className="text-3xl font-bold text-blue-800">
                  Dry Type Transformer
                </h1>
              </div>
              <h2 className="text-xl font-bold mb-4 text-center">ANNEXURE – {report.annexureNumber}</h2>
              <h3 className="text-lg font-semibold mb-4 text-center">
                GUARANTEED TECHNICAL PARTICULARS FOR DRY TYPE TRANSFORMER
              </h3>
              <div className="flex justify-between mb-4">
                <div className="text-sm">
                  <p><strong>Customer:</strong> {report.customer || 'N/A'}</p>
                  <p><strong>Revision No.:</strong> {registerOutput || 'N/A'}</p>
                </div>
              </div>
              <table className="w-full border-collapse border border-gray-300 text-sm">
                <thead>
                  <tr className="bg-blue-100">
                    <th className="border border-gray-300 p-4">Sr. No.</th>
                    <th className="border border-gray-300 p-4">Description</th>
                    <th className="border border-gray-300 p-4">Particulars</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td className="border border-gray-300 p-4">{indexOutput++}</td>
                    <td className="border border-gray-300 p-4 font-bold">Name of the Manufacturer</td>
                    <td className="border border-gray-300 p-4">{report.manufacturer}</td>
                  </tr>
                  <tr>
                    <td className="border border-gray-300 p-4">{indexOutput++}</td>
                    <td className="border border-gray-300 p-4 font-bold">Customer</td>
                    <td className="border border-gray-300 p-4">{report.customer || 'N/A'}</td>
                  </tr>
                  <tr>
                    <td className="border border-gray-300 p-4">{indexOutput++}</td>
                    <td className="border border-gray-300 p-4 font-bold">Number of Transformers</td>
                    <td className="border border-gray-300 p-4">{report.numberOfTransformers}</td>
                  </tr>
                  <tr>
                    <td className="border border-gray-300 p-4">{indexOutput++}</td>
                    <td className="border border-gray-300 p-4 font-bold">Application</td>
                    <td className="border border-gray-300 p-4">{report.application || 'Distribution Transformer'}</td>
                  </tr>
                  <tr>
                    <td className="border border-gray-300 p-4">{indexOutput++}</td>
                    <td className="border border-gray-300 p-4 font-bold">Reference Standard</td>
                    <td className="border border-gray-300 p-4">{report.referenceStandards.join(', ')}</td>
                  </tr>
                  <tr>
                    <td className="border border-gray-300 p-4">{indexOutput++}</td>
                    <td className="border border-gray-300 p-4 font-bold">KVA Rating (HV / LV Winding)</td>
                    <td className="border border-gray-300 p-4">
                      {report.kvaList.length > 0 ? report.kvaList.join(' kVA, ') + ' kVA' : report.kva + ' kVA'}
                    </td>
                  </tr>
                  <tr>
                    <td className="border border-gray-300 p-4">{indexOutput++}</td>
                    <td className="border border-gray-300 p-4 font-bold">Rated Voltage</td>
                    <td className="border border-gray-300 p-4">
                      A. H.V. Winding: {report.hvVoltage} kV<br />
                      B. L.V. Winding: {report.lvVoltage} kV
                    </td>
                  </tr>
                  <tr>
                    <td className="border border-gray-300 p-4">{indexOutput++}</td>
                    <td className="border border-gray-300 p-4 font-bold">Rated Frequency</td>
                    <td className="border border-gray-300 p-4">{report.frequency.join(', ')}</td>
                  </tr>
                  <tr>
                    <td className="border border-gray-300 p-4">{indexOutput++}</td>
                    <td className="border border-gray-300 p-4 font-bold">No Of Phases</td>
                    <td className="border border-gray-300 p-4">{report.phases.join(', ')}</td>
                  </tr>
                  <tr>
                    <td className="border border-gray-300 p-4">{indexOutput++}</td>
                    <td className="border border-gray-300 p-4 font-bold">Winding Connection</td>
                    <td className="border border-gray-300 p-4">
                      A. H.V. Winding: {report.hvConnection.join(', ')}<br />
                      B. L.V. Winding: {report.lvConnection.join(', ')}
                    </td>
                  </tr>
                  <tr>
                    <td className="border border-gray-300 p-4">{indexOutput++}</td>
                    <td className="border border-gray-300 p-4 font-bold">Vector Group</td>
                    <td className="border border-gray-300 p-4">{report.vectorGroup.join(', ')}</td>
                  </tr>
                  <tr>
                    <td className="border border-gray-300 p-4">{indexOutput++}</td>
                    <td className="border border-gray-300 p-4 font-bold">Tappings On HV</td>
                    <td className="border border-gray-300 p-4">
                      A. Type: {report.tapChangerType.join(', ')}<br />
                      B. Number Of Steps: {report.tapSteps.join(', ')}<br />
                      C. Tap Range: {report.tappingRange.join(', ')}
                    </td>
                  </tr>
                  <tr>
                    <td className="border border-gray-300 p-4">{indexOutput++}</td>
                    <td className="border border-gray-300 p-4 font-bold">Winding Material</td>
                    <td className="border border-gray-300 p-4">{report.windingMaterial.join(', ')}</td>
                  </tr>
                  <tr>
                    <td className="border border-gray-300 p-4">{indexOutput++}</td>
                    <td className="border border-gray-300 p-4 font-bold">Insulation Class</td>
                    <td className="border border-gray-300 p-4">{report.insulationClass.join(', ')}</td>
                  </tr>
                  <tr>
                    <td className="border border-gray-300 p-4">{indexOutput++}</td>
                    <td className="border border-gray-300 p-4 font-bold">Type Of Cooling</td>
                    <td className="border border-gray-300 p-4">{report.coolingType.join(', ')}</td>
                  </tr>
                  <tr>
                    <td className="border border-gray-300 p-4">{indexOutput++}</td>
                    <td className="border border-gray-300 p-4 font-bold">Temp. Rise Over Reference Amb. Temp. Of 50 °C</td>
                    <td className="border border-gray-300 p-4">In Winding By Resistance: {report.windingTemp} °C</td>
                  </tr>
                  <tr>
                    <td className="border border-gray-300 p-4">{indexOutput++}</td>
                    <td className="border border-gray-300 p-4 font-bold">Component Losses At Rated Voltage On Principal Tappings & Rated Frequency at 75 Deg C</td>
                    <td className="border border-gray-300 p-4">
                      A. Total Loss @ 50% Load (Max): {report.maxLosses50} kW<br />
                      B. Total Loss @ 100% Load (Max): {report.maxLosses100} kW<br />
                      C. Total Losses at 100% Load: {report.totalLosses} kW
                    </td>
                  </tr>
                  <tr>
                    <td className="border border-gray-300 p-4">{indexOutput++}</td>
                    <td className="border border-gray-300 p-4 font-bold">Impedance At Principal Tap</td>
                    <td className="border border-gray-300 p-4">{report.impedanceVoltage}%</td>
                  </tr>
                  <tr>
                    <td className="border border-gray-300 p-4">{indexOutput++}</td>
                    <td className="border border-gray-300 p-4 font-bold">Insulation Level</td>
                    <td className="border border-gray-300 p-4">
                      A. H.V. Winding<br />
                      &nbsp;&nbsp;&nbsp;&nbsp;- Power Frequency: {report.hvPowerFreq} kV<br />
                      &nbsp;&nbsp;&nbsp;&nbsp;- Induced: {report.hvInduced} kV<br />
                      &nbsp;&nbsp;&nbsp;&nbsp;- Impulse: {report.hvImpulse} kVp<br />
                      B. L.V. Winding<br />
                      &nbsp;&nbsp;&nbsp;&nbsp;- Power Frequency: {report.lvPowerFreq} kV<br />
                      &nbsp;&nbsp;&nbsp;&nbsp;- Induced: {report.lvInduced} kV<br />
                      &nbsp;&nbsp;&nbsp;&nbsp;- Impulse: {report.lvImpulse} kVp
                    </td>
                  </tr>
                  <tr>
                    <td className="border border-gray-300 p-4">{indexOutput++}</td>
                    <td className="border border-gray-300 p-4 font-bold">Efficiency</td>
                    <td className="border border-gray-300 p-4">
                      A. At 100% Load, Unity PF: {report.efficiency100}%<br />
                      B. At 75% Load, Unity PF: {report.efficiency75}%<br />
                      C. At 50% Load, Unity PF: {report.efficiency50}%<br />
                      D. At 100% Load, 0.8 PF: {report.efficiency100_08pf}%<br />
                      E. At 75% Load, 0.8 PF: {report.efficiency75_08pf}%<br />
                      F. At 50% Load, 0.8 PF: {report.efficiency50_08pf}%
                    </td>
                  </tr>
                  <tr>
                    <td className="border border-gray-300 p-4">{indexOutput++}</td>
                    <td className="border border-gray-300 p-4 font-bold">Regulation</td>
                    <td className="border border-gray-300 p-4">
                      A. At Unity Power Factor: {report.regulationUnity}%<br />
                      B. At 0.8 Power Factor: {report.regulation08}%
                    </td>
                  </tr>
                  <tr>
                    <td className="border border-gray-300 p-4">{indexOutput++}</td>
                    <td className="border border-gray-300 p-4 font-bold">Impedance Components</td>
                    <td className="border border-gray-300 p-4">
                      A. Resistance: {report.resistance}%<br />
                      B. Reactance: {report.reactance}%
                    </td>
                  </tr>
                  <tr>
                    <td className="border border-gray-300 p-4">{indexOutput++}</td>
                    <td className="border border-gray-300 p-4 font-bold">Rated Current</td>
                    <td className="border border-gray-300 p-4">
                      A. H.V. Winding: {report.hvCurrent} Amps<br />
                      B. L.V. Winding: {report.lvCurrent} Amps
                    </td>
                  </tr>
                  <tr>
                    <td className="border border-gray-300 p-4">{indexOutput++}</td>
                    <td className="border border-gray-300 p-4 font-bold">Terminal Arrangements</td>
                    <td className="border border-gray-300 p-4">
                      A. H.V. Side: {report.hvTerminal.join(', ')}<br />
                      B. L.V. Side: {report.lvTerminal.join(', ')}
                    </td>
                  </tr>
                  <tr>
                    <td className="border border-gray-300 p-4">{indexOutput++}</td>
                    <td className="border border-gray-300 p-4 font-bold">Minimum Clearances</td>
                    <td className="border border-gray-300 p-4">
                      A. H.V. Side<br />
                      &nbsp;&nbsp;&nbsp;&nbsp;- Phase to Phase: {getMinimumClearances(hvVoltageNum, selectedHvBil?.impulse, report.hvTerminal).phaseToPhase} mm<br />
                      &nbsp;&nbsp;&nbsp;&nbsp;- Phase to Earth: {getMinimumClearances(hvVoltageNum, selectedHvBil?.impulse, report.hvTerminal).phaseToEarth} mm<br />
                      B. L.V. Side<br />
                      &nbsp;&nbsp;&nbsp;&nbsp;- Phase to Phase: {getMinimumClearances(lvVoltageNum, selectedLvBil?.impulse, report.lvTerminal).phaseToPhase} mm<br />
                      &nbsp;&nbsp;&nbsp;&nbsp;- Phase to Earth: {getMinimumClearances(lvVoltageNum, selectedLvBil?.impulse, report.lvTerminal).phaseToEarth} mm
                    </td>
                  </tr>
                  <tr>
                    <td className="border border-gray-300 p-4">{indexOutput++}</td>
                    <td className="border border-gray-300 p-4 font-bold">Dimensions</td>
                    <td className="border border-gray-300 p-4">
                      A. Length: {report.length} mm<br />
                      B. Width: {report.width} mm<br />
                      C. Height: {report.height} mm
                    </td>
                  </tr>
                  <tr>
                    <td className="border border-gray-300 p-4">{indexOutput++}</td>
                    <td className="border border-gray-300 p-4 font-bold">Weight</td>
                    <td className="border border-gray-300 p-4">
                      A. Core & Windings: {report.coreWindingsWeight} kg<br />
                      B. Tank & Fittings: {report.tankFittingsWeight} kg<br />
                      C. Total Weight: {report.totalWeight} kg
                    </td>
                  </tr>
                  <tr>
                    <td className="border border-gray-300 p-4">{indexOutput++}</td>
                    <td className="border border-gray-300 p-4 font-bold">Fittings</td>
                    <td className="border border-gray-300 p-4">
                      {report.selectedFittings.map((fitting) => (
                        <div key={fitting}>
                          {fitting} {report.fittingQuantities[fitting] > 1 ? `(${report.fittingQuantities[fitting]} Nos.)` : ''}
                        </div>
                      ))}
                      {report.additionalFittings.map((fitting, index) => (
                        <div key={index}>
                          {fitting.desc} {fitting.qty > 1 ? `(${fitting.qty} Nos.)` : ''}
                        </div>
                      ))}
                      {report.terminalFittings.map((fitting) => (
                        <div key={fitting}>
                          {fitting} {report.terminalFittingQuantities[fitting] > 1 ? `(${report.terminalFittingQuantities[fitting]} Nos.)` : ''}
                        </div>
                      ))}
                    </td>
                  </tr>
                  <tr>
                    <td className="border border-gray-300 p-4">{indexOutput++}</td>
                    <td className="border border-gray-300 p-4 font-bold">Enclosure Protection</td>
                    <td className="border border-gray-300 p-4">{report.enclosureProtection}</td>
                  </tr>
                  <tr>
                    <td className="border border-gray-300 p-4">{indexOutput++}</td>
                    <td className="border border-gray-300 p-4 font-bold">Service</td>
                    <td className="border border-gray-300 p-4">{report.service.join(', ')}</td>
                  </tr>
                  <tr>
                    <td className="border border-gray-300 p-4">{indexOutput++}</td>
                    <td className="border border-gray-300 p-4 font-bold">Altitude</td>
                    <td className="border border-gray-300 p-4">{report.altitude}</td>
                  </tr>
                  <tr>
                    <td className="border border-gray-300 p-4">{indexOutput++}</td>
                    <td className="border border-gray-300 p-4 font-bold">Noise Level</td>
                    <td className="border border-gray-300 p-4">{report.noiseLevel}</td>
                  </tr>
                  <tr>
                    <td className="border border-gray-300 p-4">{indexOutput++}</td>
                    <td className="border border-gray-300 p-4 font-bold">Transformer Overloading</td>
                    <td className="border border-gray-300 p-4">{report.overloading}</td>
                  </tr>
                </tbody>
              </table>
              <div className="mt-6 flex justify-center print-button">
                <button
                  type="button"
                  onClick={handleDownloadPDF}
                  className="px-6 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"
                >
                  Download PDF
                </button>
              </div>
            </div>
          )}
        </div>
      );
    }

    ReactDOM.render(<App />, document.getElementById('root'));
  </script>
</body>
</html>