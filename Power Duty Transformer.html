<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Power Transformer</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prop-types/15.8.1/prop-types.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.2/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @media print {
      body * {
        visibility: hidden;
      }
      #report-section, #report-section * {
        visibility: visible;
      }
      #report-section {
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
        padding: 20px;
      }
      #report-section .print-button {
        display: none;
      }
      .page-break { page-break-before: always; break-before: page; }
    }
    @media (max-width: 640px) {
      .logo-header {
        flex-direction: column;
        align-items: center;
        text-align: center;
      }
      .logo-header img {
        margin-right: 0;
        margin-bottom: 1rem;
      }
    }
    .error-message {
      color: red;
      font-size: 0.875rem;
      margin-top: 0.25rem;
    }
  </style>
</head>
<body className="bg-gray-100">
  <div id="root"></div>

  <script type="text/babel">
    const root = ReactDOM.createRoot(document.getElementById('root'));

    const insulationLevels = {
      1.1: {
        hvPowerFreq: 3, hvInduced: "Twice to Rated Voltage", hvImpulse: "NA",
        lvPowerFreq: 3, lvInduced: "Twice to Rated Voltage", lvImpulse: "NA"
      },
      3.6: {
        hvPowerFreq: 10, hvInduced: "Twice to Rated Voltage", hvImpulse: 20,
        lvPowerFreq: 10, lvInduced: "Twice to Rated Voltage", lvImpulse: 20
      },
      6.6: {
        hvPowerFreq: 20, hvInduced: "Twice to Rated Voltage", hvImpulse: 60,
        lvPowerFreq: 20, lvInduced: "Twice to Rated Voltage", lvImpulse: 60
      },
      11: {
        hvPowerFreq: 28, hvInduced: "Twice to Rated Voltage", hvImpulse: 75,
        lvPowerFreq: 28, lvInduced: "Twice to Rated Voltage", lvImpulse: 75
      },
      15: {
        hvPowerFreq: 38, hvInduced: "Twice to Rated Voltage", hvImpulse: 95,
        lvPowerFreq: 38, lvInduced: "Twice to Rated Voltage", lvImpulse: 95
      },
      22: {
        hvPowerFreq: 50, hvInduced: "Twice to Rated Voltage", hvImpulse: 125,
        lvPowerFreq: 50, lvInduced: "Twice to Rated Voltage", lvImpulse: 125
      },
      33: {
        hvPowerFreq: 70, hvInduced: "Twice to Rated Voltage", hvImpulse: 170,
        lvPowerFreq: 70, lvInduced: "Twice to Rated Voltage", lvImpulse: 170
      },
      66: {
        hvPowerFreq: 140, hvInduced: "Twice to Rated Voltage", hvImpulse: 325,
        lvPowerFreq: 140, lvInduced: "Twice to Rated Voltage", lvImpulse: 325
      },
      110: {
        hvPowerFreq: 185, hvInduced: "Twice to Rated Voltage", hvImpulse: 450,
        lvPowerFreq: 185, lvInduced: "Twice to Rated Voltage", lvImpulse: 450
      },
      132: {
        hvPowerFreq: 230, hvInduced: "Twice to Rated Voltage", hvImpulse: 550,
        lvPowerFreq: 230, lvInduced: "Twice to Rated Voltage", lvImpulse: 550
      },
      220: {
        hvPowerFreq: 395, hvInduced: "Twice to Rated Voltage", hvImpulse: 950,
        lvPowerFreq: 395, lvInduced: "Twice to Rated Voltage", lvImpulse: 950
      },
      400: {
        hvPowerFreq: 570, hvInduced: "Twice to Rated Voltage", hvImpulse: 1300,
        lvPowerFreq: 570, lvInduced: "Twice to Rated Voltage", lvImpulse: 1300
      },
      420.1: {
        hvPowerFreq: 630, hvInduced: "Twice to Rated Voltage", hvImpulse: 1425,
        lvPowerFreq: 630, lvInduced: "Twice to Rated Voltage", lvImpulse: 1425
      }
    };

    // 1. Add the cableBoxClearances table at the top, after insulationLevels and before voltageBasedClearances:
    const cableBoxClearances = {
      0: { phaseToPhase: 25, phaseToEarth: 20 },
      1.1: { phaseToPhase: 25, phaseToEarth: 20 },
      3.6: { phaseToPhase: 50, phaseToEarth: 50 },
      7.2: { phaseToPhase: 90, phaseToEarth: 70 },
      12: { phaseToPhase: 130, phaseToEarth: 80 },
      24: { phaseToPhase: 241, phaseToEarth: 140 },
      36: { phaseToPhase: 351, phaseToEarth: 222 }
    };

    // Define termination arrangement options
    const terminationArrangementOptions = [
      "Cable Box",
      "Bus Duct",
      "Bare Bushing",
    ];

    // Helper function to get the correct insulation level
    function getInsulationLevel(voltage) {
      if (isNaN(voltage) || voltage <= 0) return null;
      const levels = Object.keys(insulationLevels).map(Number).sort((a, b) => a - b);
      let floor = levels[0];
      for (let i = 0; i < levels.length; i++) {
        if (levels[i] <= voltage) floor = levels[i];
      }
      return insulationLevels[floor];
    }

    function MultiSelectDropdown({ options, selected, onChange, placeholder }) {
      const [open, setOpen] = React.useState(false);
      const containerRef = React.useRef(null);

      React.useEffect(() => {
        function handleClickOutside(event) {
          if (containerRef.current && !containerRef.current.contains(event.target)) {
            setOpen(false);
          }
        }
        if (open) {
          document.addEventListener('mousedown', handleClickOutside);
        } else {
          document.removeEventListener('mousedown', handleClickOutside);
        }
        return () => {
          document.removeEventListener('mousedown', handleClickOutside);
        };
      }, [open]);

      const handleSelect = (option) => {
        if (selected.includes(option)) {
          onChange(selected.filter((v) => v !== option));
        } else {
          onChange([...selected, option]);
        }
      };
      return (
        <div className="relative" ref={containerRef}>
          <div
            className="w-full p-1 border rounded bg-white cursor-pointer flex items-center"
            onClick={() => setOpen((o) => !o)}
            tabIndex={0}
          >
            <span className={selected.length ? '' : 'text-gray-400'}>
              {selected.length ? selected.join(', ') : placeholder}
            </span>
            <svg className="w-4 h-4 ml-auto text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M19 9l-7 7-7-7" />
            </svg>
          </div>
          {open && (
            <div className="absolute z-10 bg-white border rounded shadow w-full max-h-48 overflow-y-auto mt-1">
              {options.map((option) => (
                <label
                  key={option}
                  className="flex items-center px-2 py-1 hover:bg-blue-50 cursor-pointer"
                >
                  <input
                    type="checkbox"
                    checked={selected.includes(option)}
                    onChange={() => handleSelect(option)}
                    className="mr-2"
                  />
                  {option}
                </label>
              ))}
            </div>
          )}
        </div>
      );
    }

    function SingleSelectDropdown({ options, value, onChange, placeholder }) {
      const [open, setOpen] = React.useState(false);
      const handleSelect = (option) => {
        onChange(option);
        setOpen(false);
      };
      return (
        <div className="relative">
          <div
            className="w-full p-1 border rounded bg-white cursor-pointer flex items-center"
            onClick={() => setOpen((o) => !o)}
            tabIndex={0}
            onBlur={() => setTimeout(() => setOpen(false), 150)}
          >
            <span className={value ? '' : 'text-gray-400'}>
              {value || placeholder}
            </span>
            <svg className="w-4 h-4 ml-auto text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M19 9l-7 7-7-7" />
            </svg>
          </div>
          {open && (
            <div className="absolute z-10 bg-white border rounded shadow w-full max-h-48 overflow-y-auto mt-1">
              {options.map((option) => (
                <div
                  key={option}
                  className={`px-2 py-1 hover:bg-blue-50 cursor-pointer ${value === option ? 'bg-blue-100' : ''}`}
                  onClick={() => handleSelect(option)}
                >
                  {option}
                </div>
              ))}
            </div>
          )}
        </div>
      );
    }

    // ComboBox component for single-value select or free text
    function ComboBox({ options, value, onChange, placeholder }) {
      const [open, setOpen] = React.useState(false);
      const [inputValue, setInputValue] = React.useState(value || '');
      const containerRef = React.useRef(null);

      React.useEffect(() => {
        setInputValue(value || '');
      }, [value]);

      React.useEffect(() => {
        function handleClickOutside(event) {
          if (containerRef.current && !containerRef.current.contains(event.target)) {
            setOpen(false);
          }
        }
        if (open) {
          document.addEventListener('mousedown', handleClickOutside);
        } else {
          document.removeEventListener('mousedown', handleClickOutside);
        }
        return () => {
          document.removeEventListener('mousedown', handleClickOutside);
        };
      }, [open]);

      const handleSelect = (option) => {
        setInputValue(option);
        onChange(option);
        setOpen(false);
      };
      const handleInputChange = (e) => {
        setInputValue(e.target.value);
        onChange(e.target.value);
      };
      return (
        <div className="relative" ref={containerRef}>
          <input
            type="text"
            className="w-full p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
            value={inputValue}
            onChange={handleInputChange}
            placeholder={placeholder}
            onFocus={() => setOpen(true)}
            autoComplete="off"
          />
          {open && options.length > 0 && (
            <div className="absolute z-10 bg-white border rounded shadow w-full max-h-48 overflow-y-auto mt-1">
              {options.filter(opt => opt.toLowerCase().includes(inputValue.toLowerCase()) && opt !== inputValue).map((option) => (
                <div
                  key={option}
                  className="px-2 py-1 hover:bg-blue-50 cursor-pointer"
                  onMouseDown={() => handleSelect(option)}
                >
                  {option}
                </div>
              ))}
            </div>
          )}
        </div>
      );
    }

    // MultiSelectComboBox for multi-select and custom values
    function MultiSelectComboBox({ options, value, onChange, placeholder }) {
      const [open, setOpen] = React.useState(false);
      const [inputValue, setInputValue] = React.useState('');
      const containerRef = React.useRef(null);

      React.useEffect(() => {
        function handleClickOutside(event) {
          if (containerRef.current && !containerRef.current.contains(event.target)) {
            setOpen(false);
          }
        }
        if (open) {
          document.addEventListener('mousedown', handleClickOutside);
        } else {
          document.removeEventListener('mousedown', handleClickOutside);
        }
        return () => {
          document.removeEventListener('mousedown', handleClickOutside);
        };
      }, [open]);

      const handleSelect = (option) => {
        if (!value.includes(option)) {
          onChange([...value, option]);
        }
        setInputValue('');
        setOpen(false);
      };
      const handleRemove = (option) => {
        onChange(value.filter(v => v !== option));
      };
      const handleInputChange = (e) => {
        setInputValue(e.target.value);
        setOpen(true);
      };
      const handleInputKeyDown = (e) => {
        if ((e.key === 'Enter' || e.key === ',') && inputValue.trim()) {
          e.preventDefault();
          if (!value.includes(inputValue.trim())) {
            onChange([...value, inputValue.trim()]);
          }
          setInputValue('');
          setOpen(false);
        } else if (e.key === 'Backspace' && !inputValue && value.length > 0) {
          onChange(value.slice(0, -1));
        }
      };
      const handleBlur = () => {
        if (inputValue.trim() && !value.includes(inputValue.trim())) {
          onChange([...value, inputValue.trim()]);
          setInputValue('');
        }
        setOpen(false);
      };
      return (
        <div className="relative" ref={containerRef}>
          <div className="flex flex-wrap gap-1 items-center border rounded p-1 bg-white focus-within:ring-2 focus-within:ring-blue-500">
            {value.map((v, idx) => (
              <span key={idx} className="bg-blue-100 text-blue-800 px-2 py-0.5 rounded flex items-center text-xs">
                {v}
                <button type="button" className="ml-1 text-blue-500 hover:text-red-500" onClick={() => handleRemove(v)}>&times;</button>
              </span>
            ))}
            <input
              type="text"
              className="flex-1 min-w-[80px] p-1 outline-none"
              value={inputValue}
              onChange={handleInputChange}
              onKeyDown={handleInputKeyDown}
              onBlur={handleBlur}
              placeholder={placeholder}
              onFocus={() => setOpen(true)}
              autoComplete="off"
            />
          </div>
          {open && (options.length > 0) && (
            <div className="absolute z-10 bg-white border rounded shadow w-full max-h-48 overflow-y-auto mt-1">
              {options.filter(opt => opt.toLowerCase().includes(inputValue.toLowerCase()) && !value.includes(opt)).map((option) => (
                <div
                  key={option}
                  className="px-2 py-1 hover:bg-blue-50 cursor-pointer"
                  onMouseDown={() => handleSelect(option)}
                >
                  {option}
                </div>
              ))}
            </div>
          )}
        </div>
      );
    }

    function App() {
      const [formData, setFormData] = React.useState({
        manufacturer: 'Mahati Industries Pvt. Ltd.',
        customer: '',
        annexureNumber: 'I',
        referenceStandards: 'IS:2026',
        windingMaterial: 'Electrolytic Copper',
        service: 'Outdoor',
        kva: '', // for input field only
        kvaList: [], // new: list of kVA ratings
        hvVoltage: '',
        lvVoltage: '',
        frequency: '50',
        phases: '3',
        voltageVariation: '',
        frequencyVariation: '',
        hvConnection: 'Delta',
        lvConnection: 'Star',
        vectorGroup: [],
        lv1Connection: '',
        lv2Connection: '',
        mvConnection: '',
        tertiaryConnection: '',
        tapChangerType: [],
        tapChangerMake: [],
        tappingRange: '',
        tapSteps: '',
        coolingType: [], // now an array of arrays, one per kVA
        topOilTemp: '',
        windingTemp: '',
        impedanceVoltage: '',
        insulationClass: '',
        hvTerminal: 'OIP Bushing',
        lvTerminal: 'Cable Box',
        paint: '',
        length: '',
        width: '',
        height: '',
        coreWindingsWeight: '',
        tankFittingsWeight: '',
        oilMass: '',
        oilMassLitre: '',
        totalWeight: '',
        untankingHeight: '',
        hvCurrent: '',
        lvCurrent: '',
        noLoadLosses: '',
        maxLosses50: '',
        maxLosses100: '',
        hvPowerFreq: '',
        lvPowerFreq: '',
        hvInduced: '',
        lvInduced: '',
        hvImpulse: '',
        lvImpulse: '',
        tapChangerCurrentRating: '',
        tapChangerVoltageRating: '',
        tapChangerControl: '',
        fluxDensity90: '',
        fluxDensity100: '',
        fluxDensity110: '',
        currentDensityHV: '',
        currentDensityLV: '',
        withstandTime: '',
        neutralCT: '',
        hvBushingMake: [],
        hvBushingKV: '',
        hvBushingAmps: '',
        lvBushingMake: [],
        lvBushingRating: '12 KV 2000 A',
        marshallingBoxProtection: 'IP 55',
        magnetisationCurrent: '< 1.5 % of FLRC Approx.',
        auxiliaryLoss: '',
        hvTerminationArrangement: [],
        lvTerminationArrangement: [],
          lv1TerminationArrangement: [],
           lv2TerminationArrangement: [], 
          mvTerminationArrangement: [],
        tertiaryTerminationArrangement: [],
        ambientTemp: '', // new field for ambient temperature
        terminalType: '', // new field for terminal type selection
        detailsOfTanks: {
          typeOfTank: '',
          thicknessSides: '',
          thicknessBottom: '',
          thicknessTopCover: '',
          thicknessRadiators: '',
          material: '',
          materialOfTank: '',
          construction: '',
        },
        coreLaminationMaterial: '',
        coreLaminationThickness: '',
        insulatingMaterialHV: [],
        insulatingMaterialLV: [],
        insulatingMaterialBetweenHVLV: [],
        insulatingMaterialBetweenLVCore: [],
        axialCoilSupportHV: [],
        axialCoilSupportLV: [],
        radialCoilSupportHV: [],
        radialCoilSupportLV: [],
        numBiDirectionalWheels: '',
        trackGaugeTransAxis: '',
        trackGaugeLongAxis: '',
        mogMake: [], // was ''
        mogType: '',
        relayMake: [], // was ''
        relayType: '',
        tempControllerMake: [], // was ''
        tempControllerType: [],
        tempControllerAlarm: [],
        tempControllerTrip: [],
        tempControllerContacts: '',
        tempControllerCurrent: '',
        transportWith: '',
        confirmOverloading: '',
        hotSpotTempLimit: '<105',
        hotSpotTempMax: '<140',
        overVoltage1Percent: '140',
        overVoltage1Duration: '5 seconds',
        overVoltage2Percent: '125',
        overVoltage2Duration: '60 seconds',
        overVoltage3Percent: '110',
        overVoltage3Duration: 'Continuous',
        regulationUPF: '',
        regulationPF08: '',
        insulatingMedium: 'EHV Grade mineral oil conforms IS 335',
        constructionType: 'Core',
        coreJointType: 'Mitered',
        electrostaticShields: 'Yes',
        impedanceTolerance: '',
        noLoadLossTolerance: '',
        auxiliaryLossTolerance: '',
        hvOverloadingCapacity: 'As per IS 6600',
        lvOverloadingCapacity: 'As per IS 6600',
        lv1Voltage: '',
        lv2Voltage: '',
        mvVoltage: '',
        tertiaryVoltage: '',
        mvBushingMake: [],
        mvBushingKV: '',
        mvBushingAmps: '',
        mvBushingRating: '',
        lv1BushingMake: [],
        lv1BushingKV: '',
        lv1BushingAmps: '',
        lv1BushingRating: '',
        lv2BushingMake: [],
        lv2BushingKV: '',
        lv2BushingAmps: '',
        lv2BushingRating: '',
        tertiaryBushingMake: [],
        tertiaryBushingKV: '',
        tertiaryBushingAmps: '',
        tertiaryBushingRating: '',
        numTransformers: '',
        impedanceFor: '',
        prdMake: [],
        insulatingMaterialBetweenHVLV1: [],
        insulatingMaterialBetweenHVLV2: [],
      });
      const [report, setReport] = React.useState(null);
      const [errors, setErrors] = React.useState({});
      const [error, setError] = React.useState('');
      const [registerOutput, setRegisterOutput] = React.useState('');
      // Debug: Monitor report state changes
      React.useEffect(() => {
        console.log('Report state changed:', report);
      }, [report]);
      const [showDimensionsWeight, setShowDimensionsWeight] = React.useState(false);
      const [showAdditionalFittings, setShowAdditionalFittings] = React.useState(false);
      const [newFitting, setNewFitting] = React.useState('');
      const [newFittingQty, setNewFittingQty] = React.useState(1);
      // Add new state for kva input
      const [kvaInput, setKvaInput] = React.useState('');
      // Add new state for editing standard fittings
      const allStandardFittings = [
        'Neutral bushing separately brought out for LV',
        'Lifting Bollard to lift complete transformer',
        'Lifting lug to lift tank cover',
        'Pressure releasing valve',
        'Jacking pads',
        'Two nos. diagonally opposite tank Earthing Terminals',
        'Bidirectional rail rollers (flanged)',
        'Traction eye',
        'Filter valve',
        'Filter cum drain valve',
        'Sampling valves',
        'Bottom oil drain valve plug',
        'Thermometer pocket',
        'Dial type oil temperature indicator with alarm trip contacts',
        'Dial type Winding Temp. Indicator with alarm & trip contacts',
        'Oil drain pipe for OLTC',
        'Conservator',
        '       -- Air cell Rubber (balloon)',
        '       -- Magnetic oil gauge (MOG)',
        '       -- Drain valve',
        '       -- Air release plugs',
        '       -- Breather connecting flange',
        '       -- Silica Gel breather',
        '       -- Pressure gauge connection flange',
        '       -- Inspection cover',
        '       -- Conservator end cover',
        '       -- Air cell lifting supports',
        '       -- Pressure gauge',
        '       -- Air cell (balloon) connecting flange',
        '       -- MOG float with arm',
        'Gas operated Buchholz relay double float type for main tank',
        'Control cubicle cum marshalling box',
        'Rating & diagram plate',
        'Inspection covers for inspection of HV/LV winding',
        'Cooling Fans',
        'Fan Control Cubicle',
        'WTI CT',
        'RTCC panel with AVR',
        'Fixed Ladder',
        'Detachable radiators with valve on top & bottom',
        'Drain & oil filling hole for each radiators',
        'Provision for NIFPS system to tank (Only Provision)'
      ];


      const [editFittings, setEditFittings] = React.useState(false);
      const [selectedFittings, setSelectedFittings] = React.useState(allStandardFittings);
      
      // Function to get dynamic tap changer text based on selected type
      const getTapChangerText = (tapChangerType) => {
        if (!tapChangerType) return '';
        if (tapChangerType === "On load tap changer(OLTC)") {
          return "On Load Tap Changer";
        } else if (tapChangerType === "Off Circuit Tap Changer") {
          return "Off Circuit Tap Changer";
        }
        return tapChangerType;
      };

      // Function to get dynamic termination descriptions
      const getTerminationDescription = (terminationType, terminationArrangement) => {
        if (!terminationArrangement || terminationArrangement.length === 0) {
          return terminationType; // Return original text if no arrangement selected
        }
        
        const arrangements = Array.isArray(terminationArrangement) 
          ? terminationArrangement 
          : [terminationArrangement];
        
        if (arrangements.length === 1) {
          return `${terminationType} - ${arrangements[0]}`;
        } else {
          return `${terminationType} - ${arrangements.join(', ')}`;
        }
      };
      
      // BIL selection state hooks (must be at top level)
      const [selectedHvBil, setSelectedHvBil] = React.useState(null);
      const [selectedLvBil, setSelectedLvBil] = React.useState(null);

      // BIL options and logic for dropdowns (must be at top level, not in any function)
      const bilOptionsTable = {
        110: [
          { impulse: 450, freq: 185 },
          { impulse: 550, freq: 230 }
        ],
        132: [
          { impulse: 550, freq: 230 },
          { impulse: 650, freq: 275 }
        ],
        220: [
          { impulse: 950, freq: 395 },
          { impulse: 1050, freq: 460 }
        ],
        400: [
          { impulse: 1300, freq: 570 },
          { impulse: 1425, freq: 630 }
        ]
      };
      function getFloorBILChoices(voltage) {
        if (isNaN(voltage) || voltage < 110) return null;
        const keys = Object.keys(bilOptionsTable).map(Number).sort((a, b) => a - b);
        let floor = keys[0];
        for (let i = 0; i < keys.length; i++) {
          if (keys[i] <= voltage) floor = keys[i];
        }
        return bilOptionsTable[floor];
      }
      const hvVoltageNum = parseFloat(formData.hvVoltage);
      const lvVoltageNum = parseFloat(formData.lvVoltage);
      const hvBilChoices = getFloorBILChoices(hvVoltageNum);
      const lvBilChoices = getFloorBILChoices(lvVoltageNum);

      const handleAddFitting = () => {
        if (newFitting.trim()) {
          setAdditionalFittings(prev => [...prev, newFitting.trim()]);
          setNewFitting('');
        }
      };

      const handleRemoveFitting = (index) => {
        setAdditionalFittings(prev => prev.filter((_, i) => i !== index));
      };

      const handleInputChange = (e) => {
  const { name, value } = e.target;
  setFormData((prev) => ({ ...prev, [name]: value }));

  setErrors(prevErrors => {
    const newErrors = { ...prevErrors };

    if (name === 'manufacturer' && value) delete newErrors.manufacturer;
    if (name === 'referenceStandards' && value) delete newErrors.referenceStandards;
    if (name === 'windingMaterial' && value) delete newErrors.windingMaterial;
    if (name === 'service' && value) delete newErrors.service;
    if (name === 'kva' && value && !isNaN(parseFloat(value)) && parseFloat(value) > 0) delete newErrors.kva;
    if (name === 'hvVoltage' && value && !isNaN(parseFloat(value)) && parseFloat(value) > 0) delete newErrors.hvVoltage;
    if (name === 'lvVoltage' && value && !isNaN(parseFloat(value)) && parseFloat(value) > 0) delete newErrors.lvVoltage;
    if (name === 'frequency' && value) delete newErrors.frequency;
    if (name === 'phases' && value) delete newErrors.phases;
    if (name === 'hvConnection' && value) delete newErrors.hvConnection;
    if (name === 'lvConnection' && value) delete newErrors.lvConnection;
    if (name === 'lv1Connection' && value) delete newErrors.lv1Connection;
    if (name === 'lv2Connection' && value) delete newErrors.lv2Connection;
    if (name === 'coolingType' && value && value.length > 0) delete newErrors.coolingType;
    if (name === 'topOilTemp' && value && !isNaN(parseFloat(value)) && parseFloat(value) > 0) delete newErrors.topOilTemp;
    if (name === 'windingTemp' && value && !isNaN(parseFloat(value)) && parseFloat(value) > 0) delete newErrors.windingTemp;
    if (name === 'noLoadLosses' && value) delete newErrors.noLoadLosses;
    if (name === 'loadLosses100' && value) delete newErrors.loadLosses100;
    if (name === 'impedanceVoltage' && value) delete newErrors.impedanceVoltage;
    if (name === 'fluxDensity100' && value) delete newErrors.fluxDensity100;
    if (name === 'currentDensityHV' && value) delete newErrors.currentDensityHV;
    if (name === 'currentDensityLV' && value) delete newErrors.currentDensityLV;
    if (name === 'currentDensityLV1' && value) delete newErrors.currentDensityLV1;
    if (name === 'currentDensityLV2' && value) delete newErrors.currentDensityLV2;
    if (name === 'insulationClass' && value) delete newErrors.insulationClass;
    if (name === 'tapChangerType' && value) delete newErrors.tapChangerType;
    if (name === 'neutralCT' && value) delete newErrors.neutralCT;
    if (name === 'marshallingBoxProtection' && value) delete newErrors.marshallingBoxProtection;
    if (name === 'paint' && value) delete newErrors.paint;
    if (name === 'detailsOfTanks.materialOfTank' && value) delete newErrors['detailsOfTanks.materialOfTank'];
    if (name === 'detailsOfTanks.construction' && value) delete newErrors['detailsOfTanks.construction'];
    if (name === 'coreLaminationMaterial' && value) delete newErrors.coreLaminationMaterial;
    if (name === 'insulatingMaterialHV' && value && value.length > 0) delete newErrors.insulatingMaterialHV;
    if (name === 'insulatingMaterialLV' && value && value.length > 0) delete newErrors.insulatingMaterialLV;
    if (name === 'insulatingMaterialLV1' && value && value.length > 0) delete newErrors.insulatingMaterialLV1;
    if (name === 'insulatingMaterialLV2' && value && value.length > 0) delete newErrors.insulatingMaterialLV2;
    if (name === 'insulatingMaterialBetweenHVLV' && value && value.length > 0) delete newErrors.insulatingMaterialBetweenHVLV;
    if (name === 'insulatingMaterialBetweenLVCore' && value && value.length > 0) delete newErrors.insulatingMaterialBetweenLVCore;
    if (name === 'insulatingMaterialBetweenLV1Core' && value && value.length > 0) delete newErrors.insulatingMaterialBetweenLV1Core;
    if (name === 'insulatingMaterialBetweenLV2Core' && value && value.length > 0) delete newErrors.insulatingMaterialBetweenLV2Core;
    if (name === 'axialCoilSupportHV' && value && value.length > 0) delete newErrors.axialCoilSupportHV;
    if (name === 'axialCoilSupportLV' && value && value.length > 0) delete newErrors.axialCoilSupportLV;
    if (name === 'axialCoilSupportLV1' && value && value.length > 0) delete newErrors.axialCoilSupportLV1;
    if (name === 'axialCoilSupportLV2' && value && value.length > 0) delete newErrors.axialCoilSupportLV2;
    if (name === 'radialCoilSupportHV' && value && value.length > 0) delete newErrors.radialCoilSupportHV;
    if (name === 'radialCoilSupportLV' && value && value.length > 0) delete newErrors.radialCoilSupportLV;
    if (name === 'radialCoilSupportLV1' && value && value.length > 0) delete newErrors.radialCoilSupportLV1;
    if (name === 'radialCoilSupportLV2' && value && value.length > 0) delete newErrors.radialCoilSupportLV2;
    if (name === 'numBiDirectionalWheels' && value) delete newErrors.numBiDirectionalWheels;
    if (name === 'lv1Voltage' && value && !isNaN(parseFloat(value)) && parseFloat(value) > 0) delete newErrors.lv1Voltage;
if (name === 'lv2Voltage' && value && !isNaN(parseFloat(value)) && parseFloat(value) > 0) delete newErrors.lv2Voltage;
if (name === 'mvVoltage' && value && !isNaN(parseFloat(value)) && parseFloat(value) > 0) delete newErrors.mvVoltage;
if (name === 'tertiaryVoltage' && value && !isNaN(parseFloat(value)) && parseFloat(value) > 0) delete newErrors.tertiaryVoltage;
if (name === 'vectorGroup' && value && value.length > 0) delete newErrors.vectorGroup;

if (name === 'vectorGroup' && value) delete newErrors.vectorGroup;
if (name === 'radialCoilSupportTertiary' && value && value.length > 0) delete newErrors.radialCoilSupportTertiary;
if (name === 'axialCoilSupportTertiary' && value && value.length > 0) delete newErrors.axialCoilSupportTertiary;
if (name === 'tapChangerType' && value) delete newErrors.tapChangerType;
if (name === 'tapChangerMake' && value && value.length > 0) delete newErrors.tapChangerMake;
if (name === 'tappingRange' && value) delete newErrors.tappingRange;
if (name === 'tapSteps' && value) delete newErrors.tapSteps;
if (name === 'tapChangerCurrentRating' && value) delete newErrors.tapChangerCurrentRating;
if (name === 'tapChangerVoltageRating' && value) delete newErrors.tapChangerVoltageRating;
if (name === 'tapChangerControl' && value && value.length > 0) delete newErrors.tapChangerControl;
if (name === 'insulatingMaterialTertiary' && value && value.length > 0) delete newErrors.insulatingMaterialTertiary;
if (name === 'ambientTemp' && value && !isNaN(parseFloat(value))) delete newErrors.ambientTemp;
if (name === 'coreLaminationThickness' && value) delete newErrors.coreLaminationThickness;
if (name === 'auxiliaryLoss' && value) delete newErrors.auxiliaryLoss;

if (name === 'fluxDensity90' && value) delete newErrors.fluxDensity90;
if (name === 'fluxDensity100' && value) delete newErrors.fluxDensity100;
if (name === 'fluxDensity110' && value) delete newErrors.fluxDensity110;
if (name === 'typeOfTank' && value) delete newErrors.typeOfTank;
if (name === 'thicknessSides' && value) delete newErrors.thicknessSides;
if (name === 'thicknessBottom' && value) delete newErrors.thicknessBottom;
if (name === 'thicknessTopCover' && value) delete newErrors.thicknessTopCover;
if (name === 'thicknessRadiators' && value) delete newErrors.thicknessRadiators;
if (name === 'withstandTime' && value) delete newErrors.withstandTime;
if (name === 'mvConnection' && value) delete newErrors.mvConnection;
if (name === 'tertiaryConnection' && value) delete newErrors.tertiaryConnection;
// Bushings HV
if (name === 'hvBushingMake' && value) delete newErrors.hvBushingMake;
if (name === 'hvBushingKV' && value) delete newErrors.hvBushingKV;
if (name === 'hvBushingAmps' && value) delete newErrors.hvBushingAmps;

// Bushings LV
if (name === 'lvBushingMake' && value) delete newErrors.lvBushingMake;
if (name === 'lvBushingKV' && value) delete newErrors.lvBushingKV;
if (name === 'lvBushingAmps' && value) delete newErrors.lvBushingAmps;

// Bushings LV1
if (name === 'lv1BushingMake' && value) delete newErrors.lv1BushingMake;
if (name === 'lv1BushingKV' && value) delete newErrors.lv1BushingKV;
if (name === 'lv1BushingAmps' && value) delete newErrors.lv1BushingAmps;

// Bushings LV2
if (name === 'lv2BushingMake' && value) delete newErrors.lv2BushingMake;
if (name === 'lv2BushingKV' && value) delete newErrors.lv2BushingKV;
if (name === 'lv2BushingAmps' && value) delete newErrors.lv2BushingAmps;

// Bushings MV
if (name === 'mvBushingMake' && value) delete newErrors.mvBushingMake;
if (name === 'mvBushingKV' && value) delete newErrors.mvBushingKV;
if (name === 'mvBushingAmps' && value) delete newErrors.mvBushingAmps;

// Bushings TV
if (name === 'tvBushingMake' && value) delete newErrors.tvBushingMake;
if (name === 'tvBushingKV' && value) delete newErrors.tvBushingKV;
if (name === 'tvBushingAmps' && value) delete newErrors.tvBushingAmps;

if (name === 'marshallingBoxProtection' && value) delete newErrors.marshallingBoxProtection;

if (name === 'magnetisationCurrent' && value) delete newErrors.magnetisationCurrent;
if (name === 'insulatingMaterialBetweenHVLV2' && value && value.length > 0) delete newErrors.insulatingMaterialBetweenHVLV2;
if (name === 'insulatingMaterialBetweenHVLV1' && value && value.length > 0) delete newErrors.insulatingMaterialBetweenHVLV1;
if (name === 'insulatingMaterialBetweenHVMV' && value && value.length > 0) delete newErrors.insulatingMaterialBetweenHVMV;
if (name === 'insulatingMaterialBetweenHVTertiary' && value && value.length > 0) delete newErrors.insulatingMaterialBetweenHVTertiary;
if (name === 'insulatingMaterialBetweenMVCore' && value && value.length > 0) delete newErrors.insulatingMaterialBetweenMVCore;
if (name === 'insulatingMaterialBetweenTertiaryCore' && value && value.length > 0) delete newErrors.insulatingMaterialBetweenTertiaryCore;
// Termination Arrangements
if (name === 'hvTerminationArrangement' && value) delete newErrors.hvTerminationArrangement;
if (name === 'lvTerminationArrangement' && value) delete newErrors.lvTerminationArrangement;
if (name === 'lv1TerminationArrangement' && value) delete newErrors.lv1TerminationArrangement;
if (name === 'lv2TerminationArrangement' && value) delete newErrors.lv2TerminationArrangement;
if (name === 'mvTerminationArrangement' && value) delete newErrors.mvTerminationArrangement;
if (name === 'tvTerminationArrangement' && value) delete newErrors.tvTerminationArrangement;
if (name === 'detailsOfTanks.construction' && value) delete newErrors.tankConstruction;

if (name === 'coreLaminationMaterial' && value) delete newErrors.coreLaminationMaterial;

if (name === 'mogType' && value) delete newErrors.mogType;
if (name === 'mogMake' && value) delete newErrors.mogMake;
if (name === 'numTransformers' && value && !isNaN(parseInt(value)) && parseInt(value) > 0) {
  delete newErrors.numTransformers;
}
if (name === 'relayType' && value) delete newErrors.relayType;
if (name === 'relayMake' && value && value.length > 0) delete newErrors.relayMake;

if (name === 'tempControllerType' && value) delete newErrors.tempControllerType;
if (name === 'tempControllerMake' && value && value.length > 0) delete newErrors.tempControllerMake;


if (name === 'prdMake' && value && value.length > 0) delete newErrors.prdMake;
if (name === 'coreLaminationMaterial' && value) delete newErrors.coreLaminationMaterial;
if (name === 'coreLaminationThickness' && value) delete newErrors.coreLaminationThickness;
if (name === 'hotSpotTempLimit' && value) delete newErrors.hotSpotTempLimit;
if (name === 'axialCoilSupportMV' && value && value.length > 0) delete newErrors.axialCoilSupportMV;
if (name === 'radialCoilSupportMV' && value && value.length > 0) delete newErrors.radialCoilSupportMV;
if (name === 'insulatingMaterialMV' && value && value.length > 0) delete newErrors.insulatingMaterialMV;
if (name === 'tertiaryBushingMake' && value) delete newErrors.tertiaryBushingMake;
if (name === 'tertiaryBushingKV' && value) delete newErrors.tertiaryBushingKV;
if (name === 'tertiaryBushingAmps' && value) delete newErrors.tertiaryBushingAmps;
if (name === 'tertiaryTerminationArrangement' && value) delete newErrors.tertiaryTerminationArrangement;

    return newErrors;
  });
};
      // Add handler to add kva
      const handleAddKva = () => {
        const val = parseFloat(kvaInput);
        if (!isNaN(val) && val > 0 && !formData.kvaList.includes(val)) {
          setFormData(prev => ({ ...prev, kvaList: [...prev.kvaList, val] }));
          setKvaInput('');
        }
      };
      // Remove kva
      const handleRemoveKva = (idx) => {
        setFormData(prev => ({ ...prev, kvaList: prev.kvaList.filter((_, i) => i !== idx) }));
      };

      // Auto-calculate totalWeight
      React.useEffect(() => {
        const core = parseFloat(formData.coreWindingsWeight);
        const tank = parseFloat(formData.tankFittingsWeight);
        const oil = parseFloat(formData.oilMass);
        if (!isNaN(core) && !isNaN(tank) && !isNaN(oil)) {
          setFormData(prev => ({ ...prev, totalWeight: (core + tank + oil).toFixed(2) }));
        } else {
          setFormData(prev => ({ ...prev, totalWeight: '' }));
        }
      }, [formData.coreWindingsWeight, formData.tankFittingsWeight, formData.oilMass]);

      const calculateParameters = () => {
        console.log('Calculate Parameters called');
        console.log('Form Data:', formData);
        console.log('relayType:', formData.relayType, 'relayMake:', formData.relayMake);
        console.log('tempControllerType:', formData.tempControllerType, 'tempControllerMake:', formData.tempControllerMake);

        const newErrors = {};

        // Compulsory fields validation (field-by-field)
        if (!formData.manufacturer) newErrors.manufacturer = 'Name of the Manufacturer is required';
        if (!formData.referenceStandards) newErrors.referenceStandards = 'Reference Standard is required';
        if (!formData.windingMaterial) newErrors.windingMaterial = 'Winding Material is required';
        if (!formData.service) newErrors.service = 'Service is required';
        if ((formData.kvaList.length === 0) && (!formData.kva || isNaN(parseFloat(formData.kva)) || parseFloat(formData.kva) <= 0)) newErrors.kva = 'kVA Rating is required';
        if (!formData.hvVoltage || isNaN(parseFloat(formData.hvVoltage)) || parseFloat(formData.hvVoltage) <= 0) newErrors.hvVoltage = 'Rated Voltage (HV) is required';
        // LV voltage validation - only required if LV1/LV2 is NOT selected
        if (!extraVoltageFields.lv1lv2) {
          if (!formData.lvVoltage || isNaN(parseFloat(formData.lvVoltage)) || parseFloat(formData.lvVoltage) <= 0) newErrors.lvVoltage = 'Rated Voltage (LV) is required';
        }
        // 9. Rated voltage LV1, LV2, MV, TV
        if (extraVoltageFields.lv1lv2 && (!formData.lv1Voltage || isNaN(parseFloat(formData.lv1Voltage)) || parseFloat(formData.lv1Voltage) <= 0)) newErrors.lv1Voltage = 'Rated Voltage (LV1) is required';
        if (extraVoltageFields.lv1lv2 && (!formData.lv2Voltage || isNaN(parseFloat(formData.lv2Voltage)) || parseFloat(formData.lv2Voltage) <= 0)) newErrors.lv2Voltage = 'Rated Voltage (LV2) is required';
        if (extraVoltageFields.mv && (!formData.mvVoltage || isNaN(parseFloat(formData.mvVoltage)) || parseFloat(formData.mvVoltage) <= 0)) newErrors.mvVoltage = 'Rated Voltage (MV) is required';
        if (extraVoltageFields.tertiary && (!formData.tertiaryVoltage || isNaN(parseFloat(formData.tertiaryVoltage)) || parseFloat(formData.tertiaryVoltage) <= 0)) newErrors.tertiaryVoltage = 'Rated Voltage (TV) is required';
        if (extraVoltageFields.mv && (!formData.axialCoilSupportMV || formData.axialCoilSupportMV.length === 0)) newErrors.axialCoilSupportMV = 'Type of Axial Coil Supports MV is required';
        if (extraVoltageFields.mv && (!formData.radialCoilSupportMV || formData.radialCoilSupportMV.length === 0)) newErrors.radialCoilSupportMV = 'Type of Radial Coil Supports MV is required';
        if (extraVoltageFields.mv && (!formData.insulatingMaterialMV || formData.insulatingMaterialMV.length === 0)) newErrors.insulatingMaterialMV = 'Insulation Material Used For MV is required';
        if (!formData.vectorGroup) newErrors.vectorGroup = 'Vector Group is required';
        if (!formData.tapChangerType) newErrors.tapChangerType = 'Tap Changer Type is required';
        if (!formData.tapChangerMake || formData.tapChangerMake.length === 0) newErrors.tapChangerMake = 'Tap Changer Make is required';
        if (!formData.tappingRange) newErrors.tappingRange = 'Tapping Range is required';
        if (!formData.tapSteps) newErrors.tapSteps = 'Tap Steps/Position is required';
        if (!formData.tapChangerCurrentRating) newErrors.tapChangerCurrentRating = 'Tap Changer Current Rating is required';
        if (!formData.tapChangerVoltageRating) newErrors.tapChangerVoltageRating = 'Tap Changer Voltage Rating is required';
        if (!formData.tapChangerControl || formData.tapChangerControl.length === 0) newErrors.tapChangerControl = 'Tap Changer Control is required';
        if (!formData.coreLaminationMaterial) newErrors.coreLaminationMaterial = 'Material of Core Laminations is required';
        if (!formData.coreLaminationThickness) newErrors.coreLaminationThickness = 'Thickness of Core Laminations is required';
        if (!formData.ambientTemp || isNaN(parseFloat(formData.ambientTemp))) newErrors.ambientTemp = 'Ambient Temperature is required';

        if (!formData.auxiliaryLoss) newErrors.auxiliaryLoss = 'Auxiliary Loss is required';
        
        if (!formData.fluxDensity90) newErrors.fluxDensity90 = 'Flux Density at 90% is required';
        if (!formData.fluxDensity100) newErrors.fluxDensity100 = 'Flux Density at 100% is required';
        if (!formData.fluxDensity110) newErrors.fluxDensity110 = 'Flux Density at 110% is required';
        if (extraVoltageFields.tertiary && (!formData.radialCoilSupportTertiary || formData.radialCoilSupportTertiary.length === 0)) newErrors.radialCoilSupportTertiary = 'Type of Radial Coil Supports Tertiary is required';
        if (extraVoltageFields.tertiary && (!formData.axialCoilSupportTertiary || formData.axialCoilSupportTertiary.length === 0)) newErrors.axialCoilSupportTertiary = 'Type of Axial Coil Supports Tertiary is required';
        if (extraVoltageFields.tertiary && (!formData.insulatingMaterialTertiary || formData.insulatingMaterialTertiary.length === 0)) newErrors.insulatingMaterialTertiary = 'Insulation Material Used For Tertiary is required';
        if (!formData.coreLaminationThickness) newErrors.coreLaminationThickness = 'Thickness of Core Laminations is required';
        if (!formData.detailsOfTanks || !formData.detailsOfTanks.thicknessSides) newErrors.thicknessSides = 'Thickness of Sides is required';
        if (!formData.detailsOfTanks || !formData.detailsOfTanks.thicknessBottom) newErrors.thicknessBottom = 'Thickness of Bottom is required';
        if (!formData.detailsOfTanks || !formData.detailsOfTanks.thicknessTopCover) newErrors.thicknessTopCover = 'Thickness of Top Cover is required';
        if (!formData.detailsOfTanks || !formData.detailsOfTanks.thicknessRadiators) newErrors.thicknessRadiators = 'Thickness of Radiators is required';
        if (!formData.withstandTime) newErrors.withstandTime = 'Withstand Time is required';
        if (extraVoltageFields.mv && !formData.mvConnection) newErrors.mvConnection = 'MV Connection is required';
        if (extraVoltageFields.tertiary && !formData.tertiaryConnection) newErrors.tertiaryConnection = 'Tertiary Connection is required';
        // 28-29. Bushings HV, LV, LV1, LV2, MV, TV

        // HV
        if (!formData.hvBushingMake || formData.hvBushingMake.length === 0) newErrors.hvBushingMake = 'HV Bushing Make is required';
        if (!formData.hvBushingKV) newErrors.hvBushingKV = 'HV Bushing KV is required';
        if (!formData.hvBushingAmps) newErrors.hvBushingAmps = 'HV Bushing Amps is required';

        // LV (only if LV1/LV2 is NOT selected)
        if (!extraVoltageFields.lv1lv2) {
          if (!formData.lvBushingMake || formData.lvBushingMake.length === 0) newErrors.lvBushingMake = 'LV Bushing Make is required';
          if (!formData.lvBushingKV) newErrors.lvBushingKV = 'LV Bushing KV is required';
          if (!formData.lvBushingAmps) newErrors.lvBushingAmps = 'LV Bushing Amps is required';
          if (!formData.lvTerminationArrangement) newErrors.lvTerminationArrangement = 'LV Termination Arrangement is required';
        }

       // LV1 (if applicable)
        if (extraVoltageFields.lv1lv2) {
          if (!formData.lv1BushingMake || formData.lv1BushingMake.length === 0) newErrors.lv1BushingMake = 'LV1 Bushing Make is required';
          if (!formData.lv1BushingKV) newErrors.lv1BushingKV = 'LV1 Bushing KV is required';
          if (!formData.lv1BushingAmps) newErrors.lv1BushingAmps = 'LV1 Bushing Amps is required';

         // LV2
          if (!formData.lv2BushingMake || formData.lv2BushingMake.length === 0) newErrors.lv2BushingMake = 'LV2 Bushing Make is required';
          if (!formData.lv2BushingKV) newErrors.lv2BushingKV = 'LV2 Bushing KV is required';
          if (!formData.lv2BushingAmps) newErrors.lv2BushingAmps = 'LV2 Bushing Amps is required';
        }

      // MV (if applicable)
        if (extraVoltageFields.mv) {
          if (!formData.mvBushingMake || formData.mvBushingMake.length === 0) newErrors.mvBushingMake = 'MV Bushing Make is required';
          if (!formData.mvBushingKV) newErrors.mvBushingKV = 'MV Bushing KV is required';
          if (!formData.mvBushingAmps) newErrors.mvBushingAmps = 'MV Bushing Amps is required';
        }

          // TV (if applicable)
        if (extraVoltageFields.tertiary) {
          if (!formData.tertiaryBushingMake || formData.tertiaryBushingMake.length === 0) newErrors.tertiaryBushingMake = 'Tertiary Bushing Make is required';
          if (!formData.tertiaryBushingKV) newErrors.tertiaryBushingKV = 'Tertiary Bushing KV is required';
          if (!formData.tertiaryBushingAmps) newErrors.tertiaryBushingAmps = 'Tertiary Bushing Amps is required';
        }

       // 30. Marshalling Box Degree of Protection
        if (!formData.marshallingBoxProtection) newErrors.marshallingBoxProtection = 'Marshalling Box Degree of Protection is required';

       // 31. Magnetisation Current
        if (!formData.magnetisationCurrent) newErrors.magnetisationCurrent = 'Magnetisation Current is required';

        // 32. Termination Types HV, LV, LV1, LV2, MV, TV

if (!formData.hvTerminationArrangement || formData.hvTerminationArrangement.length === 0) {
  newErrors.hvTerminationArrangement = 'HV Termination Arrangement is required';
}

if (!extraVoltageFields.lv1lv2) {
  if (!formData.lvTerminationArrangement || formData.lvTerminationArrangement.length === 0) {
    newErrors.lvTerminationArrangement = 'LV Termination Arrangement is required';
  }
} else {
  if (!formData.lv1TerminationArrangement || formData.lv1TerminationArrangement.length === 0) {
    newErrors.lv1TerminationArrangement = 'LV1 Termination Arrangement is required';
  }
  if (!formData.lv2TerminationArrangement || formData.lv2TerminationArrangement.length === 0) {
    newErrors.lv2TerminationArrangement = 'LV2 Termination Arrangement is required';
  }
}

if (extraVoltageFields.mv && (!formData.mvTerminationArrangement || formData.mvTerminationArrangement.length === 0)) {
  newErrors.mvTerminationArrangement = 'MV Termination Arrangement is required';
}

if (extraVoltageFields.tertiary && (!formData.tertiaryTerminationArrangement || formData.tertiaryTerminationArrangement.length === 0)) {
  newErrors.tertiaryTerminationArrangement = 'Tertiary Termination Arrangement is required';
}
       // 34. Details of Tanks b. Construction
        if (!formData.detailsOfTanks.construction) newErrors.tankConstruction = 'Tank Construction is required';

        if (!formData.coreLaminationMaterial) newErrors.coreLaminationMaterial = 'Core Lamination Material is required';

        if (!formData.mogType) newErrors.mogType = 'MOG Type is required';
        if (!isValidMultiValue(formData.mogMake)) newErrors.mogMake = 'MOG Make is required';

        if (!formData.relayType) newErrors.relayType = 'Gas and Oil Relay Type is required';
        if (!isValidMultiValue(formData.relayMake)) newErrors.relayMake = 'Gas and Oil Relay Make is required';

        if (!formData.tempControllerType || formData.tempControllerType.length === 0) newErrors.tempControllerType = 'Temperature Indicator Type is required';
        if (!isValidMultiValue(formData.tempControllerMake)) newErrors.tempControllerMake = 'Temperature Indicator Make is required';


        if (!isValidMultiValue(formData.prdMake)) newErrors.prdMake = 'PRD Make is required';

        if (!formData.hotSpotTempLimit) newErrors.hotSpotTempLimit = 'Hot Spot Temperature Limit is required';
        if (!formData.frequency) newErrors.frequency = 'Rated Frequency is required';
        if (!formData.phases) newErrors.phases = 'Number of Phase is required';
        if (!formData.hvConnection) newErrors.hvConnection = 'Winding Connection (HV) is required';
        if (!formData.lvConnection && !extraVoltageFields.lv1lv2) newErrors.lvConnection = 'Winding Connection (LV) is required';
        if (!formData.lv1Connection && extraVoltageFields.lv1lv2) newErrors.lv1Connection = 'Winding Connection (LV1) is required';
        if (!formData.lv2Connection && extraVoltageFields.lv1lv2) newErrors.lv2Connection = 'Winding Connection (LV2) is required';
        if (!formData.coolingType || (Array.isArray(formData.coolingType) && formData.coolingType.length === 0)) newErrors.coolingType = 'Type of Cooling is required';
        if (!formData.topOilTemp || isNaN(parseFloat(formData.topOilTemp)) || parseFloat(formData.topOilTemp) <= 0) newErrors.topOilTemp = 'Temperature Rise Above is required';
        if (!formData.windingTemp || isNaN(parseFloat(formData.windingTemp)) || parseFloat(formData.windingTemp) <= 0) newErrors.windingTemp = 'Temperature Rise Above is required';
        if (!formData.noLoadLosses) newErrors.noLoadLosses = 'Losses in kW (Subject to IS Tol) is required';
        if (!formData.loadLosses100) newErrors.loadLosses100 = 'Losses (Load Loss at 100%) is required';
        if (!formData.impedanceVoltage) newErrors.impedanceVoltage = 'Impedance Voltage at 75C is required';
        if (!formData.fluxDensity100) newErrors.fluxDensity100 = 'Flux Density at 100% is required';
        if (!formData.currentDensityHV) newErrors.currentDensityHV = 'Current Density (HV) is required';
        // Current Density LV/LV1/LV2
        if (!extraVoltageFields.lv1lv2) {
          if (!formData.currentDensityLV) newErrors.currentDensityLV = 'Current Density (LV) is required';
        } else {
          if (!formData.currentDensityLV1) newErrors.currentDensityLV1 = 'Current Density (LV1) is required';
          if (!formData.currentDensityLV2) newErrors.currentDensityLV2 = 'Current Density (LV2) is required';
        }
        if (!formData.numTransformers || isNaN(parseInt(formData.numTransformers)) || parseInt(formData.numTransformers) <= 0) {
            newErrors.numTransformers = 'Number of transformers required is required';
           }
        if (!formData.insulationClass) newErrors.insulationClass = 'Winding Insulation Material Class is required';
        if (!formData.tapChangerType) newErrors.tapChangerType = 'Type of Tap Changer is required';
        if (!formData.neutralCT) newErrors.neutralCT = 'Neutral Terminal Bushing Current Transformer is required';
        if (!formData.marshallingBoxProtection) newErrors.marshallingBoxProtection = 'Marshalling Box Degree of Protection is required';
        if (!formData.paint) newErrors.paint = 'Paint Type is required';
        if (!formData.detailsOfTanks.materialOfTank) newErrors.materialOfTank = 'Material of Tank is required';
        if (!formData.detailsOfTanks.construction) newErrors.tankConstruction = 'Tank Construction is required';

        if (!formData.insulatingMaterialHV || formData.insulatingMaterialHV.length === 0) newErrors.insulatingMaterialHV = 'Insulation Material Used For HV is required';
        // Insulation Material Used For LV/LV1/LV2
        if (!extraVoltageFields.lv1lv2) {
          if (!formData.insulatingMaterialLV || formData.insulatingMaterialLV.length === 0) newErrors.insulatingMaterialLV = 'Insulation Material Used For LV is required';
        } else {
          if (!formData.insulatingMaterialLV1 || formData.insulatingMaterialLV1.length === 0) newErrors.insulatingMaterialLV1 = 'Insulation Material Used For LV1 is required';
          if (!formData.insulatingMaterialLV2 || formData.insulatingMaterialLV2.length === 0) newErrors.insulatingMaterialLV2 = 'Insulation Material Used For LV2 is required';
        }
        if (!formData.insulatingMaterialBetweenHVLV || formData.insulatingMaterialBetweenHVLV.length === 0) newErrors.insulatingMaterialBetweenHVLV = 'Insulation Material Used Between HV-LV is required';
        // Insulation Material Used Between LV-Core/LV1-Core/LV2-Core
        if (!extraVoltageFields.lv1lv2) {
          if (!formData.insulatingMaterialBetweenLVCore || formData.insulatingMaterialBetweenLVCore.length === 0) newErrors.insulatingMaterialBetweenLVCore = 'Insulation Material Used Between LV-Core is required';
        } else {
          if (!formData.insulatingMaterialBetweenLV1Core || formData.insulatingMaterialBetweenLV1Core.length === 0) newErrors.insulatingMaterialBetweenLV1Core = 'Insulation Material Used Between LV1-Core is required';
          if (!formData.insulatingMaterialBetweenLV2Core || formData.insulatingMaterialBetweenLV2Core.length === 0) newErrors.insulatingMaterialBetweenLV2Core = 'Insulation Material Used Between LV2-Core is required';
        }
        if (extraVoltageFields.lv1lv2 && (!formData.insulatingMaterialBetweenHVLV2 || formData.insulatingMaterialBetweenHVLV2.length === 0)) {
          newErrors.insulatingMaterialBetweenHVLV2 = 'Insulation Material between HV and LV2 is required';
        }
        if (extraVoltageFields.mv && (!formData.insulatingMaterialBetweenHVMV || formData.insulatingMaterialBetweenHVMV.length === 0)) {
          newErrors.insulatingMaterialBetweenHVMV = 'Insulation Material between HV and MV is required';
        }
        if (extraVoltageFields.tertiary && (!formData.insulatingMaterialBetweenHVTertiary || formData.insulatingMaterialBetweenHVTertiary.length === 0)) {
          newErrors.insulatingMaterialBetweenHVTertiary = 'Insulation Material between HV and Tertiary is required';
        }
        if (extraVoltageFields.mv && (!formData.insulatingMaterialBetweenMVCore || formData.insulatingMaterialBetweenMVCore.length === 0)) {
          newErrors.insulatingMaterialBetweenMVCore = 'Insulation Material between MV winding and core is required';
        }
        if (extraVoltageFields.tertiary && (!formData.insulatingMaterialBetweenTertiaryCore || formData.insulatingMaterialBetweenTertiaryCore.length === 0)) {
          newErrors.insulatingMaterialBetweenTertiaryCore = 'Insulation Material between Tertiary winding and core is required';
        }
        if (!formData.axialCoilSupportHV || formData.axialCoilSupportHV.length === 0) newErrors.axialCoilSupportHV = 'Type of Axial Coil Supports HV is required';
        // Axial Coil Supports LV/LV1/LV2
        if (!extraVoltageFields.lv1lv2) {
          if (!formData.axialCoilSupportLV || formData.axialCoilSupportLV.length === 0) newErrors.axialCoilSupportLV = 'Type of Axial Coil Supports LV is required';
        } else {
          if (!formData.axialCoilSupportLV1 || formData.axialCoilSupportLV1.length === 0) newErrors.axialCoilSupportLV1 = 'Type of Axial Coil Supports LV1 is required';
          if (!formData.axialCoilSupportLV2 || formData.axialCoilSupportLV2.length === 0) newErrors.axialCoilSupportLV2 = 'Type of Axial Coil Supports LV2 is required';
        }
        if (!formData.radialCoilSupportHV || formData.radialCoilSupportHV.length === 0) newErrors.radialCoilSupportHV = 'Type of Radial Coil Supports HV is required';
        // Radial Coil Supports LV/LV1/LV2
        if (!extraVoltageFields.lv1lv2) {
          if (!formData.radialCoilSupportLV || formData.radialCoilSupportLV.length === 0) newErrors.radialCoilSupportLV = 'Type of Radial Coil Supports LV is required';
        } else {
          if (!formData.radialCoilSupportLV1 || formData.radialCoilSupportLV1.length === 0) newErrors.radialCoilSupportLV1 = 'Type of Radial Coil Supports LV1 is required';
          if (!formData.radialCoilSupportLV2 || formData.radialCoilSupportLV2.length === 0) newErrors.radialCoilSupportLV2 = 'Type of Radial Coil Supports LV2 is required';
        }
        if (!formData.numBiDirectionalWheels) newErrors.numBiDirectionalWheels = 'No of Bi-directional Wheels Provided is required';
        // Add more as needed for your compulsory list

        if (Object.keys(newErrors).length > 0) {
          console.log('Validation errors:', newErrors);
          setErrors(newErrors);
          setError('Please fill all required fields marked with *');
          return;
        }
        // If no errors, clear all error states
        setErrors({});
        setError('');
        console.log('Starting calculations...');

        // Use the highest kVA for calculations
        const kva = formData.kvaList.length > 0 ? Math.max(...formData.kvaList) : parseFloat(formData.kva);
        if (isNaN(kva) || kva <= 0) {
          setError('Please enter a valid kVA rating (> 0).');
          return;
        }
        let hvVoltage = parseFloat(formData.hvVoltage);
        let lvVoltage = extraVoltageFields.lv1lv2 ? null : parseFloat(formData.lvVoltage);

        // If HV voltage is less than LV voltage, swap them for calculation
        if (!extraVoltageFields.lv1lv2 && !isNaN(hvVoltage) && !isNaN(lvVoltage) && hvVoltage < lvVoltage) {
          const temp = hvVoltage;
          hvVoltage = lvVoltage;
          lvVoltage = temp;
        }

        const phases = parseInt(formData.phases);
        let hvCurrent, lvCurrent;
        if (phases === 3) {
          hvCurrent = (kva * 1000) / (Math.sqrt(3) * hvVoltage * 1000);
          lvCurrent = lvVoltage ? (kva * 1000) / (Math.sqrt(3) * lvVoltage * 1000) : null;
        } else {
          hvCurrent = (kva * 1000) / (hvVoltage * 1000);
          lvCurrent = lvVoltage ? (kva * 1000) / (lvVoltage * 1000) : null;
        }

        // Use user input for losses, do not auto-calculate
        const noLoadLosses = parseFloat(formData.noLoadLosses); // in kW
        const loadLosses100 = parseFloat(formData.loadLosses100); // in kW
        const loadLosses50 = loadLosses100 * 0.25;
        const maxLosses100 = noLoadLosses + loadLosses100;
        const maxLosses50 = noLoadLosses + loadLosses50;

        // Correct efficiency calculation
        const calculateEfficiency = (loadFraction, powerFactor) => {
          const nll = parseFloat(noLoadLosses) * 1000; // kW to W
          const ll = parseFloat(loadLosses100) * 1000; // kW to W
          const k = parseFloat(kva);
          if (isNaN(nll) || isNaN(ll) || isNaN(k) || k <= 0) return '';
          const outputPower = k * loadFraction * powerFactor * 1000; // in W
          const totalLosses = nll + ll * loadFraction * loadFraction;
          if (outputPower + totalLosses === 0) return '';
          return ((outputPower / (outputPower + totalLosses)) * 100).toFixed(4);
        };

        const efficiencyUPF100 = calculateEfficiency(1, 1);
        const efficiencyUPF75 = calculateEfficiency(0.75, 1);
        const efficiencyUPF50 = calculateEfficiency(0.5, 1);
        const efficiencyUPF25 = calculateEfficiency(0.25, 1);
        const efficiencyPF08_100 = calculateEfficiency(1, 0.8);
        const efficiencyPF08_75 = calculateEfficiency(0.75, 0.8);
        const efficiencyPF08_50 = calculateEfficiency(0.5, 0.8);
        const efficiencyPF08_25 = calculateEfficiency(0.25, 0.8);

        const impedanceVoltage = parseFloat(formData.impedanceVoltage);
        
        // Updated regulation calculation
        const calculateRegulation = (powerFactor) => {
          // Use the highest kVA for regulation calculation
          const k = formData.kvaList.length > 0 ? Math.max(...formData.kvaList) : parseFloat(formData.kva);
          const ll100 = parseFloat(formData.loadLosses100);
          const z = parseFloat(formData.impedanceVoltage);
          if (isNaN(k) || k <= 0 || isNaN(ll100) || isNaN(z) || z <= 0) return '-';
          // Calculate equivalent resistance in percentage
          const resistancePercent = (ll100 * 100) / k;
          // Calculate equivalent reactance in percentage
          const reactancePercent = Math.sqrt(Math.max(0, z * z - resistancePercent * resistancePercent));
          // Calculate power factor angle
          const cosPhi = powerFactor;
          const sinPhi = Math.sqrt(1 - cosPhi * cosPhi);
          // Linear term
          const linearTerm = resistancePercent * cosPhi + reactancePercent * sinPhi;
          // Quadratic term for higher accuracy
          const quadraticTerm = ((reactancePercent * cosPhi - resistancePercent * sinPhi) ** 2) / 200;
          // Total regulation
          const regulation = linearTerm + quadraticTerm;
          return isNaN(regulation) ? '-' : regulation.toFixed(4);
        };
        
        const regulationUPF = calculateRegulation(1.0);
        const regulationPF08 = calculateRegulation(0.8);

        // Replace closestHV and closestLV logic with ceiling logic for insulationLevels
        const getCeilingKey = (levels, voltage) => {
          // levels: array of numbers, voltage: number
          return levels.filter(v => v >= voltage).sort((a, b) => a - b)[0] || Math.max(...levels);
        };

        const insulationHV = getInsulationLevel(hvVoltage);
        
        // Only calculate LV insulation if LV voltage is available
        let insulationLV = null;
        if (lvVoltage) {
          insulationLV = getInsulationLevel(lvVoltage);
        }

        const minimumClearances = [
          { BIL: 75,   phaseToPhase: 280,  phaseToEarth: 140 },
          { BIL: 125,  phaseToPhase: 330,  phaseToEarth: 230 },
          { BIL: 170,  phaseToPhase: 350,  phaseToEarth: 320 },
          { BIL: 250,  phaseToPhase: 530,  phaseToEarth: 480 },
          { BIL: 325,  phaseToPhase: 700,  phaseToEarth: 660 },
          { BIL: 550,  phaseToPhase: 1220, phaseToEarth: 1050 },
          { BIL: 650,  phaseToPhase: 1430, phaseToEarth: 1270 },
          { BIL: 950,  phaseToPhase: 2000, phaseToEarth: 1800 },
          { BIL: 1050, phaseToPhase: 2350, phaseToEarth: 2150 },
          { BIL: 1425, phaseToPhase: 4000, phaseToEarth: 3500 },
          { BIL: 1950, phaseToPhase: 6700, phaseToEarth: 5800 }
        ];

        // New voltage-based minimum clearances for lower voltage ranges
        const voltageBasedClearances = {
          0: { phaseToPhase: 25, phaseToEarth: 20 },
          1.1: { phaseToPhase: 30, phaseToEarth: 25 },
          3.6: { phaseToPhase: 75, phaseToEarth: 60 },
          7.2: { phaseToPhase: 120, phaseToEarth: 90 },
          12: { phaseToPhase: 280, phaseToEarth: 140 },
          24: { phaseToPhase: 330, phaseToEarth: 230 },
          36: { phaseToPhase: 350, phaseToEarth: 320 },
          52: { phaseToPhase: 530, phaseToEarth: 480 },
          72.5: { phaseToPhase: 700, phaseToEarth: 660 },
          145: { phaseToPhase: 1220, phaseToEarth: 1050 },
          245: { phaseToPhase: 2000, phaseToEarth: 1800 },
          420: { phaseToPhase: 4000, phaseToEarth: 3500 },
          800: { phaseToPhase: 6700, phaseToEarth: 5800 }
        };

        function getClearanceByBIL(bil) {
          for (let i = 0; i < minimumClearances.length; i++) {
            if (bil <= minimumClearances[i].BIL) {
              return minimumClearances[i];
            }
          }
          return minimumClearances[minimumClearances.length - 1];
        }

        // 2. Add a helper function to select the correct clearance table based on terminal arrangement:
        function getClearanceByVoltageWithTerminal(voltage, terminalArr = []) {
          if (!voltage || isNaN(voltage) || voltage <= 0) {
            return { phaseToPhase: 0, phaseToEarth: 0 };
          }
          const arr = Array.isArray(terminalArr) ? terminalArr : [terminalArr];
          const isCableBox = arr.includes('Cable Box');
          const table = isCableBox ? cableBoxClearances : voltageBasedClearances;
          const voltageKeys = Object.keys(table).map(Number).sort((a, b) => a - b);
          let selectedVoltage = voltageKeys[0];
          for (let i = 0; i < voltageKeys.length; i++) {
            if (voltageKeys[i] <= voltage) {
              selectedVoltage = voltageKeys[i];
            } else {
              break;
            }
          }
          return table[selectedVoltage];
        }

        // Use the selected BIL for clearance calculation if present
        const hvBIL = (hvBilChoices && selectedHvBil) ? selectedHvBil.impulse : insulationHV.hvImpulse;
        
        // 3. In your calculateParameters function, update all minimum clearance calculations for HV, LV, LV1, LV2, MV, Tertiary:

        // For HV:
        let hvClearance;
        if (hvVoltage <= 36) {
          hvClearance = getClearanceByVoltageWithTerminal(hvVoltage, formData.hvTerminationArrangement);
        } else {
          hvClearance = getClearanceByBIL(Number(hvBIL));
        }

        // For LV (if not LV1/LV2):
        let lvBIL = null, lvClearance = null;
        if (!extraVoltageFields.lv1lv2 && lvVoltage) {
          if (lvVoltage <= 36) {
            lvClearance = getClearanceByVoltageWithTerminal(lvVoltage, formData.lvTerminationArrangement);
          } else {
            lvClearance = getClearanceByBIL(Number(lvBIL));
          }
        }

        // For LV1/LV2 (if present):
        let lv1Clearance = null, lv2Clearance = null;
        if (extraVoltageFields.lv1lv2) {
          const lv1Voltage = parseFloat(formData.lv1Voltage);
          if (lv1Voltage <= 36) {
            lv1Clearance = getClearanceByVoltageWithTerminal(lv1Voltage, formData.lv1TerminationArrangement);
          } else {
            lv1Clearance = getClearanceByBIL(Number(lv1BIL));
          }
          const lv2Voltage = parseFloat(formData.lv2Voltage);
          if (lv2Voltage <= 36) {
            lv2Clearance = getClearanceByVoltageWithTerminal(lv2Voltage, formData.lv2TerminationArrangement);
          } else {
            lv2Clearance = getClearanceByBIL(Number(lv2BIL));
          }
        }

        // For MV (if present):
        let mvClearance = null;
        if (extraVoltageFields.mv) {
          const mvVoltage = parseFloat(formData.mvVoltage);
          if (mvVoltage <= 36) {
            mvClearance = getClearanceByVoltageWithTerminal(mvVoltage, formData.mvTerminationArrangement);
          } else {
            mvClearance = getClearanceByBIL(Number(mvBIL));
          }
        }

        // For Tertiary (if present):
        let tertiaryClearance = null;
        if (extraVoltageFields.tertiary) {
          const tertiaryVoltage = parseFloat(formData.tertiaryVoltage);
          if (tertiaryVoltage <= 36) {
            tertiaryClearance = getClearanceByVoltageWithTerminal(tertiaryVoltage, formData.tertiaryTerminationArrangement);
          } else {
            tertiaryClearance = getClearanceByBIL(Number(tertiaryBIL));
          }
        }

        // Use selected BIL if present
        let hvPowerFreq, hvImpulse;
        if (hvBilChoices && selectedHvBil) {
          hvImpulse = selectedHvBil.impulse;
          hvPowerFreq = selectedHvBil.freq;
        } else {
          hvPowerFreq = insulationHV.hvPowerFreq;
          hvImpulse = insulationHV.hvImpulse;
        }
        let lvPowerFreq, lvImpulse;
        if (lvBilChoices && selectedLvBil && insulationLV) {
          lvImpulse = selectedLvBil.impulse;
          lvPowerFreq = selectedLvBil.freq;
        } else if (insulationLV) {
          lvPowerFreq = insulationLV.hvPowerFreq;
          lvImpulse = insulationLV.hvImpulse;
        } else {
          lvPowerFreq = null;
          lvImpulse = null;
        }
        // --- NEW: Calculate minimum clearances for LV1, LV2, MV, Tertiary if selected ---
        let lv1PowerFreq = null, lv1Induced = null, lv1Impulse = null;
        let lv2PowerFreq = null, lv2Induced = null, lv2Impulse = null;
        let mvPowerFreq = null, mvInduced = null, mvImpulse = null;
        let tertiaryPowerFreq = null, tertiaryInduced = null, tertiaryImpulse = null;
        
        if (extraVoltageFields.lv1lv2) {
          const lv1Voltage = parseFloat(formData.lv1Voltage);
          const insulationLV1 = getInsulationLevel(lv1Voltage);
          const lv1BIL = insulationLV1.lvImpulse;
          lv1PowerFreq = insulationLV1.hvPowerFreq;
          lv1Induced = insulationLV1.hvInduced === 'Twice to Rated Voltage' ? (2 * lv1Voltage).toFixed(3) : insulationLV1.lvInduced;
          lv1Impulse = insulationLV1.hvImpulse;
          
          const lv2Voltage = parseFloat(formData.lv2Voltage);
          const insulationLV2 = getInsulationLevel(lv2Voltage);
          const lv2BIL = insulationLV2.lvImpulse;
          lv2PowerFreq = insulationLV2.hvPowerFreq;
          lv2Induced = insulationLV2.hvInduced === 'Twice to Rated Voltage' ? (2 * lv2Voltage).toFixed(3) : insulationLV2.lvInduced;
          lv2Impulse = insulationLV2.hvImpulse;
        }
        if (extraVoltageFields.mv) {
          const mvVoltage = parseFloat(formData.mvVoltage);
          const insulationMV = getInsulationLevel(mvVoltage);
          const mvBIL = insulationMV.lvImpulse;
          mvPowerFreq = insulationMV.hvPowerFreq;
          mvInduced = insulationMV.hvInduced === 'Twice to Rated Voltage' ? (2 * mvVoltage).toFixed(3) : insulationMV.lvInduced;
          mvImpulse = insulationMV.hvImpulse;
        }
        if (extraVoltageFields.tertiary) {
          const tertiaryVoltage = parseFloat(formData.tertiaryVoltage);
          const insulationTertiary = getInsulationLevel(tertiaryVoltage);
          const tertiaryBIL = insulationTertiary.lvImpulse;
          tertiaryPowerFreq = insulationTertiary.hvPowerFreq;
          tertiaryInduced = insulationTertiary.hvInduced === 'Twice to Rated Voltage' ? (2 * tertiaryVoltage).toFixed(3) : insulationTertiary.lvInduced;
          tertiaryImpulse = insulationTertiary.hvImpulse;
        }
        // ... existing code ...
        // 4. When setting the report, use the calculated clearances as before:
        setReport({
          ...formData,
          extraVoltageFields,
          kvaList: formData.kvaList,
          hvCurrent: (typeof hvCurrent === 'number' && !isNaN(hvCurrent)) ? hvCurrent.toFixed(2) : '',
          lvCurrent: (typeof lvCurrent === 'number' && !isNaN(lvCurrent)) ? lvCurrent.toFixed(2) : '',
          noLoadLosses: formData.noLoadLosses, // Use user input
          loadLosses100: formData.loadLosses100, // Use user input
          maxLosses50: (typeof maxLosses50 === 'number' && !isNaN(maxLosses50)) ? maxLosses50.toFixed(3) : '',
          maxLosses100: (typeof maxLosses100 === 'number' && !isNaN(maxLosses100)) ? maxLosses100.toFixed(3) : '',
          auxiliaryLoss: formData.auxiliaryLoss,
          hvPowerFreq: hvPowerFreq,
          lvPowerFreq: lvPowerFreq || '',
          hvInduced: insulationHV.hvInduced === 'Twice to Rated Voltage' ? (2 * hvVoltage).toFixed(3) : insulationHV.hvInduced,
          lvInduced: insulationLV ? (insulationLV.hvInduced === 'Twice to Rated Voltage' ? (2 * lvVoltage).toFixed(3) : insulationLV.lvInduced) : '',
          hvImpulse: hvImpulse,
          lvImpulse: lvImpulse || '',
          // --- NEW: Add calculated insulation for LV1, LV2, MV, Tertiary ---
          lv1PowerFreq,
          lv1Induced,
          lv1Impulse,
          lv2PowerFreq,
          lv2Induced,
          lv2Impulse,
          mvPowerFreq,
          mvInduced,
          mvImpulse,
          tertiaryPowerFreq,
          tertiaryInduced,
          tertiaryImpulse,
          // ... existing code ...
          efficiencyUPF100: efficiencyUPF100,
          efficiencyUPF75: efficiencyUPF75,
          efficiencyUPF50: efficiencyUPF50,
          efficiencyUPF25: efficiencyUPF25,
          efficiencyPF08_100: efficiencyPF08_100,
          efficiencyPF08_75: efficiencyPF08_75,
          efficiencyPF08_50: efficiencyPF08_50,
          efficiencyPF08_25: efficiencyPF08_25,
          regulationUPF: regulationUPF,
          regulationPF08: regulationPF08,
          additionalFittings: Array.isArray(additionalFittings) ? additionalFittings : [],
          fittingQuantities: typeof fittingQuantities === 'object' && fittingQuantities !== null ? fittingQuantities : {},
          showDimensionsWeight: typeof showDimensionsWeight === 'boolean' ? showDimensionsWeight : false,
          selectedFittings: Array.isArray(selectedFittings) ? selectedFittings : [],
          minimumClearances: {
            HV: hvClearance,
            ...(extraVoltageFields.lv1lv2 ? {} : { LV: lvClearance }),
            ...(extraVoltageFields.lv1lv2 ? { LV1: lv1Clearance, LV2: lv2Clearance } : {}),
            ...(extraVoltageFields.mv ? { MV: mvClearance } : {}),
            ...(extraVoltageFields.tertiary ? { Tertiary: tertiaryClearance } : {}),
          },
          mvBushingMake: formData.mvBushingMake,
          mvBushingKV: formData.mvBushingKV,
          mvBushingAmps: formData.mvBushingAmps,
          mvBushingRating: formData.mvBushingRating,
          lv1BushingMake: formData.lv1BushingMake,
          lv1BushingKV: formData.lv1BushingKV,
          lv1BushingAmps: formData.lv1BushingAmps,
          lv1BushingRating: formData.lv1BushingRating,
          lv2BushingMake: formData.lv2BushingMake,
          lv2BushingKV: formData.lv2BushingKV,
          lv2BushingAmps: formData.lv2BushingAmps,
          lv2BushingRating: formData.lv2BushingRating,
          tertiaryBushingMake: formData.tertiaryBushingMake,
          tertiaryBushingKV: formData.tertiaryBushingKV,
          tertiaryBushingAmps: formData.tertiaryBushingAmps,
          tertiaryBushingRating: formData.tertiaryBushingRating,
        });
        // ... existing code ...
        console.log('Report set successfully');
      };

      const standardAccessories = [
        'HV Termination',
        'LV Termination',
        'Neutral bushing separately brought out for LV',
        'Lifting Bollard to lift complete transformer',
        'Lifting lug to lift tank cover',
        'Pressure releasing valve',
        'Jacking pads',
        'Two nos. diagonally opposite tank Earthing Terminals',
        'Bidirectional rail rollers (flanged)',
        'Traction eye',
        'Filter valve',
        'Filter cum drain valve',
        'Sampling valves',
        'Bottom oil drain valve plug',
        'Thermometer pocket',
        'Dial type oil temperature indicator with alarm trip contacts',
        'Dial type Winding Temp. Indicator with alarm & trip contacts',
        'On Load Tap Changer',
        'Conservator Air cell Rubber (balloon), Magnetic oil gauge (MOG), Drain valve, Air release plugs, Breather connecting flange, Silica Gel breather, Pressure gauge connection flange, Inspection cover, Conservator end cover, Air cell lifting supports, Pressure gauge, Air cell (balloon) connecting flange, MOG float with arm',
        'Gas operated Buchholz relay double float type for main tank ',
        'Control cubicle cum marshalling box',
        'Rating & diagram plate',
        'Inspection covers for inspection of HV/LV winding',
        'Cooling Fans',
        'Fan Control Cubicle',
        'WTI CT',
        'RTCC panel with AVR',
        'Fixed Ladder',
        'Detachable radiators with valve on top & bottom',
        'Drain & oil filling hole for each radiators',
        'Provision for NIFPS system to tank (Only Provision)'
      ];

      const paintOptions = [
        '631-Light grey(as per IS:5)',
        '632- Dark Grey',
        'RAL 7032',
      ];

      // Impedance chart as per user image
      const impedanceChart = [
        { kva: 250, impedance: 4.5 },
        { kva: 315, impedance: 4.5 },
        { kva: 400, impedance: 4.5 },
        { kva: 500, impedance: 4.5 },
        { kva: 630, impedance: 4.5 },
        { kva: 800, impedance: 5.0 },
        { kva: 1000, impedance: 5.0 },
        { kva: 1250, impedance: 5.0 },
        { kva: 1600, impedance: 6.25 },
        { kva: 2000, impedance: 6.25 },
        { kva: 2500, impedance: 6.25 },
      ];

      // Find the impedance for a given kVA (ceiling logic)
      function getImpedanceForKva(kva) {
        if (!kva || isNaN(kva)) return '';
        for (let i = 0; i < impedanceChart.length; i++) {
          if (kva <= impedanceChart[i].kva) {
            return impedanceChart[i].impedance;
          }
        }
        // If above max, use last
        return impedanceChart[impedanceChart.length - 1].impedance;
      }

      // Auto-set impedance when kVA changes
      React.useEffect(() => {
        // Use the highest kVA if kvaList is present, else use single kva
        const kva = (formData.kvaList && formData.kvaList.length > 0)
          ? Math.max(...formData.kvaList)
          : parseFloat(formData.kva);
        if (!isNaN(kva) && kva > 0) {
          const autoImpedance = getImpedanceForKva(kva);
          setFormData(prev => {
            // Only auto-set if user hasn't changed it manually
            if (!prev.impedanceVoltage || prev.impedanceVoltage === '' || prev.impedanceVoltage === getImpedanceForKva(parseFloat(prev.kva))) {
              return { ...prev, impedanceVoltage: autoImpedance.toString() };
            }
            return prev;
          });
        }
      }, [formData.kva, formData.kvaList]);

      // LV Bushing Amps options for 52 and 72.5 kV
      const lvBushingAmpsSpecial = ["800", "1250", "2000", "3150"];
      // Default LV Bushing Amps options
      const lvBushingAmpsDefault = ["250", "630", "1000", "2000", "3150"];

      // 1. State for quantities
      const [fittingQuantities, setFittingQuantities] = React.useState(() => {
        // Default 1 for all standard fittings
        const obj = {};
        allStandardFittings.forEach(f => { obj[f] = 1; });
        return obj;
      });
      const [additionalFittings, setAdditionalFittings] = React.useState([]); // [{desc, qty}]

      // Unified bushing make options for both HV and LV
      const bushingMakeOptions = [
        "CGL", "Hitachi", "Yash", "Trench", "Baroda", "Genesis", "Reputed", "CJI"
      ];

      // New: State for extra voltage fields
      const [extraVoltageFields, setExtraVoltageFields] = React.useState({
        lv1lv2: false,
        mv: false,
        tertiary: false
      });
      // Track if LV1/LV2 are synced with LV
      const [lv1lv2Synced, setLv1lv2Synced] = React.useState(true);

      // Increment variables for indexes
      let nextBushingIndex = 1; 
      let outputIndex= 1;
      

      // Add Off Circuit Tap Changer to tap changer type options
      const tapChangerTypeOptions = [
        "On load tap changer(OLTC)",
        "Off Circuit Tap Changer"
      ];

      // Clear the make selection when tap changer type changes
      React.useEffect(() => {
        setFormData(prev => ({ 
          ...prev, 
          tapChangerMake: [] 
        }));
      }, [formData.tapChangerType]);

      // First, define the make options for different tap changer types
      const tapChangerMakeOptions = {
        "On load tap changer(OLTC)": ["Easun MR", "CTR", "Reputed"],
        "Off Circuit Tap Changer": ["Paragon", "Alwaye", "Reputed"]
      };

      // Tapping range options for Off Circuit Tap Changer
      const offCircuitTappingRanges = [
        "+5% to -5% @2.5%",
        "+7.5% to -7.5% @2.5%", 
        "+10% to -10% @2.5%",
        "+5% to -7.5% @2.5%",
        "+7.5% to -5% @2.5%",
        "+5% to -10% @2.5%",
        "+10% to -5% @2.5%",
        "+7.5% to -10% @2.5%",
        "+10% to -7.5% @2.5%"
      ];
      // Steps options for Off Circuit Tap Changer
      const offCircuitTapSteps = [
        "4/5",
        "6/7", 
        "8/9",
        "5/6",
        "7/8",
        "16/17",
        "20/21",
        "Custom"
      ];

      // MOG make options
      const mogMakeOptions = ["Sukrut", "VIAT", "Yogya", "Precimeasure", "Press-N-Forge", "Reputed"];

      // Gas and Oil Operated Relay make options
      const gasOilRelayMakeOptions = ["Sukrut", "VIAT", "Yogya", "Press-N-Forge", "Reputed"];

      // Temperature Indicator make options
      const tempIndicatorMakeOptions = ["Precimeasure", "Perfect", "Reputed"];

      // Helper for multi-value validation (array or non-empty string)
      function isValidMultiValue(val) {
        return (Array.isArray(val) && val.length > 0) || (typeof val === 'string' && val.trim().length > 0);
      }

      return (
        <div className="container mx-auto p-4 max-w-6xl">
          <div className="logo-header flex flex-wrap items-center justify-center mb-8 space-x-4">
            <img
              src="https://images.squarespace-cdn.com/content/v1/67c6cd6aa7237560f57b1238/5dc6f094-8e85-4639-9c96-e5aa5e773ec0/BCS-Mahati-with-C_TM-revised-02.png?format=1500w"
              alt="Company Logo"
              className="h-20 max-w-full object-contain"
            />
            <h1 className="text-3xl font-bold text-blue-800">
              Power Transformer
            </h1>
                </div>

          <div className="bg-white p-6 rounded-lg shadow-md mb-6">
            <h2 className="text-xl font-bold mb-4 text-center">ANNEXURE  {formData.annexureNumber}</h2>
            <h3 className="text-lg font-semibold mb-4 text-center">
              TECHNICAL PARTICULARS FOR EHV POWER TRANSFORMER 
            </h3>
            <div className="flex justify-end mb-2 gap-4">
             <label className="flex items-center gap-2">
              <span className="font-semibold">Annexure No.:</span>
                <input
                   type="text"
                   name="annexureNumber"
                   value={formData.annexureNumber}
                   onChange={handleInputChange}
                   className="w-20 p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                   placeholder="I"
                />
             </label>
             <label className="flex items-center gap-2">
              <span className="font-semibold">Revision No.:</span>
                <input
                   type="number"
                   min="1"
                   value={registerOutput}
                   onChange={e => setRegisterOutput(e.target.value.replace(/[^0-9]/g, ''))}
                   className="w-20 p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                   placeholder="n"
                         />
             </label>
            </div>
            <table className="w-full border-collapse border border-gray-300 text-sm mb-6">
              <thead>
                <tr className="bg-blue-100">
                  <th className="border border-gray-300 p-4">Sr. No.</th>
                  <th className="border border-gray-300 p-4">Description</th>
                  <th className="border border-gray-300 p-4">Particulars</th>
                </tr>
              </thead>
              <tbody>
                {[
                  // All static rows up to Details of Tanks
                  <tr key="row-1">
                    <td className="border border-gray-300 p-4 font-bold">{nextBushingIndex++}</td>
                    <td className="border border-gray-300 p-4 font-bold">Name of the Manufacturer <span className="text-red-500">*</span></td>
                    <td className="border border-gray-300 p-4">
                      <div className="w-full p-1 border rounded bg-gray-100 text-gray-800">{formData.manufacturer}</div>
                      {errors.manufacturer && <div className="error-message">{errors.manufacturer}</div>}
                    </td>
                  </tr>,
                  <tr key="row-2">
                    <td className="border border-gray-300 p-4 font-bold">{nextBushingIndex++}</td>
                    <td className="border border-gray-300 p-4 font-bold">Customer</td>
                    <td className="border border-gray-300 p-4">
                  <input
                    type="text"
                    name="customer"
                    value={formData.customer}
                    onChange={handleInputChange}
                        className="w-full p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                        placeholder="Enter customer name (optional)"
                      />
                    </td>
                  </tr>,
                  <tr key="row-2a">
                    <td className="border border-gray-300 p-4 font-bold">{nextBushingIndex++}</td>
                    <td className="border border-gray-300 p-4 font-bold">Number of transformers required <span className="text-red-500">*</span></td>
                    <td className="border border-gray-300 p-4">
                  <input
                        type="number"
                        name="numTransformers"
                        value={formData.numTransformers || ''}
                        onChange={handleInputChange}
                        className="w-full p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                        placeholder="Enter number"
                        min="1"
                      />{errors.numTransformers && <div className="error-message">{errors.numTransformers}</div>}
                    </td>
                  </tr>,
                  <tr key="row-3">
                    <td className="border border-gray-300 p-4 font-bold">{nextBushingIndex++}</td>
                    <td className="border border-gray-300 p-4 font-bold">Reference Standard <span className="text-red-500">*</span></td>
                    <td className="border border-gray-300 p-4">
                      <select
                    name="referenceStandards"
                    value={formData.referenceStandards}
                    onChange={handleInputChange}
                        className="w-full p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                      >
                        <option value="IS:2026">IS:2026</option>
                        <option value="IEC60076">IEC 60076</option>
                      </select>
                      {errors.referenceStandards && <div className="error-message">{errors.referenceStandards}</div>}
                    </td>
                  </tr>,
                  <tr key="row-4">
                    <td className="border border-gray-300 p-4 font-bold">{nextBushingIndex++}</td>
                    <td className="border border-gray-300 p-4 font-bold">Winding Material <span className="text-red-500">*</span></td>
                    <td className="border border-gray-300 p-4">
                  <input
                    type="text"
                    name="windingMaterial"
                    value={formData.windingMaterial}
                    onChange={handleInputChange}
                        className="w-full p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                      />{errors.windingMaterial && <div className="error-message">{errors.windingMaterial}</div>}
                    </td>
                  </tr>,
                  <tr key="row-5">
                    <td className="border border-gray-300 p-4 font-bold">{nextBushingIndex++}</td>
                    <td className="border border-gray-300 p-4 font-bold">Service <span className="text-red-500">*</span></td>
                    <td className="border border-gray-300 p-4">
                      <select
                    name="service"
                    value={formData.service}
                    onChange={handleInputChange}
                        className="w-full p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                      >
                        <option value="Outdoor">Outdoor</option>
                        <option value="Indoor">Indoor</option>
                        <option value="Indoor/Outdoor">Indoor/Outdoor</option>
                      </select>
                      {errors.service && <div className="error-message">{errors.service}</div>}
                    </td>
                  </tr>,
                  <tr key="row-6">
                    <td className="border border-gray-300 p-4 font-bold">{nextBushingIndex++}</td>
                    <td className="border border-gray-300 p-4 font-bold">kVA Rating(s) <span className="text-red-500">*</span></td>
                    <td className="border border-gray-300 p-4">
                      <div className="flex gap-2 mb-2">
                    <input
                          type="number"
                          name="kvaInput"
                          value={kvaInput}
                          onChange={e => setKvaInput(e.target.value)}
                          className="w-full p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                          step="any"
                          placeholder="Enter kVA"
                    />
                    <button
                      type="button"
                      onClick={handleAddKva}
                          className="px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-600"
                        >Add</button>
                  </div>{errors.kva && <div className="error-message">{errors.kva}</div>}
                      <ul className="mb-2">
                      {formData.kvaList.map((kva, idx) => (
                          <li key={idx} className="flex items-center gap-2 mb-1">
                            <span className="font-semibold">{kva} kVA</span>
                            <button type="button" onClick={() => handleRemoveKva(idx)} className="text-red-500 hover:text-red-700 ml-2">Remove</button>
                        </li>
                      ))}
                    </ul>
                    </td>
                  </tr>,
                  <tr key="row-cooling-type">
                    <td className="border border-gray-300 p-4 font-bold">{nextBushingIndex++}</td>
                    <td className="border border-gray-300 p-4 font-bold">Cooling Type <span className="text-red-500">*</span></td>
                    <td className="border border-gray-300 p-4">
                      {formData.kvaList.length > 1
                        ? formData.kvaList.map((kva, idx) => (
                            <div key={kva} className="mb-2">
                              <span className="font-semibold">{kva} kVA:</span>
                              <MultiSelectDropdown
                                options={["ONAN", "ONAF", "OFAF", "OFWF","ODAF", "AN", "ANAF"]}
                                selected={formData.coolingType[idx] || []}
                                onChange={value => {
                                  setFormData(prev => {
                                    const newCooling = [...(prev.coolingType || [])];
                                    newCooling[idx] = value;
                                    return { ...prev, coolingType: newCooling };
                                  });
                                }}
                                placeholder="Select Cooling Type(s)"
                              />
                </div>
                          ))
                        : <MultiSelectDropdown
                        options={["ONAN", "ONAF", "OFAF", "OFWF","ODAF", "AN", "ANAF"]}
                            selected={formData.coolingType[0] || []}
                            onChange={value => setFormData(prev => ({ ...prev, coolingType: [value] }))}
                            placeholder="Select Cooling Type(s)"
                          />
                      }
                    </td>
                  </tr>,
                  <tr key="row-8">
                    <td className="border border-gray-300 p-4 font-bold">{nextBushingIndex++}</td>
                    <td className="border border-gray-300 p-4 font-bold">Rated Voltage(in kV) <span className="text-red-500">*</span></td>
                    <td className="border border-gray-300 p-4">
                      HV (No Load): <input
                        type="number"
                    name="hvVoltage"
                    value={formData.hvVoltage}
                        onChange={e => {
                          handleInputChange(e);
                          setSelectedHvBil(null);
                        }}
                        className="w-full p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500 mb-1"
                        step="any"
                      />{errors.hvVoltage && <div className="error-message">{errors.hvVoltage}</div>}
                      {hvBilChoices && (
                        <div className="mt-2">
                          <label className="block text-xs text-gray-700 mb-1">Select Lightning Impulse (BIL) for HV:</label>
                          <select
                            value={selectedHvBil ? selectedHvBil.impulse : ''}
                            onChange={e => {
                              const val = parseInt(e.target.value);
                              setSelectedHvBil(hvBilChoices.find(opt => opt.impulse === val));
                            }}
                            className="w-full p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                          >
                            <option value="">Select BIL</option>
                            {hvBilChoices.map(opt => (
                              <option key={opt.impulse} value={opt.impulse}>{opt.impulse} kVp</option>
                            ))}
                          </select>
                </div>
                      )}
                      <br />
                      {/* Only show LV if LV1/LV2 is NOT checked */}
                {!extraVoltageFields.lv1lv2 && (
                        <>
                          LV (No Load): <input
                            type="number"
                      name="lvVoltage"
                      value={formData.lvVoltage}
                            onChange={e => {
                              handleInputChange(e);
                              setSelectedLvBil(null);
                              const val = parseFloat(e.target.value);
                              if (
                                extraVoltageFields.lv1lv2 &&
                                lv1lv2Synced &&
                                !isNaN(val) && val > 0
                              ) {
                                setFormData(prev => ({
                                  ...prev,
                                  lv1Voltage: (val / 2).toString(),
                                  lv2Voltage: (val / 2).toString(),
                                }));
                              }
                            }}
                            onBlur={e => {
                              // No-op, logic moved to onChange
                            }}
                            className="w-full p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                            step="any"
                          />{errors.lvVoltage && <div className="error-message">{errors.lvVoltage}</div>}
                        </>
                      )}
                      {/* New checkboxes for extra voltage fields */}
                      <div className="mt-2 flex flex-wrap gap-4">
                        <label className="flex items-center gap-1">
                          <input
                            type="checkbox"
                            checked={extraVoltageFields.lv1lv2}
                            onChange={e => {
                              setExtraVoltageFields(f => ({ ...f, lv1lv2: e.target.checked }));
                              if (e.target.checked) {
                                setLv1lv2Synced(true);
                                // If LV has value, immediately sync
                                const val = parseFloat(formData.lvVoltage);
                                if (!isNaN(val) && val > 0) {
                                  setFormData(prev => ({
                                    ...prev,
                                    lv1Voltage: (val / 2).toString(),
                                    lv2Voltage: (val / 2).toString(),
                                  }));
                                }
                              }
                            }}
                          />
                          LV1 and LV2
                        </label>
                        <label className="flex items-center gap-1">
                          <input
                            type="checkbox"
                            checked={extraVoltageFields.mv}
                            onChange={e => setExtraVoltageFields(f => ({ ...f, mv: e.target.checked }))}
                          />
                          MV
                        </label>
                        <label className="flex items-center gap-1">
                          <input
                            type="checkbox"
                            checked={extraVoltageFields.tertiary}
                            onChange={e => setExtraVoltageFields(f => ({ ...f, tertiary: e.target.checked }))}
                          />
                          Tertiary
                        </label>
                </div>
                      {/* Conditionally show LV1/LV2, MV, Tertiary inputs */}
                      <div className="mt-2 grid grid-cols-1 md:grid-cols-2 gap-2">
              {extraVoltageFields.lv1lv2 && (
                          <>
                <div>
                              LV1: <input
                                type="number"
                    name="lv1Voltage"
                    value={formData.lv1Voltage}
                                onChange={e => {
                                  handleInputChange(e);
                                  setLv1lv2Synced(false);
                                }}
                                className="w-full p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                                step="any"
                                placeholder="LV1 voltage"
                              />
                              {errors.lv1Voltage && <div className="error-message">{errors.lv1Voltage}</div>}
                </div>
                <div>
                              LV2: <input
                                type="number"
                    name="lv2Voltage"
                    value={formData.lv2Voltage}
                                onChange={e => {
                                  handleInputChange(e);
                                  setLv1lv2Synced(false);
                                }}
                                className="w-full p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                                step="any"
                                placeholder="LV2 voltage"
                              />
                              {errors.lv2Voltage && <div className="error-message">{errors.lv2Voltage}</div>}
                            </div>
                          </>
                        )}
                        {extraVoltageFields.mv && (
                          <div>
                            MV: <input
                              type="number"
                              name="mvVoltage"
                              value={formData.mvVoltage}
                      onChange={handleInputChange}
                              className="w-full p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                              step="any"
                              placeholder="MV voltage"
                    />
                    {errors.mvVoltage && <div className="error-message">{errors.mvVoltage}</div>}
                  </div>
                )}
                        {extraVoltageFields.tertiary && (
              <div>
                            Tertiary: <input
                              type="number"
                              name="tertiaryVoltage"
                              value={formData.tertiaryVoltage}
                              onChange={handleInputChange}
                              className="w-full p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                              step="any"
                              placeholder="Tertiary voltage"
                            />
                            {errors.tertiaryVoltage && <div className="error-message">{errors.tertiaryVoltage}</div>}
                          </div>
                        )}
                      </div>
                      {lvBilChoices && !extraVoltageFields.lv1lv2 && (
                        <div className="mt-2">
                          <label className="block text-xs text-gray-700 mb-1">Select Lightning Impulse (BIL) for LV:</label>
                          <select
                            value={selectedLvBil ? selectedLvBil.impulse : ''}
                            onChange={e => {
                              const val = parseInt(e.target.value);
                              setSelectedLvBil(lvBilChoices.find(opt => opt.impulse === val));
                            }}
                            className="w-full p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                          >
                            <option value="">Select BIL</option>
                            {lvBilChoices.map(opt => (
                              <option key={opt.impulse} value={opt.impulse}>{opt.impulse} kVp</option>
                            ))}
                          </select>
                        </div>
                      )}
                    </td>
                  </tr>,
                  <tr key="row-9">
                    <td className="border border-gray-300 p-4 font-bold">{nextBushingIndex++}</td>
                    <td className="border border-gray-300 p-4 font-bold">Frequency<span className="text-red-500">*</span></td>
                    <td className="border border-gray-300 p-4">
                      <select
                    name="frequency"
                    value={formData.frequency}
                    onChange={handleInputChange}
                        className="w-full p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                      >
                        <option value="50">50 Hz</option>
                        <option value="60">60 Hz</option>
                      </select>
                    </td>
                  </tr>,
                  <tr key="row-10">
                    <td className="border border-gray-300 p-4 font-bold">{nextBushingIndex++}</td>
                    <td className="border border-gray-300 p-4 font-bold">Phases<span className="text-red-500">*</span></td>
                    <td className="border border-gray-300 p-4">
                      <select
                    name="phases"
                    value={formData.phases}
                    onChange={handleInputChange}
                        className="w-full p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                      >
                        <option value="3">3</option>
                        <option value="1">1</option>
                      </select>
                    </td>
                  </tr>,
                  <tr key="row-11">
                    <td className="border border-gray-300 p-4 font-bold">{nextBushingIndex++}</td>
                    <td className="border border-gray-300 p-4 font-bold">Voltage Variation in %()</td>
                    <td className="border border-gray-300 p-4">
                      <input
                        type="text"
                        name="voltageVariation"
                        value={formData.voltageVariation}
                        onChange={handleInputChange}
                        className="w-full p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                        placeholder="in %"
                      />
                    </td>
                  </tr>,
                  <tr key="row-12">
                    <td className="border border-gray-300 p-4 font-bold">{nextBushingIndex++}</td>
                    <td className="border border-gray-300 p-4 font-bold">Frequency Variation in %()</td>
                    <td className="border border-gray-300 p-4">
                  <input
                    type="text"
                        name="frequencyVariation"
                        value={formData.frequencyVariation}
                        onChange={handleInputChange}
                        className="w-full p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                        placeholder="in %"
                      />
                    </td>
                  </tr>,
                  <tr key="row-13">
                    <td className="border border-gray-300 p-4 font-bold">{nextBushingIndex++}</td>
                    <td className="border border-gray-300 p-4 font-bold">Connection<span className="text-red-500">*</span></td>
                    <td className="border border-gray-300 p-4">
                      HV: <select
                    name="hvConnection"
                    value={formData.hvConnection}
                    onChange={handleInputChange}
                        className="w-full p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500 mb-1"
                      >
                        <option value="Delta">Delta</option>
                        <option value="Star">Star</option>
                        <option value="Star with Neutral">Star with Neutral</option>
                      </select><br />
                      {/* Only show LV connection if LV1/LV2 is NOT checked */}
                {!extraVoltageFields.lv1lv2 && (
                        <>
                          LV: <select
                      name="lvConnection"
                      value={formData.lvConnection}
                      onChange={handleInputChange}
                            className="w-full p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                          >
                            <option value="Star with Neutral">Star with Neutral</option>
                            <option value="Delta">Delta</option>
                            <option value="Zigzag">Zigzag</option>
                            <option value="Auto">Auto</option>
                            <option value="Star both with Neutral">Star both with Neutral</option>
                          </select>
                          {errors.lvConnection && <div className="error-message">{errors.lvConnection}</div>}
                        </>
                      )}
                      {/* Dynamic extra connection dropdowns */}
                {extraVoltageFields.lv1lv2 && (
                        <>
                          <div className="mt-2">LV1: <select
                      name="lv1Connection"
                      value={formData.lv1Connection}
                      onChange={handleInputChange}
                            className="w-full p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500 mb-1"
                          >
                            <option value="">Select Connection</option>
                            <option value="Star with Neutral">Star with Neutral</option>
                            <option value="Delta">Delta</option>
                            <option value="Zigzag">Zigzag</option>
                            <option value="Auto">Auto</option>
                            <option value="Star both with Neutral">Star both with Neutral</option>
                          </select>
                          {errors.lv1Connection && <div className="error-message">{errors.lv1Connection}</div>}
                          </div>
                          <div className="mt-2">LV2: <select
                            name="lv2Connection"
                            value={formData.lv2Connection}
                            onChange={handleInputChange}
                            className="w-full p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500 mb-1"
                          >
                            <option value="">Select Connection</option>
                            <option value="Star with Neutral">Star with Neutral</option>
                            <option value="Delta">Delta</option>
                            <option value="Zigzag">Zigzag</option>
                            <option value="Auto">Auto</option>
                            <option value="Star both with Neutral">Star both with Neutral</option>
                          </select>
                          {errors.lv2Connection && <div className="error-message">{errors.lv2Connection}</div>}
                          </div>
                        </>
                      )}
                      {extraVoltageFields.mv && (
                        <div className="mt-2">MV: <select
                          name="mvConnection"
                          value={formData.mvConnection}
                          onChange={handleInputChange}
                          className="w-full p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500 mb-1"
                        >
                          <option value="">Select Connection</option>
                          <option value="Star with Neutral">Star with Neutral</option>
                          <option value="Delta">Delta</option>
                          <option value="Zigzag">Zigzag</option>
                          <option value="Auto">Auto</option>
                          <option value="Open Delta">Open Delta</option>
                          <option value="Star both with Neutral">Star both with Neutral</option>
                          <option value="N/A">N/A</option>
                        </select>
                        {errors.mvConnection && <div className="error-message">{errors.mvConnection}</div>}
                        </div>
                      )}
                      {extraVoltageFields.tertiary && (
                        <div className="mt-2">Tertiary: <select
                          name="tertiaryConnection"
                          value={formData.tertiaryConnection}
                          onChange={handleInputChange}
                          className="w-full p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500 mb-1"
                        >
                          <option value="">Select Connection</option>
                          <option value="Star with Neutral">Star with Neutral</option>
                          <option value="Delta">Delta</option>
                          <option value="Zigzag">Zigzag</option>
                          <option value="Auto">Auto</option>
                          <option value="Open Delta">Open Delta</option>
                          <option value="Star both with Neutral">Star both with Neutral</option>
                        </select>
                        {errors.tertiaryConnection && <div className="error-message">{errors.tertiaryConnection}</div>}
                        </div>
                      )}
                    </td>
                  </tr>,
                  <tr key="row-14">
                    <td className="border border-gray-300 p-4 font-bold">{nextBushingIndex++}</td>
                    <td className="border border-gray-300 p-4 font-bold">Vector Group<span className="text-red-500">*</span></td>
                    <td className="border border-gray-300 p-4">
                      <MultiSelectComboBox
                        options={["Dyn11", "Dd6", "YNd1", "YNd11", "YNyn0", "Dzn0", "Ya0"]}
                        value={formData.vectorGroup}
                        onChange={value => handleInputChange({ target: { name: 'vectorGroup', value } })}
                        placeholder="Select or enter vector group(s)"
                      />
                      {errors.vectorGroup && <div className="error-message">{errors.vectorGroup}</div>}
                    </td>
                  </tr>,
                  <tr key="row-15">
                    <td className="border border-gray-300 p-4 font-bold">{nextBushingIndex++}</td>
                    <td className="border border-gray-300 p-4 font-bold">Tap Changer <span className="text-red-500">*</span></td>
                    <td className="border border-gray-300 p-4">
                      Type:<br />
                      <SingleSelectDropdown
                        options={tapChangerTypeOptions}
                        value={formData.tapChangerType}
                        onChange={value => handleInputChange({ target: { name: 'tapChangerType', value } })}
                        placeholder="Select Tap Changer Type"
                      />
                      {errors.tapChangerType && <div className="error-message">{errors.tapChangerType}</div>}<br />
                      Make:<br />
                  <MultiSelectComboBox
                        options={tapChangerMakeOptions[formData.tapChangerType] || []}
                        value={formData.tapChangerMake}
                        onChange={(value) => handleInputChange({ target: { name: 'tapChangerMake', value } })}
                        placeholder="Select or enter make(s)"
                      />
                      {errors.tapChangerMake && <div className="error-message">{errors.tapChangerMake}</div>}<br />
                      Current Rating: <input
                        type="text"
                        name="tapChangerCurrentRating"
                        value={formData.tapChangerCurrentRating}
                        onChange={handleInputChange}
                        className="w-full p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500 mb-1"
                      />
                      {errors.tapChangerCurrentRating && <div className="error-message">{errors.tapChangerCurrentRating}</div>}<br />
                      Voltage Rating: <input
                        type="text"
                        name="tapChangerVoltageRating"
                        value={formData.tapChangerVoltageRating}
                        onChange={handleInputChange}
                        className="w-full p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500 mb-1"
                      />
                      {errors.tapChangerVoltageRating && <div className="error-message">{errors.tapChangerVoltageRating}</div>}<br />
                      Control: <MultiSelectDropdown
                        options={["Local", "Remote operated", "Manual", "Electrical"]}
                        selected={formData.tapChangerControl}
                        onChange={value => handleInputChange({ target: { name: 'tapChangerControl', value } })}
                        placeholder="Select Control Type(s)"
                      />
                      {errors.tapChangerControl && <div className="error-message">{errors.tapChangerControl}</div>}<br />
                      Tapping Range: {
                        formData.tapChangerType === "On load tap changer(OLTC)" ? (
                          <>
                            <select
                              name="tappingRange"
                              value={formData.tappingRange}
                              onChange={handleInputChange}
                              className="w-full p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500 mb-1"
                            >
                              <option value="" className="text-gray-400">Select Tapping Range</option>
                              <option value="+10% to -10% @ step of 1.25%">+10% to -10% @ step of 1.25%</option>
                              <option value="+5% to -15% @ step of 1.25%">+5% to -15% @ step of 1.25%</option>
                              <option value="+15% to -5% @ step of 1.25%">+15% to -5% @ step of 1.25%</option>
                              <option value="+7.5% to -12.5% @ step of 1.25%">+7.5% to -12.5% @ step of 1.25%</option>
                              <option value="+12.5% to -7.5% @ step of 1.25%">+12.5% to -7.5% @ step of 1.25%</option>
                              <option value="+5% to -20% @ step of 1.25%">+5% to -20% @ step of 1.25%</option>
                              <option value="+10% to -15% @ step of 1.25%">+10% to -15% @ step of 1.25%</option>
                              <option value="Custom">Custom</option>
                            </select>
                            {errors.tappingRange && <div className="error-message">{errors.tappingRange}</div>}<br />
                            {formData.tappingRange === "Custom" && (
                  <input
                    type="text"
                                name="tappingRange"
                                value={formData.tappingRange === "Custom" ? "" : formData.tappingRange}
                    onChange={handleInputChange}
                                className="w-full p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500 mb-1 mt-1"
                                placeholder="Enter custom tapping range"
                              />
                            )}
                          </>
                        ) : formData.tapChangerType === "Off Circuit Tap Changer" ? (
                          <>
                            <select
                              name="tappingRange"
                              value={formData.tappingRange}
                              onChange={handleInputChange}
                              className="w-full p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500 mb-1"
                            >
                              <option value="" className="text-gray-400">Select Tapping Range</option>
                              {offCircuitTappingRanges.map(opt => (
                                <option key={opt} value={opt}>{opt}</option>
                              ))}
                              <option value="Custom">Custom</option>
                            </select>
                            {errors.tappingRange && <div className="error-message">{errors.tappingRange}</div>}<br />
                            {formData.tappingRange === "Custom" && (
                  <input
                    type="text"
                                name="tappingRange"
                                value={formData.tappingRange === "Custom" ? "" : formData.tappingRange}
                                onChange={handleInputChange}
                                className="w-full p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500 mb-1 mt-1"
                                placeholder="Enter custom tapping range"
                              />
                            )}
                          </>
                        ) : (
                          <input
                            type="text"
                            name="tappingRange"
                            value={formData.tappingRange}
                            onChange={handleInputChange}
                            className="w-full p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500 mb-1 placeholder-gray-400"
                            placeholder="Enter Tapping Range"
                          />
                        )
                      }
                      <br />
                      Steps/Position: {
                        formData.tapChangerType === "On load tap changer(OLTC)" ? (
                          <>
                            <select
                              name="tapSteps"
                              value={formData.tapSteps}
                              onChange={handleInputChange}
                              className="w-full p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                            >
                              <option value="" className="text-gray-400">Select Steps/Position</option>
                              <option value="16/17">16/17</option>
                              <option value="20/21">20/21</option>
                              <option value="Custom">Custom</option>
                            </select>
                            {errors.tapSteps && <div className="error-message">{errors.tapSteps}</div>}<br />
                            {formData.tapSteps === "Custom" && (
                              <input
                                type="text"
                                name="tapSteps"
                                value={formData.tapSteps === "Custom" ? "" : formData.tapSteps}
                                onChange={handleInputChange}
                                className="w-full p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500 mt-1"
                                placeholder="Enter custom steps/position"
                              />
                            )}
                          </>
                        ) : formData.tapChangerType === "Off Circuit Tap Changer" ? (
                          <>
                            <select
                              name="tapSteps"
                              value={formData.tapSteps}
                              onChange={handleInputChange}
                              className="w-full p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                            >
                              <option value="" className="text-gray-400">Select Steps/Position</option>
                              {offCircuitTapSteps.map(opt => (
                                <option key={opt} value={opt}>{opt}</option>
                              ))}
                            </select>
                            {errors.tapSteps && <div className="error-message">{errors.tapSteps}</div>}<br />
                            {formData.tapSteps === "Custom" && (
                              <input
                                type="text"
                                name="tapSteps"
                                value={formData.tapSteps === "Custom" ? "" : formData.tapSteps}
                                onChange={handleInputChange}
                                className="w-full p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500 mt-1"
                                placeholder="Enter custom steps/position"
                              />
                            )}
                          </>
                        ) : (
                          <input
                            type="text"
                            name="tapSteps"
                            value={formData.tapSteps}
                            onChange={handleInputChange}
                            className="w-full p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500 placeholder-gray-400"
                            placeholder="Enter Steps/Position"
                          />
                        )
                      }
                    </td>
                  </tr>,
                  <tr key="row-16">
                    <td className="border border-gray-300 p-4 font-bold">{nextBushingIndex++}</td>
                    <td className="border border-gray-300 p-4 font-bold">Temperature Rise <span className="text-red-500">*</span></td>
                    <td className="border border-gray-300 p-4">
                      Ambient Temperature: <input
                        type="number"
                        name="ambientTemp"
                        value={formData.ambientTemp}
                        onChange={handleInputChange}
                        className="w-full p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500 mb-1"
                        step="any"
                        placeholder="Enter ambient temperature"
                      /><br />
                      {errors.ambientTemp && <div className="error-message">{errors.ambientTemp}</div>}
                      Top Oil: <input
                        type="number"
                        name="topOilTemp"
                        value={formData.topOilTemp}
                        onChange={handleInputChange}
                        className="w-full p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500 mb-1"
                        step="any"
                        placeholder="Enter top oil temp"
                      /><br />
                      {errors.topOilTemp && <div className="error-message">{errors.topOilTemp}</div>}
                      Winding: <input
                        type="number"
                    name="windingTemp"
                    value={formData.windingTemp}
                    onChange={handleInputChange}
                        className="w-full p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                        step="any"
                        placeholder="Enter winding temp"
                      />
                      {errors.windingTemp && <div className="error-message">{errors.windingTemp}</div>}
                    </td>
                  </tr>,
                  <tr key="row-17">
                    <td className="border border-gray-300 p-4 font-bold" rowSpan="4">{nextBushingIndex++}</td>
                    <td className="border border-gray-300 p-4 font-bold">Losses in kW (Subject to IS Tol)</td>
                    <td className="border border-gray-300 p-4"></td>
                  </tr>,
                  <tr key="row-18">
                    <td className="border border-gray-300 p-4 font-bold">No Load Loss<span className="text-red-500">*</span><br/><br></br>Tolerance, if any on the above values </td>
                    <td className="border border-gray-300 p-4">
                      <div className="flex flex-col gap-2">
                  <input
                          type="number"
                    name="noLoadLosses"
                    value={formData.noLoadLosses}
                    onChange={handleInputChange}
                          className="w-full p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                          step="any"
                        />
                        {errors.noLoadLosses && <div className="error-message">{errors.noLoadLosses}</div>}
                          <div className="flex items-center w-full"> 

                          <span className="mr-1 text-lg "></span> 
                         <input
                          type="text"
                          name="noLoadLossTolerance"
                          value={formData.noLoadLossTolerance || ''}
                          onChange={handleInputChange}
                          className="w-full p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                          placeholder="Tolerance (e.g. +10,-3% etc)"
                        />
                        </div>
                </div>
                    </td>
                  </tr>,
                  <tr key="row-19">
                    <td className="border border-gray-300 p-4 font-bold">Load Loss at 100% rated voltage & frequency @ 75 C<span className="text-red-500">*</span><br/><br></br>Tolerance, if any on the above values </td>
                    <td className="border border-gray-300 p-4">
                      <div className="flex flex-col gap-2">
                  <input
                          type="number"
                    name="loadLosses100"
                    value={formData.loadLosses100}
                    onChange={handleInputChange}
                          className="w-full p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                          step="any"
                        />
                        {errors.loadLosses100 && <div className="error-message">{errors.loadLosses100}</div>}
                          <div className="flex items-center w-full"> 

                          <span className="mr-1 text-lg "></span> 
                        <input
                          type="text"
                          name="loadLossTolerance"
                          value={formData.loadLossTolerance || ''}
                          onChange={handleInputChange}
                          className="w-full p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                          placeholder="Tolerance (e.g. +10,-3% etc)"
                        />
                        </div>
                </div>
                    </td>
                  </tr>,
                  <tr key="row-20">
                    <td className="border border-gray-300 p-4 font-bold">Auxiliary Loss <span className="text-red-500">*</span></td>
                    <td className="border border-gray-300 p-4">
                      <input
                        type="text"
                        name="auxiliaryLoss"
                        value={formData.auxiliaryLoss}
                        onChange={handleInputChange}
                        className="w-full p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                      />
                      {errors.auxiliaryLoss && <div className="error-message">{errors.auxiliaryLoss}</div>}
                    </td>
                  </tr>,
                  <tr key="row-21">
                    <td className="border border-gray-300 p-4 font-bold">{nextBushingIndex++}</td>
                    <td className="border border-gray-300 p-4 font-bold">Total Losses</td>
                    <td className="border border-gray-300 p-4">
                      <input
                        type="number"
                        name="maxLosses100"
                        value={
                          (parseFloat(formData.noLoadLosses) || 0) +
                          (parseFloat(formData.loadLosses100) || 0) +
                          (parseFloat(formData.auxiliaryLoss) || 0)
                        }
                        readOnly
                        className="w-full p-1 border rounded bg-gray-100 text-gray-800 focus:outline-none"
                      />
                    </td>
                  </tr>,
                  <tr key="row-22">
                    <td className="border border-gray-300 p-4 font-bold">{nextBushingIndex++}</td>
                    <td className="border border-gray-300 p-4 font-bold">Impedance Voltage<span className="text-red-500">*</span><br/><br></br>Tolerance, if any on the above values </td>
                    <td className="border border-gray-300 p-4">
                      <div className="flex flex-col gap-2">
                  <input
                    type="text"
                    name="impedanceVoltage"
                    value={formData.impedanceVoltage}
                    onChange={handleInputChange}
                          className="w-full p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                          placeholder="Impedance (%)"
                        />
                        {errors.impedanceVoltage && <div className="error-message">{errors.impedanceVoltage}</div>}
                        <input
                          type="text"
                          name="impedanceFor"
                          value={formData.impedanceFor || ''}
                          onChange={handleInputChange}
                          className="w-full p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                          placeholder="Impedance for (e.g., LV-HV, MV-Tertiary, etc.)"
                        />
                          <div className="flex items-center w-full"> 
                          <span className="mr-1 text-lg "></span> 
                        <input
                          type="text"
                          name="impedanceTolerance"
                          value={formData.impedanceTolerance || ''}
                          onChange={handleInputChange}
                          className="w-full p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                          placeholder="Tolerance"
                        />
                        </div>
                </div>
                    </td>
                  </tr>,
                  <tr key="row-23">
                    <td className="border border-gray-300 p-4 font-bold">{nextBushingIndex++}</td>
                    <td className="border border-gray-300 p-4 font-bold">Flux Density at 90% rated voltage (in Tesla) <span className="text-red-500">*</span></td>
                    <td className="border border-gray-300 p-4">
                  <input
                        type="number"
                        name="fluxDensity90"
                        value={formData.fluxDensity90}
                        onChange={handleInputChange}
                        className="w-full p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                        step="0.01"
                      />
                      {errors.fluxDensity90 && <div className="error-message">{errors.fluxDensity90}</div>}
                    </td>
                  </tr>,
                  <tr key="row-24">
                    <td className="border border-gray-300 p-4 font-bold">{nextBushingIndex++}</td>
                    <td className="border border-gray-300 p-4 font-bold">Flux Density at 100% rated voltage (in Tesla) <span className="text-red-500">*</span></td>
                    <td className="border border-gray-300 p-4">
                      <input
                        type="number"
                    name="fluxDensity100"
                    value={formData.fluxDensity100}
                    onChange={handleInputChange}
                        className="w-full p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                        step="0.01"
                      />
                      {errors.fluxDensity100 && <div className="error-message">{errors.fluxDensity100}</div>}
                    </td>
                  </tr>,
                  <tr key="row-25">
                    <td className="border border-gray-300 p-4 font-bold">{nextBushingIndex++}</td>
                    <td className="border border-gray-300 p-4 font-bold">Flux Density at 110% rated voltage (in Tesla) <span className="text-red-500">*</span></td>
                    <td className="border border-gray-300 p-4">
                  <input
                        type="number"
                        name="fluxDensity110"
                        value={formData.fluxDensity110}
                        onChange={handleInputChange}
                        className="w-full p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                        step="0.01"
                      />
                      {errors.fluxDensity110 && <div className="error-message">{errors.fluxDensity110}</div>}
                    </td>
                  </tr>,
                  <tr key="row-26">
                    <td className="border border-gray-300 p-4 font-bold">{nextBushingIndex++}</td>
                    <td className="border border-gray-300 p-4 font-bold">Current Density <span className="text-red-500">*</span></td>
                    <td className="border border-gray-300 p-4">
                      HV Winding (A/mm): <input
                        type="number"
                    name="currentDensityHV"
                    value={formData.currentDensityHV}
                    onChange={handleInputChange}
                        className="w-full p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500 mb-1"
                        step="0.01"
                      />
                      {errors.currentDensityHV && <div className="error-message">{errors.currentDensityHV}</div>}
                      <br />
                      {/* Only show LV if LV1/LV2 is NOT checked */}
                {!extraVoltageFields.lv1lv2 && (
                        <>
                          LV Winding (A/mm): <input
                            type="number"
                      name="currentDensityLV"
                      value={formData.currentDensityLV}
                      onChange={handleInputChange}
                            className="w-full p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                            step="0.01"
                    />
                          {errors.currentDensityLV && <div className="error-message">{errors.currentDensityLV}</div>}
                        </>
                )}
                      {/* Show LV1/LV2 if selected */}
                      {extraVoltageFields.lv1lv2 && (
                        <>
                          LV1 Winding (A/mm): <input
                            type="number"
                      name="currentDensityLV1"
                            value={formData.currentDensityLV1 || ''}
                      onChange={handleInputChange}
                            className="w-full p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500 mb-1"
                            step="0.01"
                          />
                          {errors.currentDensityLV1 && <div className="error-message">{errors.currentDensityLV1}</div>}
                          <br />
                          LV2 Winding (A/mm): <input
                            type="number"
                      name="currentDensityLV2"
                            value={formData.currentDensityLV2 || ''}
                      onChange={handleInputChange}
                            className="w-full p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                            step="0.01"
                          />
                          {errors.currentDensityLV2 && <div className="error-message">{errors.currentDensityLV2}</div>}
                        </>
                      )}
                    </td>
                  </tr>,
                  <tr key="row-27">
                    <td className="border border-gray-300 p-4 font-bold">{nextBushingIndex++}</td>
                    <td className="border border-gray-300 p-4 font-bold">Winding Insulation Material Class <span className="text-red-500">*</span></td>
                    <td className="border border-gray-300 p-4">
                  <input
                    type="text"
                    name="insulationClass"
                    value={formData.insulationClass}
                    onChange={handleInputChange}
                        className="w-full p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                      />
                      {errors.insulationClass && <div className="error-message">{errors.insulationClass}</div>}
                    </td>
                  </tr>,
                  <tr key="row-28">
                    <td className="border border-gray-300 p-4 font-bold">{nextBushingIndex++}</td>
                    <td className="border border-gray-300 p-4 font-bold">Withstand Time without injury with three phase dead short circuit(in secs) <span className="text-red-500">*</span></td>
                    <td className="border border-gray-300 p-4">
                  <input
                        type="text"
                        name="withstandTime"
                        value={formData.withstandTime}
                    onChange={handleInputChange}
                        className="w-full p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                        step="0.1"
                      />
                      {errors.withstandTime && <div className="error-message">{errors.withstandTime}</div>}
                    </td>
                  </tr>,
                  <tr key="row-29">
                    <td className="border border-gray-300 p-4 font-bold">{nextBushingIndex++}</td>
                    <td className="border border-gray-300 p-4 font-bold">Neutral terminal Bushing Current Transformer <span className="text-red-500">*</span></td>
                    <td className="border border-gray-300 p-4">
                  <input
                    type="text"
                    name="neutralCT"
                    value={formData.neutralCT}
                    onChange={handleInputChange}
                        className="w-full p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                      />
                      {errors.neutralCT && <div className="error-message">{errors.neutralCT}</div>}
                    </td>
                  </tr>,
                  <tr key="row-hv-bushing">
                    <td className="border border-gray-300 p-4 font-bold">{nextBushingIndex++}</td>
                    <td className="border border-gray-300 p-4 font-bold">HV Bushings<span className="text-red-500">*</span></td>
                    <td className="border border-gray-300 p-4">
                      <MultiSelectDropdown
                        options={bushingMakeOptions}
                        selected={formData.hvBushingMake}
                        onChange={(value) => handleInputChange({ target: { name: 'hvBushingMake', value } })}
                        placeholder="Select HV Bushing Make(s)"
                      /><br />{errors.hvBushingMake && <div className="error-message">{errors.hvBushingMake}</div>}
                      <div className="flex gap-2 mt-2">
                        <select
                          name="hvBushingKV"
                          value={formData.hvBushingKV || ''}
                          onChange={e => {
                            const kv = e.target.value;
                            const amps = formData.hvBushingAmps || '';
                            handleInputChange({ target: { name: 'hvBushingKV', value: kv } });
                            handleInputChange({ target: { name: 'hvBushingRating', value: kv && amps ? `${kv} KV ${amps} A` : kv ? `${kv} KV` : '' } });
                          }}
                          className="p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                        > 
                            <option value="">Select kV</option>
                            <option value="1.1">1.1</option>
                            <option value="3.6">3.6</option>
                            <option value="7.2">7.2</option>
                            <option value="12">12</option>
                            <option value="17.5">17.5</option>
                            <option value="24">24</option>
                            <option value="36">36</option>
                            <option value="72.5">72.5</option>
                            <option value="123">123</option>
                            <option value="145">145</option>
                            <option value="245">245</option>
                            <option value="420">420</option>
                          </select> {errors.hvBushingKV && <div className="error-message">{errors.hvBushingKV}</div>}
                        <select
                          name="hvBushingAmps"
                          value={formData.hvBushingAmps || ''}
                          onChange={e => {
                            const amps = e.target.value;
                            const kv = formData.hvBushingKV || '';
                            handleInputChange({ target: { name: 'hvBushingAmps', value: amps } });
                            handleInputChange({ target: { name: 'hvBushingRating', value: kv && amps ? `${kv} KV ${amps} A` : amps ? `${amps} A` : '' } });
                          }}
                          className="p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                        > 
                          <option value="">Select Amps</option>
                          <option value="250">250</option>
                          <option value="630">630</option>
                          <option value="800">800</option>
                          <option value="1000">1000</option>
                          <option value="1250">1250</option>
                          <option value="2000">2000</option>
                          <option value="3150">3150</option>
                          <option value="4000">4000</option>
                        </select> {errors.hvBushingAmps && <div className="error-message">{errors.hvBushingAmps}</div>}
                </div>
                    </td>
                  </tr>,
                  ...(extraVoltageFields.lv1lv2 ? [] : [
                    <tr key="row-lv-bushing">
                      <td className="border border-gray-300 p-4 font-bold">{nextBushingIndex++}</td>
                      <td className="border border-gray-300 p-4 font-bold">LV Bushings</td>
                      <td className="border border-gray-300 p-4">
                        <MultiSelectDropdown
                          options={bushingMakeOptions}
                          selected={formData.lvBushingMake}
                          onChange={(value) => handleInputChange({ target: { name: 'lvBushingMake', value } })}
                          placeholder="Select LV Bushing Make(s)"
                        /><br />  {errors.lvBushingMake && <div className="error-message">{errors.lvBushingMake}</div>}
                        <div className="flex gap-2 mt-2">
                          <select
                            name="lvBushingKV"
                            value={formData.lvBushingKV || ''}
                            onChange={e => {
                              const kv = e.target.value;
                              const amps = formData.lvBushingAmps || '';
                              handleInputChange({ target: { name: 'lvBushingKV', value: kv } });
                              handleInputChange({ target: { name: 'lvBushingRating', value: kv && amps ? `${kv} KV ${amps} A` : kv ? `${kv} KV` : '' } });
                              // If kV is changed to 52 or 72.5 and current amps is not in special list, reset amps
                              if ((kv === '52' || kv === '72.5') && !lvBushingAmpsSpecial.includes(amps)) {
                                handleInputChange({ target: { name: 'lvBushingAmps', value: '' } });
                              }
                              // If kV is changed to other and current amps is not in default list, reset amps
                              if (kv !== '52' && kv !== '72.5' && !lvBushingAmpsDefault.includes(amps)) {
                                handleInputChange({ target: { name: 'lvBushingAmps', value: '' } });
                              }
                            }}
                            className="p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                          > 
                            <option value="">Select kV</option>
                            <option value="1.1">1.1</option>
                            <option value="3.6">3.6</option>
                            <option value="7.2">7.2</option>
                            <option value="12">12</option>
                            <option value="17.5">17.5</option>
                            <option value="24">24</option>
                            <option value="36">36</option>
                            <option value="72.5">72.5</option>
                            <option value="123">123</option>
                            <option value="145">145</option>
                            <option value="245">245</option>
                            <option value="420">420</option>
                          </select>  {errors.lvBushingKV && <div className="error-message">{errors.lvBushingKV}</div>}
                          <select
                            name="lvBushingAmps"
                            value={formData.lvBushingAmps || ''}
                            onChange={e => {
                              const amps = e.target.value;
                              const kv = formData.lvBushingKV || '';
                              handleInputChange({ target: { name: 'lvBushingAmps', value: amps } });
                              handleInputChange({ target: { name: 'lvBushingRating', value: kv && amps ? `${kv} KV ${amps} A` : amps ? `${amps} A` : '' } });
                            }}
                            className="p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                          >
                            <option value="">Select Amps</option>
                            <option value="250">250</option>
                            <option value="630">630</option>
                            <option value="800">800</option>
                            <option value="1000">1000</option>
                            <option value="1250">1250</option>
                            <option value="2000">2000</option>
                            <option value="3150">3150</option>
                            <option value="4000">4000</option>
                          </select>  {errors.lvBushingAmps && <div className="error-message">{errors.lvBushingAmps}</div>}
                        </div>
                      </td>
                    </tr>
                  ]),
                  ...(extraVoltageFields.mv ? [
                    <tr key="row-mv-bushing">
                      <td className="border border-gray-300 p-4 font-bold">{nextBushingIndex++}</td>
                      <td className="border border-gray-300 p-4 font-bold">MV Bushings<span className="text-red-500">*</span></td>
                      <td className="border border-gray-300 p-4">
                        <MultiSelectDropdown
                          options={bushingMakeOptions}
                          selected={formData.mvBushingMake}
                          onChange={value => handleInputChange({ target: { name: 'mvBushingMake', value } })}
                          placeholder="Select MV Bushing Make(s)"
                        /><br />{errors.mvBushingMake && <div className="error-message">{errors.mvBushingMake}</div>}
                        <div className="flex gap-2 mt-2">
                          <select
                            name="mvBushingKV"
                            value={formData.mvBushingKV || ''}
                            onChange={e => {
                              const kv = e.target.value;
                              const amps = formData.mvBushingAmps || '';
                              handleInputChange({ target: { name: 'mvBushingKV', value: kv } });
                              handleInputChange({ target: { name: 'mvBushingRating', value: kv && amps ? `${kv} KV ${amps} A` : kv ? `${kv} KV` : '' } });
                            }}
                            className="p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                          >
                           <option value="">Select kV</option>
                            <option value="1.1">1.1</option>
                            <option value="3.6">3.6</option>
                            <option value="7.2">7.2</option>
                            <option value="12">12</option>
                            <option value="17.5">17.5</option>
                            <option value="24">24</option>
                            <option value="36">36</option>
                            <option value="72.5">72.5</option>
                            <option value="123">123</option>
                            <option value="145">145</option>
                            <option value="245">245</option>
                            <option value="420">420</option>
                          </select>{errors.mvBushingKV && <div className="error-message">{errors.mvBushingKV}</div>}
                          <select
                            name="mvBushingAmps"
                            value={formData.mvBushingAmps || ''}
                            onChange={e => {
                              const amps = e.target.value;
                              const kv = formData.mvBushingKV || '';
                              handleInputChange({ target: { name: 'mvBushingAmps', value: amps } });
                              handleInputChange({ target: { name: 'mvBushingRating', value: kv && amps ? `${kv} KV ${amps} A` : amps ? `${amps} A` : '' } });
                            }}
                            className="p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                          >
                            <option value="">Select Amps</option>
                            <option value="250">250</option>
                            <option value="630">630</option>
                            <option value="800">800</option>
                            <option value="1000">1000</option>
                            <option value="1250">1250</option>
                            <option value="2000">2000</option>
                            <option value="3150">3150</option>
                            <option value="4000">4000</option>
                          </select>{errors.mvBushingAmps && <div className="error-message">{errors.mvBushingAmps}</div>}
                        </div>
                        
                      </td>
                    </tr>
                  ] : []),
                  ...(extraVoltageFields.lv1lv2 ? [
                    <tr key="row-lv1-bushing">
                      <td className="border border-gray-300 p-4 font-bold">{nextBushingIndex++}</td>
                      <td className="border border-gray-300 p-4 font-bold">LV1 Bushings<span className="text-red-500">*</span></td>
                      <td className="border border-gray-300 p-4">
                        <MultiSelectDropdown
                          options={bushingMakeOptions}
                          selected={formData.lv1BushingMake}
                          onChange={value => handleInputChange({ target: { name: 'lv1BushingMake', value } })}
                          placeholder="Select LV1 Bushing Make(s)"
                        /><br />
                        {errors.lv1BushingMake && <div className="error-message">{errors.lv1BushingMake}</div>}
                        <div className="flex gap-2 mt-2">
                          <select
                            name="lv1BushingKV"
                            value={formData.lv1BushingKV || ''}
                            onChange={e => {
                              const kv = e.target.value;
                              const amps = formData.lv1BushingAmps || '';
                              handleInputChange({ target: { name: 'lv1BushingKV', value: kv } });
                              handleInputChange({ target: { name: 'lv1BushingRating', value: kv && amps ? `${kv} KV ${amps} A` : kv ? `${kv} KV` : '' } });
                            }}
                            className="p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                          >
                            <option value="">Select kV</option>
                            <option value="1.1">1.1</option>
                            <option value="3.6">3.6</option>
                            <option value="7.2">7.2</option>
                            <option value="12">12</option>
                            <option value="17.5">17.5</option>
                            <option value="24">24</option>
                            <option value="36">36</option>
                            <option value="72.5">72.5</option>
                            <option value="123">123</option>
                            <option value="145">145</option>
                            <option value="245">245</option>
                            <option value="420">420</option>
                          </select>
                          {errors.lv1BushingKV && <div className="error-message">{errors.lv1BushingKV}</div>}
                          <select
                            name="lv1BushingAmps"
                            value={formData.lv1BushingAmps || ''}
                            onChange={e => {
                              const amps = e.target.value;
                              const kv = formData.lv1BushingKV || '';
                              handleInputChange({ target: { name: 'lv1BushingAmps', value: amps } });
                              handleInputChange({ target: { name: 'lv1BushingRating', value: kv && amps ? `${kv} KV ${amps} A` : amps ? `${amps} A` : '' } });
                            }}
                            className="p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                          >
                            <option value="">Select Amps</option>
                            <option value="250">250</option>
                            <option value="630">630</option>
                            <option value="800">800</option>
                            <option value="1000">1000</option>
                            <option value="1250">1250</option>
                            <option value="2000">2000</option>
                            <option value="3150">3150</option>
                            <option value="4000">4000</option>
                          </select>
                          {errors.lv1BushingAmps && <div className="error-message">{errors.lv1BushingAmps}</div>}
                        </div>
                      </td>
                    </tr>,
                    <tr key="row-lv2-bushing">
                      <td className="border border-gray-300 p-4 font-bold">{nextBushingIndex++}</td>
                      <td className="border border-gray-300 p-4 font-bold">LV2 Bushings<span className="text-red-500">*</span></td>
                      <td className="border border-gray-300 p-4">
                        <MultiSelectDropdown
                          options={bushingMakeOptions}
                          selected={formData.lv2BushingMake}
                          onChange={value => handleInputChange({ target: { name: 'lv2BushingMake', value } })}
                          placeholder="Select LV2 Bushing Make(s)"
                        /><br />
                        {errors.lv2BushingMake && <div className="error-message">{errors.lv2BushingMake}</div>}
                        <div className="flex gap-2 mt-2">
                          <select
                            name="lv2BushingKV"
                            value={formData.lv2BushingKV || ''}
                            onChange={e => {
                              const kv = e.target.value;
                              const amps = formData.lv2BushingAmps || '';
                              handleInputChange({ target: { name: 'lv2BushingKV', value: kv } });
                              handleInputChange({ target: { name: 'lv2BushingRating', value: kv && amps ? `${kv} KV ${amps} A` : kv ? `${kv} KV` : '' } });
                            }}
                            className="p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                          >
                            <option value="">Select kV</option>
                            <option value="1.1">1.1</option>
                            <option value="3.6">3.6</option>
                            <option value="7.2">7.2</option>
                            <option value="12">12</option>
                            <option value="17.5">17.5</option>
                            <option value="24">24</option>
                            <option value="36">36</option>
                            <option value="72.5">72.5</option>
                            <option value="123">123</option>
                            <option value="145">145</option>
                            <option value="245">245</option>
                            <option value="420">420</option>
                          </select>
                          {errors.lv2BushingKV && <div className="error-message">{errors.lv2BushingKV}</div>}
                          <select
                            name="lv2BushingAmps"
                            value={formData.lv2BushingAmps || ''}
                            onChange={e => {
                              const amps = e.target.value;
                              const kv = formData.lv2BushingKV || '';
                              handleInputChange({ target: { name: 'lv2BushingAmps', value: amps } });
                              handleInputChange({ target: { name: 'lv2BushingRating', value: kv && amps ? `${kv} KV ${amps} A` : amps ? `${amps} A` : '' } });
                            }}
                            className="p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                          >
                            <option value="">Select Amps</option>
                            <option value="250">250</option>
                            <option value="630">630</option>
                            <option value="800">800</option>
                            <option value="1000">1000</option>
                            <option value="1250">1250</option>
                            <option value="2000">2000</option>
                            <option value="3150">3150</option>
                            <option value="4000">4000</option>
                          </select>
                          {errors.lv2BushingAmps && <div className="error-message">{errors.lv2BushingAmps}</div>}
                        </div>
                      </td>
                    </tr>
                  ] : []),
                  extraVoltageFields.tertiary && (
                    <tr key="row-tertiary-bushing">
                      <td className="border border-gray-300 p-4 font-bold">{nextBushingIndex++}</td>
                      <td className="border border-gray-300 p-4 font-bold">Tertiary Bushings<span className="text-red-500">*</span></td>
                      <td className="border border-gray-300 p-4">
                        <MultiSelectDropdown
                          options={bushingMakeOptions}
                          selected={formData.tertiaryBushingMake}
                          onChange={value => handleInputChange({ target: { name: 'tertiaryBushingMake', value } })}
                          placeholder="Select Tertiary Bushing Make(s)"
                        /><br />
                        {errors.tertiaryBushingMake && <div className="error-message">{errors.tertiaryBushingMake}</div>}
                        <div className="flex gap-2 mt-2">
                          <select
                            name="tertiaryBushingKV"
                            value={formData.tertiaryBushingKV || ''}
                            onChange={e => {
                              const kv = e.target.value;
                              const amps = formData.tertiaryBushingAmps || '';
                              handleInputChange({ target: { name: 'tertiaryBushingKV', value: kv } });
                              handleInputChange({ target: { name: 'tertiaryBushingRating', value: kv && amps ? `${kv} KV ${amps} A` : kv ? `${kv} KV` : '' } });
                            }}
                            className="p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                          >
                           <option value="">Select kV</option>
                            <option value="1.1">1.1</option>
                            <option value="3.6">3.6</option>
                            <option value="7.2">7.2</option>
                            <option value="12">12</option>
                            <option value="17.5">17.5</option>
                            <option value="24">24</option>
                            <option value="36">36</option>
                            <option value="72.5">72.5</option>
                            <option value="123">123</option>
                            <option value="145">145</option>
                            <option value="245">245</option>
                            <option value="420">420</option>
                          </select>
                          {errors.tertiaryBushingKV && <div className="error-message">{errors.tertiaryBushingKV}</div>}
                          <select
                            name="tertiaryBushingAmps"
                            value={formData.tertiaryBushingAmps || ''}
                            onChange={e => {
                              const amps = e.target.value;
                              const kv = formData.tertiaryBushingKV || '';
                              handleInputChange({ target: { name: 'tertiaryBushingAmps', value: amps } });
                              handleInputChange({ target: { name: 'tertiaryBushingRating', value: kv && amps ? `${kv} KV ${amps} A` : amps ? `${amps} A` : '' } });
                            }}
                            className="p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                          >
                            <option value="">Select Amps</option>
                            <option value="250">250</option>
                            <option value="630">630</option>
                            <option value="800">800</option>
                            <option value="1000">1000</option>
                            <option value="1250">1250</option>
                            <option value="2000">2000</option>
                            <option value="3150">3150</option>
                            <option value="4000">4000</option>
                          </select>
                          {errors.tertiaryBushingAmps && <div className="error-message">{errors.tertiaryBushingAmps}</div>}
                        </div>
                      </td>
                    </tr>
                  ),
                  <tr key="row-32">
                    <td className="border border-gray-300 p-4 font-bold">{nextBushingIndex++}</td>
                    <td className="border border-gray-300 p-4 font-bold">Marshalling Box Degree of Protection<span className="text-red-500">*</span></td>
                    <td className="border border-gray-300 p-4">
                  <input
                    type="text"
                    name="marshallingBoxProtection"
                    value={formData.marshallingBoxProtection}
                    onChange={handleInputChange}
                        className="w-full p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                      />
                      {errors.marshallingBoxProtection && <div className="error-message">{errors.marshallingBoxProtection}</div>}
                    </td>
                  </tr>,
                  <tr key="row-33">
                    <td className="border border-gray-300 p-4 font-bold">{nextBushingIndex++}</td>
                    <td className="border border-gray-300 p-4 font-bold">Magnetisation Current<span className="text-red-500">*</span></td>
                    <td className="border border-gray-300 p-4">
                      <input
                        type="text"
                        name="magnetisationCurrent"
                        value={formData.magnetisationCurrent}
                        onChange={handleInputChange}
                        className="w-full p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                      />
                      {errors.magnetisationCurrent && <div className="error-message">{errors.magnetisationCurrent}</div>}
                    </td>
                  </tr>,
                  <tr key="row-34">
                    <td className="border border-gray-300 p-4 font-bold">{nextBushingIndex++}</td>
                    <td className="border border-gray-300 p-4 font-bold">Termination Arrangement<span className="text-red-500">*</span><br /></td>
                    <td className="border border-gray-300 p-4">
                      {/* HV Termination */}
<span className="block text-xs text-gray-700 mb-1">HV:</span>
<MultiSelectComboBox
  options={terminationArrangementOptions}
  value={formData.hvTerminationArrangement || []}
  onChange={val => handleInputChange({ target: { name: 'hvTerminationArrangement', value: val } })}
  placeholder="Select or enter termination arrangement(s)"
/>
{errors.hvTerminationArrangement && <div className="error-message">{errors.hvTerminationArrangement}</div>}

{/* LV Termination - show only if LV1/LV2 not selected */}
{!extraVoltageFields.lv1lv2 && (
  <>
    <span className="block text-xs text-gray-700 mt-2 mb-1">LV:</span>
    <MultiSelectComboBox
      options={terminationArrangementOptions}
      value={formData.lvTerminationArrangement || []}
      onChange={val => handleInputChange({ target: { name: 'lvTerminationArrangement', value: val } })}
      placeholder="Select or enter termination arrangement(s)"
    />
    {errors.lvTerminationArrangement && <div className="error-message">{errors.lvTerminationArrangement}</div>}
  </>
)}

{/* LV1/LV2 Terminations - show if selected */}
{extraVoltageFields.lv1lv2 && (
  <>
    <span className="block text-xs text-gray-700 mt-2 mb-1">LV1:</span>
    <MultiSelectComboBox
      options={terminationArrangementOptions}
      value={formData.lv1TerminationArrangement || []}
      onChange={val => handleInputChange({ target: { name: 'lv1TerminationArrangement', value: val } })}
      placeholder="Select or enter termination arrangement(s)"
    />
    {errors.lv1TerminationArrangement && <div className="error-message">{errors.lv1TerminationArrangement}</div>}

    <span className="block text-xs text-gray-700 mt-2 mb-1">LV2:</span>
    <MultiSelectComboBox
      options={terminationArrangementOptions}
      value={formData.lv2TerminationArrangement || []}
      onChange={val => handleInputChange({ target: { name: 'lv2TerminationArrangement', value: val } })}
      placeholder="Select or enter termination arrangement(s)"
    />
    {errors.lv2TerminationArrangement && <div className="error-message">{errors.lv2TerminationArrangement}</div>}
  </>
)}

{/* MV Termination - show if selected */}
{extraVoltageFields.mv && (
  <>
    <span className="block text-xs text-gray-700 mt-2 mb-1">MV:</span>
    <MultiSelectComboBox
      options={terminationArrangementOptions}
      value={formData.mvTerminationArrangement || []}
      onChange={val => handleInputChange({ target: { name: 'mvTerminationArrangement', value: val } })}
      placeholder="Select or enter termination arrangement(s)"
    />
    {errors.mvTerminationArrangement && <div className="error-message">{errors.mvTerminationArrangement}</div>}
  </>
)}

{/* Tertiary Termination - show if selected */}
{extraVoltageFields.tertiary && (
  <>
    <span className="block text-xs text-gray-700 mt-2 mb-1">Tertiary:</span>
    <MultiSelectComboBox
      options={terminationArrangementOptions}
      value={formData.tertiaryTerminationArrangement || []}
      onChange={val => handleInputChange({ target: { name: 'tertiaryTerminationArrangement', value: val } })}
      placeholder="Select or enter termination arrangement(s)"
    />
    {errors.tertiaryTerminationArrangement && <div className="error-message">{errors.tertiaryTerminationArrangement}</div>}
  </>
)}
                    </td>
                  </tr>,
                  <tr key="row-35">
                    <td className="border border-gray-300 p-4 font-bold">{nextBushingIndex++}</td>
                  <td className="border border-gray-300 p-4 font-bold">Paint<span className="text-red-500">*</span></td>
                  <td className="border border-gray-300 p-4">
                   
                    
                    <MultiSelectComboBox
                      options={paintOptions}
                      value={formData.paint || []}
                      onChange={val => setFormData(prev => ({ ...prev, paint: val }))}
                      placeholder="Select or enter paint type(s)"
                    />
                    {errors.paint && <div className="error-message">{errors.paint}</div>}
                  </td>
                  </tr>,
                  <tr key="row-35a">
                    <td className="border border-gray-300 p-4 font-bold">{nextBushingIndex++}</td>
                    <td className="border border-gray-300 p-4 font-bold">Transformer Oil</td>
                    <td className="border border-gray-300 p-4">
                      <input
                        type="text"
                        name="transformerOil"
                        value={formData.transformerOil}
                        onChange={handleInputChange}
                        className="w-full p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                        placeholder="Enter transformer oil details"
                      />
                      {errors.transformerOil && <div className="error-message">{errors.transformerOil}</div>}
                    </td>
                  </tr>,
                  <tr key="row-36">
                    <td className="border border-gray-300 p-4 font-bold">{nextBushingIndex++}</td>
                    <td className="border border-gray-300 p-4 font-bold">Details of Tanks<span className="text-red-500">*</span></td>
                    <td className="border border-gray-300 p-4">
                      
                      <div className="mb-2">
                        <span className="font-semibold"> Approximate thickness of sheet:(in mm)</span>
                        <div className="ml-4">
                          <div className="flex items-center mb-1">
                            <span className="mr-2">a. Sides</span>
                            <input type="text" name="thicknessSides" value={formData.detailsOfTanks.thicknessSides} onChange={e => setFormData(prev => ({ ...prev, detailsOfTanks: { ...prev.detailsOfTanks, thicknessSides: e.target.value } }))} className="w-16 p-1 border rounded ml-2" placeholder="in mm" />
                            <span className="ml-1">mm</span>
                            </div>
                          {errors.thicknessSides && <div className="error-message">{errors.thicknessSides}</div>}
                          <div className="flex items-center mb-1">
                            <span className="mr-2">b. Bottom</span>
                            <input type="text" name="thicknessBottom" value={formData.detailsOfTanks.thicknessBottom} onChange={e => setFormData(prev => ({ ...prev, detailsOfTanks: { ...prev.detailsOfTanks, thicknessBottom: e.target.value } }))} className="w-16 p-1 border rounded ml-2" placeholder="in mm" />
                            <span className="ml-1">mm</span>
                            </div>
                          {errors.thicknessBottom && <div className="error-message">{errors.thicknessBottom}</div>}
                          <div className="flex items-center mb-1">
                            <span className="mr-2">c. Top Cover</span>
                            <input type="text" name="thicknessTopCover" value={formData.detailsOfTanks.thicknessTopCover} onChange={e => setFormData(prev => ({ ...prev, detailsOfTanks: { ...prev.detailsOfTanks, thicknessTopCover: e.target.value } }))} className="w-16 p-1 border rounded ml-2" placeholder="in mm" />
                            <span className="ml-1">mm</span>
                            </div>
                          {errors.thicknessTopCover && <div className="error-message">{errors.thicknessTopCover}</div>}
                          <div className="flex items-center mb-1">
                            <span className="mr-2">d. Cooling Tubes / Radiators</span>
                            <input type="text" name="thicknessRadiators" value={formData.detailsOfTanks.thicknessRadiators} onChange={e => setFormData(prev => ({ ...prev, detailsOfTanks: { ...prev.detailsOfTanks, thicknessRadiators: e.target.value } }))} className="w-16 p-1 border rounded ml-2" placeholder="in mm" />
                            <span className="ml-1">mm</span>
                          </div>
                          {errors.thicknessRadiators && <div className="error-message">{errors.thicknessRadiators}</div>}
                        </div>
                      </div>
                    </td>
                  </tr>,
                  <tr key="row-37">
                    <td className="border border-gray-300 p-4 font-bold">{nextBushingIndex++}</td>
                    <td className="border border-gray-300 p-4 font-bold">Material of Tank (As per IS:2062 grade A E250)<span className="text-red-500">*</span></td>
                    <td className="border border-gray-300 p-4">
                      <div className="mb-2">
                        <span className="font-semibold">a. Material of Tank:</span><br />
                        <select
                          name="materialOfTank"
                          value={formData.detailsOfTanks.materialOfTank || ''}
                          onChange={e => setFormData(prev => ({ ...prev, detailsOfTanks: { ...prev.detailsOfTanks, materialOfTank: e.target.value } }))}
                          className="w-full p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500 mb-2"
                        >
                          <option value="">Select Material</option>
                          <option value="Low Carbon Steel">Low Carbon Steel</option>
                          <option value="Mild Steel">Mild Steel</option>
                        </select>
                        {errors.materialOfTank && <div className="error-message">{errors.materialOfTank}</div>}
              </div>
              <div>
                        <span className="font-semibold">b. Construction:</span><br />
                        <select
                          name="construction"
                          value={["Bell Mounting", "Conventional"].includes(formData.detailsOfTanks.construction) ? formData.detailsOfTanks.construction : 'Custom'}
                          onChange={e => {
                            const value = e.target.value;
                            if (value === 'Custom') {
                              setFormData(prev => ({ ...prev, detailsOfTanks: { ...prev.detailsOfTanks, construction: '' } }));
                            } else {
                              setFormData(prev => ({ ...prev, detailsOfTanks: { ...prev.detailsOfTanks, construction: value } }));
                            }
                          }}
                          className="w-full p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500 mb-2"
                        >
                          <option value="" disabled>Select Construction</option>
                          <option value="Bell Mounting">Bell Mounting</option>
                          <option value="Conventional">Conventional</option>
                          <option value="Custom">Custom</option>
                        </select>
                        {!["Bell Mounting", "Conventional"].includes(formData.detailsOfTanks.construction) && (
                  <input
                    type="text"
                  name="construction"
                            value={formData.detailsOfTanks.construction || ''}
                            onChange={e => setFormData(prev => ({ ...prev, detailsOfTanks: { ...prev.detailsOfTanks, construction: e.target.value } }))}
                            className="w-full p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500 mt-2"
                            placeholder="Enter Construction"
                          />
                        )}
                        {errors.tankConstruction && <div className="error-message">{errors.tankConstruction}</div>}
                </div>
                    </td>
                  </tr>,
                  <tr key="row-38">
                    <td className="border border-gray-300 p-4 font-bold">{nextBushingIndex++}</td>
                    <td className="border border-gray-300 p-4 font-bold">Core lamination:<span className="text-red-500">*</span></td>
                    <td className="border border-gray-300 p-4" >
                      a. Material of core laminations
                  <input
                    type="text"
                    name="coreLaminationMaterial"
                    value={formData.coreLaminationMaterial}
                    onChange={handleInputChange}
                        className="w-40 p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500 mx-2"
                      /><br />{errors.coreLaminationMaterial && <div className="error-message">{errors.coreLaminationMaterial}</div>}<br></br>
                      
                      b. Thickness of core laminations
                      <span className="mx-1">&#8804;</span>
                      <input
                        type="text"
                        name="coreLaminationThickness"
                        value={formData.coreLaminationThickness}
                        onChange={handleInputChange}
                        className="w-40 p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500 mx-2"
                        placeholder="in mm"
                      />
                      <br />{errors.coreLaminationThickness && <div className="error-message">{errors.coreLaminationThickness}</div>}<br />
                      c. Type of construction
                      <input
                        type="text"
                        name="constructionType"
                        value={formData.constructionType}
                        onChange={handleInputChange}
                        className="w-40 p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500 mx-2"
                        placeholder="Type of construction"
                      />
                      <br /><br />
                      d. Type of core joints
                      <input
                        type="text"
                        name="coreJointType"
                        value={formData.coreJointType}
                        onChange={handleInputChange}
                        className="w-40 p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500 mx-2"
                        placeholder="Type of core joints"
                      />
                    </td>
                  </tr>,
                  <tr key="row-39">
                    <td className="border border-gray-300 p-4 font-bold">{nextBushingIndex++}</td>
                    <td className="border border-gray-300 p-4 font-bold">Insulating material used for:<span className="text-red-500">*</span></td>
                    <td className="border border-gray-300 p-4" >
                      a. HV winding
                    <MultiSelectDropdown
                        options={["Kraft Paper", "Press Board", "PCPB"]}
                        selected={formData.insulatingMaterialHV}
                        onChange={value => setFormData(prev => ({ ...prev, insulatingMaterialHV: value }))}
                        placeholder={<span style={{color: 'rgba(128,128,128,0.5)'}}>Select material</span>}
                      />
                      {errors.insulatingMaterialHV && <div className="error-message">{errors.insulatingMaterialHV}</div>}
                      <br />
                      {extraVoltageFields.lv1lv2 ? (
                        <>
                          b. LV1 winding
                          <MultiSelectDropdown
                            options={["Kraft Paper", "Press Board", "PCPB"]}
                            selected={formData.insulatingMaterialLV1 || []}
                            onChange={value => setFormData(prev => ({ ...prev, insulatingMaterialLV1: value }))}
                            placeholder={<span style={{color: 'rgba(128,128,128,0.5)'}}>Select material</span>}
                          />
                          {errors.insulatingMaterialLV1 && <div className="error-message">{errors.insulatingMaterialLV1}</div>}
                          <br />
                          c. LV2 winding
                          <MultiSelectDropdown
                            options={["Kraft Paper", "Press Board", "PCPB"]}
                            selected={formData.insulatingMaterialLV2 || []}
                            onChange={value => setFormData(prev => ({ ...prev, insulatingMaterialLV2: value }))}
                            placeholder={<span style={{color: 'rgba(128,128,128,0.5)'}}>Select material</span>}
                          />
                          {errors.insulatingMaterialLV2 && <div className="error-message">{errors.insulatingMaterialLV2}</div>}<br />
                        </>
                      ) : (
                        <>
                          b. LV winding
                          <MultiSelectDropdown
                            options={["Kraft Paper", "Press Board", "PCPB"]}
                            selected={formData.insulatingMaterialLV}
                            onChange={value => setFormData(prev => ({ ...prev, insulatingMaterialLV: value }))}
                            placeholder={<span style={{color: 'rgba(128,128,128,0.5)'}}>Select material</span>}
                          />
                          {errors.insulatingMaterialLV && <div className="error-message">{errors.insulatingMaterialLV}</div>}<br />
                        </>
                      )}
                      {extraVoltageFields.mv && (
                        <>
                          {extraVoltageFields.lv1lv2 ? 'd.' : 'c.'} MV winding
                    <MultiSelectDropdown
                            options={["Kraft Paper", "Press Board", "PCPB"]}
                            selected={formData.insulatingMaterialMV || []}
                            onChange={value => setFormData(prev => ({ ...prev, insulatingMaterialMV: value }))}
                            placeholder={<span style={{color: 'rgba(128,128,128,0.5)'}}>Select material</span>}
                          />
                          {errors.insulatingMaterialMV && <div className="error-message">{errors.insulatingMaterialMV}</div>}<br />
                        </>
                      )}
                      {extraVoltageFields.tertiary && (
                        <>
                          {extraVoltageFields.lv1lv2 ? (extraVoltageFields.mv ? 'e.' : 'd.') : (extraVoltageFields.mv ? 'd.' : 'c.')} Tertiary winding
                          <MultiSelectDropdown
                            options={["Kraft Paper", "Press Board", "PCPB"]}
                            selected={formData.insulatingMaterialTertiary || []}
                            onChange={value => setFormData(prev => ({ ...prev, insulatingMaterialTertiary: value }))}
                            placeholder={<span style={{color: 'rgba(128,128,128,0.5)'}}>Select material</span>}
                          />
                          {errors.insulatingMaterialTertiary && <div className="error-message">{errors.insulatingMaterialTertiary}</div>}<br />
                        </>
                      )}
                    </td>
                  </tr>,
                  <tr key="row-40">
                    <td className="border border-gray-300 p-4 font-bold">{nextBushingIndex++}</td>
                    <td className="border border-gray-300 p-4 font-bold">Insulating material used between:<span className="text-red-500">*</span></td>
                    <td className="border border-gray-300 p-4" >
                      a. HV and {extraVoltageFields.lv1lv2 ? 'LV1' : 'LV'} winding
                      <MultiSelectDropdown
                        options={["PCPB", "EHV Grade Oil", "Perma Wood"]}
                        selected={formData.insulatingMaterialBetweenHVLV1 || formData.insulatingMaterialBetweenHVLV}
                        onChange={value => setFormData(prev => ({ ...prev, insulatingMaterialBetweenHVLV1: value, insulatingMaterialBetweenHVLV: value }))}
                        placeholder={<span style={{color: 'rgba(128,128,128,0.5)'}}>Select material</span>}
                      />
                      {errors.insulatingMaterialBetweenHVLV && <div className="error-message">{errors.insulatingMaterialBetweenHVLV}</div>}<br />
                {extraVoltageFields.lv1lv2 && (
                        <>
                          b. HV and LV2 winding
                    <MultiSelectDropdown
                            options={["PCPB", "EHV Grade Oil", "Perma Wood"]}
                            selected={formData.insulatingMaterialBetweenHVLV2 || []}
                            onChange={value => handleInputChange({ target: { name: 'insulatingMaterialBetweenHVLV2', value } })}
                            placeholder={<span style={{color: 'rgba(128,128,128,0.5)'}}>Select material</span>}
                          />
                          {errors.insulatingMaterialBetweenHVLV2 && <div className="error-message">{errors.insulatingMaterialBetweenHVLV2}</div>}<br />
                        </>
                      )}
                      {extraVoltageFields.mv && (
                        <>
                          {extraVoltageFields.lv1lv2 ? 'c.' : 'b.'} HV and MV winding
                  <MultiSelectDropdown
                            options={["PCPB", "EHV Grade Oil", "Perma Wood"]}
                            selected={formData.insulatingMaterialBetweenHVMV || []}
                            onChange={value => setFormData(prev => ({ ...prev, insulatingMaterialBetweenHVMV: value }))}
                            placeholder={<span style={{color: 'rgba(128,128,128,0.5)'}}>Select material</span>}
                          />
                          {errors.insulatingMaterialBetweenHVMV && <div className="error-message">{errors.insulatingMaterialBetweenHVMV}</div>}<br />
                        </>
                      )}
                      {extraVoltageFields.tertiary && (
                        <>
                          {extraVoltageFields.lv1lv2 ? (extraVoltageFields.mv ? 'd.' : 'c.') : (extraVoltageFields.mv ? 'd.' : 'b.')} HV and Tertiary winding
                    <MultiSelectDropdown
                            options={["PCPB", "EHV Grade Oil", "Perma Wood"]}
                            selected={formData.insulatingMaterialBetweenHVTertiary || []}
                            onChange={value => setFormData(prev => ({ ...prev, insulatingMaterialBetweenHVTertiary: value }))}
                            placeholder={<span style={{color: 'rgba(128,128,128,0.5)'}}>Select material</span>}
                          />
                          {errors.insulatingMaterialBetweenHVTertiary && <div className="error-message">{errors.insulatingMaterialBetweenHVTertiary}</div>}<br />
                        </>
                      )}
                      {/* LV/LV1/LV2/MV/Tertiary and core logic */}
                      {extraVoltageFields.lv1lv2 ? (
                        <>
                          {extraVoltageFields.mv || extraVoltageFields.tertiary ? (extraVoltageFields.mv && extraVoltageFields.tertiary ? 'e.' : 'd.') : 'c.'} LV1 winding and core
                          <MultiSelectDropdown
                            options={["PCPB", "EHV Grade Oil", "Perma Wood"]}
                            selected={formData.insulatingMaterialBetweenLV1Core || []}
                            onChange={value => setFormData(prev => ({ ...prev, insulatingMaterialBetweenLV1Core: value }))}
                            placeholder={<span style={{color: 'rgba(128,128,128,0.5)'}}>Select material</span>}
                          />
                          {errors.insulatingMaterialBetweenLV1Core && <div className="error-message">{errors.insulatingMaterialBetweenLV1Core}</div>}<br />
                          {extraVoltageFields.mv || extraVoltageFields.tertiary ? (extraVoltageFields.mv && extraVoltageFields.tertiary ? 'f.' : 'e.') : 'd.'} LV2 winding and core
                          <MultiSelectDropdown
                            options={["PCPB", "EHV Grade Oil", "Perma Wood"]}
                            selected={formData.insulatingMaterialBetweenLV2Core || []}
                            onChange={value => setFormData(prev => ({ ...prev, insulatingMaterialBetweenLV2Core: value }))}
                            placeholder={<span style={{color: 'rgba(128,128,128,0.5)'}}>Select material</span>}
                          />
                          {errors.insulatingMaterialBetweenLV2Core && <div className="error-message">{errors.insulatingMaterialBetweenLV2Core}</div>}<br />
                        </>
                      ) : (
                        <>
                          {extraVoltageFields.mv || extraVoltageFields.tertiary ? 'c.' : 'b.'} LV winding and core
                          <MultiSelectDropdown
                            options={["PCPB", "EHV Grade Oil", "Perma Wood"]}
                            selected={formData.insulatingMaterialBetweenLVCore}
                            onChange={value => setFormData(prev => ({ ...prev, insulatingMaterialBetweenLVCore: value }))}
                            placeholder={<span style={{color: 'rgba(128,128,128,0.5)'}}>Select material</span>}
                          />
                          {errors.insulatingMaterialBetweenLVCore && <div className="error-message">{errors.insulatingMaterialBetweenLVCore}</div>}<br />
                        </>
                      )}
                      {extraVoltageFields.mv && (
                        <>
                          {extraVoltageFields.lv1lv2 ? (extraVoltageFields.tertiary ? 'g.' : 'f.') : (extraVoltageFields.tertiary ? 'd.' : 'c.')} MV winding and core
                    <MultiSelectDropdown
                            options={["PCPB", "EHV Grade Oil", "Perma Wood"]}
                            selected={formData.insulatingMaterialBetweenMVCore || []}
                            onChange={value => setFormData(prev => ({ ...prev, insulatingMaterialBetweenMVCore: value }))}
                            placeholder={<span style={{color: 'rgba(128,128,128,0.5)'}}>Select material</span>}
                          />
                          {errors.insulatingMaterialBetweenMVCore && <div className="error-message">{errors.insulatingMaterialBetweenMVCore}</div>}<br />
                        </>
                      )}
                      {extraVoltageFields.tertiary && (
                        <>
                          {extraVoltageFields.lv1lv2 ? 'h.' : extraVoltageFields.mv ? 'e.' : 'c.'} Tertiary winding and core
                          <MultiSelectDropdown
                            options={["PCPB", "EHV Grade Oil", "Perma Wood"]}
                            selected={formData.insulatingMaterialBetweenTertiaryCore || []}
                            onChange={value => setFormData(prev => ({ ...prev, insulatingMaterialBetweenTertiaryCore: value }))}
                            placeholder={<span style={{color: 'rgba(128,128,128,0.5)'}}>Select material</span>}
                          />
                          {errors.insulatingMaterialBetweenTertiaryCore && <div className="error-message">{errors.insulatingMaterialBetweenTertiaryCore}</div>}<br />
                        </>
                      )}
                    </td>
                  </tr>,
                  <tr key="row-41">
                    <td className="border border-gray-300 p-4 font-bold">{nextBushingIndex++}</td>
                    <td className="border border-gray-300 p-4 font-bold">Type of axial coil supports:<span className="text-red-500">*</span></td>
                    <td className="border border-gray-300 p-4" >
                      a. HV winding
                      <MultiSelectDropdown
                        options={["PCPB", "EHV Grade Oil", "Perma Wood"]}
                        selected={formData.axialCoilSupportHV}
                        onChange={value => setFormData(prev => ({ ...prev, axialCoilSupportHV: value }))}
                        placeholder={<span style={{color: 'rgba(128,128,128,0.5)'}}>Select support</span>}
                      />
                      {errors.axialCoilSupportHV && <div className="error-message">{errors.axialCoilSupportHV}</div>}<br />
                      {extraVoltageFields.lv1lv2 ? (
                        <>
                          b. LV1 winding
                          <MultiSelectDropdown
                            options={["PCPB", "EHV Grade Oil", "Perma Wood"]}
                            selected={formData.axialCoilSupportLV1 || []}
                            onChange={value => setFormData(prev => ({ ...prev, axialCoilSupportLV1: value }))}
                            placeholder={<span style={{color: 'rgba(128,128,128,0.5)'}}>Select support</span>}
                          />
                          {errors.axialCoilSupportLV1 && <div className="error-message">{errors.axialCoilSupportLV1}</div>}<br />
                          c. LV2 winding
                          <MultiSelectDropdown
                            options={["PCPB", "EHV Grade Oil", "Perma Wood"]}
                            selected={formData.axialCoilSupportLV2 || []}
                            onChange={value => setFormData(prev => ({ ...prev, axialCoilSupportLV2: value }))}
                            placeholder={<span style={{color: 'rgba(128,128,128,0.5)'}}>Select support</span>}
                          />
                          {errors.axialCoilSupportLV2 && <div className="error-message">{errors.axialCoilSupportLV2}</div>}<br />
                        </>
                      ) : (
                        <>
                          b. LV winding
                          <MultiSelectDropdown
                            options={["PCPB", "EHV Grade Oil", "Perma Wood"]}
                            selected={formData.axialCoilSupportLV}
                            onChange={value => setFormData(prev => ({ ...prev, axialCoilSupportLV: value }))}
                            placeholder={<span style={{color: 'rgba(128,128,128,0.5)'}}>Select support</span>}
                          />
                          {errors.axialCoilSupportLV && <div className="error-message">{errors.axialCoilSupportLV}</div>}<br />
                        </>
                      )}
                      {extraVoltageFields.mv && (
                        <>
                          {extraVoltageFields.lv1lv2 ? 'd.' : 'c.'} MV winding
                    <MultiSelectDropdown
                            options={["PCPB", "EHV Grade Oil", "Perma Wood"]}
                            selected={formData.axialCoilSupportMV || []}
                            onChange={value => setFormData(prev => ({ ...prev, axialCoilSupportMV: value }))}
                            placeholder={<span style={{color: 'rgba(128,128,128,0.5)'}}>Select support</span>}
                          />
                          {errors.axialCoilSupportMV && <div className="error-message">{errors.axialCoilSupportMV}</div>}<br />
                        </>
                      )}
                      {extraVoltageFields.tertiary && (
                        <>
                          {extraVoltageFields.lv1lv2 ? (extraVoltageFields.mv ? 'e.' : 'd.') : (extraVoltageFields.mv ? 'd.' : 'c.')} Tertiary winding
                          <MultiSelectDropdown
                            options={["PCPB", "EHV Grade Oil", "Perma Wood"]}
                            selected={formData.axialCoilSupportTertiary || []}
                            onChange={value => setFormData(prev => ({ ...prev, axialCoilSupportTertiary: value }))}
                            placeholder={<span style={{color: 'rgba(128,128,128,0.5)'}}>Select support</span>}
                          />
                          {errors.axialCoilSupportTertiary && <div className="error-message">{errors.axialCoilSupportTertiary}</div>}<br />
                        </>
                      )}
                    </td>
                  </tr>,
                  <tr key="row-43">
                    <td className="border border-gray-300 p-4 font-bold">{nextBushingIndex++}</td>
                    <td className="border border-gray-300 p-4 font-bold">Type of radial coil supports:<span className="text-red-500">*</span></td>
                    <td className="border border-gray-300 p-4">
                      a. HV winding
                      <MultiSelectDropdown
                        options={["PCPB", "EHV Grade Oil", "Perma Wood"]}
                        selected={formData.radialCoilSupportHV}
                        onChange={value => setFormData(prev => ({ ...prev, radialCoilSupportHV: value }))}
                        placeholder={<span style={{color: 'rgba(128,128,128,0.5)'}}>Select support</span>}
                      />
                      {errors.radialCoilSupportHV && <div className="error-message">{errors.radialCoilSupportHV}</div>}<br />
                      {extraVoltageFields.lv1lv2 ? (
                        <>
                          b. LV1 winding
                          <MultiSelectDropdown
                            options={["PCPB", "EHV Grade Oil", "Perma Wood"]}
                            selected={formData.radialCoilSupportLV1 || []}
                            onChange={value => setFormData(prev => ({ ...prev, radialCoilSupportLV1: value }))}
                            placeholder={<span style={{color: 'rgba(128,128,128,0.5)'}}>Select support</span>}
                          />
                          {errors.radialCoilSupportLV1 && <div className="error-message">{errors.radialCoilSupportLV1}</div>}<br />
                          c. LV2 winding
                          <MultiSelectDropdown
                            options={["PCPB", "EHV Grade Oil", "Perma Wood"]}
                            selected={formData.radialCoilSupportLV2 || []}
                            onChange={value => setFormData(prev => ({ ...prev, radialCoilSupportLV2: value }))}
                            placeholder={<span style={{color: 'rgba(128,128,128,0.5)'}}>Select support</span>}
                          />
                          {errors.radialCoilSupportLV2 && <div className="error-message">{errors.radialCoilSupportLV2}</div>}<br />
                        </>
                      ) : (
                        <>
                          b. LV winding
                          <MultiSelectDropdown
                            options={["PCPB", "EHV Grade Oil", "Perma Wood"]}
                            selected={formData.radialCoilSupportLV}
                            onChange={value => setFormData(prev => ({ ...prev, radialCoilSupportLV: value }))}
                            placeholder={<span style={{color: 'rgba(128,128,128,0.5)'}}>Select support</span>}
                          />
                          {errors.radialCoilSupportLV && <div className="error-message">{errors.radialCoilSupportLV}</div>}<br />
                        </>
                      )}
                      {extraVoltageFields.mv && (
                        <>
                          {extraVoltageFields.lv1lv2 ? 'd.' : 'c.'} MV winding
                  <MultiSelectDropdown
                            options={["PCPB", "EHV Grade Oil", "Perma Wood"]}
                            selected={formData.radialCoilSupportMV || []}
                            onChange={value => setFormData(prev => ({ ...prev, radialCoilSupportMV: value }))}
                            placeholder={<span style={{color: 'rgba(128,128,128,0.5)'}}>Select support</span>}
                          />
                          {errors.radialCoilSupportMV && <div className="error-message">{errors.radialCoilSupportMV}</div>}<br />
                        </>
                      )}
                      {extraVoltageFields.tertiary && (
                        <>
                          {extraVoltageFields.lv1lv2 ? (extraVoltageFields.mv ? 'e.' : 'd.') : (extraVoltageFields.mv ? 'd.' : 'c.')} Tertiary winding
                          <MultiSelectDropdown
                            options={["PCPB", "EHV Grade Oil", "Perma Wood"]}
                            selected={formData.radialCoilSupportTertiary || []}
                            onChange={value => setFormData(prev => ({ ...prev, radialCoilSupportTertiary: value }))}
                            placeholder={<span style={{color: 'rgba(128,128,128,0.5)'}}>Select support</span>}
                          />
                          {errors.radialCoilSupportTertiary && <div className="error-message">{errors.radialCoilSupportTertiary}</div>}<br />
                        </>
                      )}
                    </td>
                  </tr>,
                  <tr key="row-44">
                    <td className="border border-gray-300 p-4 font-bold">{nextBushingIndex++}</td>
                    <td className="border border-gray-300 p-4 font-bold">No. of bi-directional wheels provided<span className="text-red-500">*</span></td>
                    <td className="border border-gray-300 p-4">
                      <input
                        type="text"
                        name="numBiDirectionalWheels"
                        value={formData.numBiDirectionalWheels}
                        onChange={handleInputChange}
                        className="w-40 p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500 mx-2"
                        placeholder="Enter number"
                      />
                      {errors.numBiDirectionalWheels && <div className="error-message">{errors.numBiDirectionalWheels}</div>}
                    </td>
                  </tr>,
                  <tr key="row-45">
                    <td className="border border-gray-300 p-4 font-bold"  rowSpan="3" >{nextBushingIndex++}</td>
                    <td className="border border-gray-300 p-4 font-bold">Track gauge required for the wheels</td>
                    <td className="border border-gray-300 p-4" ></td>
                  </tr>,
                  <tr key="row-46">
                    <td className="border border-gray-300 p-4 font-bold">a. Trans axis</td>
                    <td className="border border-gray-300 p-4" >
                      <input
                        type="text"
                        name="trackGaugeTransAxis"
                        value={formData.trackGaugeTransAxis}
                        onChange={handleInputChange}
                        className="w-40 p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500 mx-2"
                        placeholder="Enter value"
                      />
                    </td>
                  </tr>,
                  <tr key="row-47">
                    <td className="border border-gray-300 p-4 font-bold">b. Long axis</td>
                    <td className="border border-gray-300 p-4">
                      <input
                        type="text"
                        name="trackGaugeLongAxis"
                        value={formData.trackGaugeLongAxis}
                        onChange={handleInputChange}
                        className="w-40 p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500 mx-2"
                        placeholder="Enter value"
                      />
                    </td>
                  </tr>,
                  <tr key="row-48">
                    <td className="border border-gray-300 p-4 font-bold">{nextBushingIndex++}</td>
                    <td className="border border-gray-300 p-4 font-bold">MOG make and type<span className="text-red-500">*</span></td>
                    <td className="border border-gray-300 p-4" >
                      <div className="flex gap-4">
                        <div className="flex-1">
                          <span className="block text-xs text-gray-700 mb-1">Make</span>
                          <MultiSelectComboBox
                             options={mogMakeOptions}
                             value={formData.mogMake}
                             onChange={val => handleInputChange({ target: { name: 'mogMake', value: val } })}
                             placeholder="Select or enter make(s)"
                             />
                            {errors.mogMake && <div className="error-message">{errors.mogMake}</div>}
                        </div>
                        <div className="flex-1">
                          <span className="block text-xs text-gray-700 mb-1">Type</span>
                          <input
                            type="text"
                            name="mogType"
                            value={formData.mogType || ''}
                            onChange={handleInputChange}
                            className="w-full p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                            placeholder="Enter MOG type"
                          />
                          {errors.mogType && <div className="error-message">{errors.mogType}</div>}
                </div>
                      </div>
                    </td>
                  </tr>,
                  <tr key="row-49">
                    <td className="border border-gray-300 p-4 font-bold">{nextBushingIndex++}</td>
                    <td className="border border-gray-300 p-4 font-bold">Gas and oil operated relay make and type<span className="text-red-500">*</span></td>
                    <td className="border border-gray-300 p-4">
                      <div className="flex gap-4">
                        <div className="flex-1">
                          <span className="block text-xs text-gray-700 mb-1">Make</span>
                          <MultiSelectComboBox
                            options={gasOilRelayMakeOptions}
                            value={formData.relayMake}
                            onChange={val => setFormData(prev => ({ ...prev, relayMake: val }))}
                            placeholder="Select or enter make(s)"
                          />
                          {errors.relayMake && <div className="error-message">{errors.relayMake}</div>}
                </div>
                        <div className="flex-1">
                          <span className="block text-xs text-gray-700 mb-1">Type</span>
                          <input
                            type="text"
                            name="relayType"
                            value={formData.relayType || ''}
                            onChange={e => setFormData(prev => ({ ...prev, relayType: e.target.value }))}
                            className="w-full p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                            placeholder="Enter relay type"
                          />
                          {errors.relayType && <div className="error-message">{errors.relayType}</div>}
                  </div>
                      </div>
                    </td>
                  </tr>,
                  <tr key="row-50">
                    <td className="border border-gray-300 p-4 font-bold">{nextBushingIndex++}</td>
                    <td className="border border-gray-300 p-4 font-bold">Temperature Indicators:<span className="text-red-500">*</span><br/> Make and Type</td>
                    <td className="border border-gray-300 p-4">
                      <div className="flex gap-4">
                        <div className="flex-1">
                          <span className="block text-xs text-gray-700 mb-1">Make</span>
                          <MultiSelectComboBox
                            options={tempIndicatorMakeOptions}
                            value={formData.tempControllerMake}
                            onChange={val => setFormData(prev => ({ ...prev, tempControllerMake: val }))}
                            placeholder="Select or enter make(s)"
                          />
                          {errors.tempControllerMake && <div className="error-message">{errors.tempControllerMake}</div>}
                </div>
                        <div className="flex-1">
                          <span className="block text-xs text-gray-700 mb-1">Type</span>
                          <input
                            type="text"
                            name="tempControllerType"
                            value={formData.tempControllerType || ''}
                            onChange={e => setFormData(prev => ({ ...prev, tempControllerType: e.target.value }))}
                            className="w-full p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                            placeholder="Enter type"
                          />
                          {errors.tempControllerType && <div className="error-message">{errors.tempControllerType}</div>}
                  </div>
                      </div>
                    </td>
                  </tr>,
                  // PRD field after Temperature Indicator
                  <tr key="row-prd">
                    <td className="border border-gray-300 p-4 font-bold">{nextBushingIndex++}</td>
                    <td className="border border-gray-300 p-4 font-bold">Pressure Relief Device (PRD)<span className="text-red-500">*</span></td>
                    <td className="border border-gray-300 p-4">
                      <MultiSelectComboBox
                        options={['Sukrut','VIAT', 'Yogya', 'Precimeasure', 'Press-N-Forge','Reputed']}
                        value={formData.prdMake || []}
                        onChange={val => setFormData(prev => ({ ...prev, prdMake: val }))}
                        placeholder="Select or enter PRD make(s)"
                      />
                      {errors.prdMake && <div className="error-message">{errors.prdMake}</div>}
                    </td>
                  </tr>,
                  <tr key="row-55">
                    <td className="border border-gray-300 p-4 font-bold">{nextBushingIndex++}</td>
                    <td className="border border-gray-300 p-4 font-bold">Transformers will be transported with oil / gas</td>
                    <td className="border border-gray-300 p-4">
                      <input
                        type="text"
                        name="transportWith"
                        value={formData.transportWith}
                        onChange={handleInputChange}
                        className="w-40 p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500 mx-2"
                      />
                      {errors.transportWith && <div className="error-message">{errors.transportWith}</div>}
                    </td>
                  </tr>,
                  <tr key="row-56">
                    <td className="border border-gray-300 p-4 font-bold">{nextBushingIndex++}</td>
                    <td className="border border-gray-300 p-4 font-bold">Limit of hot spot temperature for which the transformers are designed</td>
                    <td className="border border-gray-300 p-4">
                      <input
                        type="text"
                        name="hotSpotTempLimit"
                        value={formData.hotSpotTempLimit}
                        onChange={handleInputChange}
                        className="w-32 p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                        placeholder="<105"
                      />
                      {errors.hotSpotTempLimit && <div className="error-message">{errors.hotSpotTempLimit}</div>}
                    </td>
                  </tr>,
                  <tr key="row-57">
                    <td className="border border-gray-300 p-4 font-bold">{nextBushingIndex++}</td>
                    <td className="border border-gray-300 p-4 font-bold">Maximum hot spot temperature under normal conditions of loading (at MCR)</td>
                    <td className="border border-gray-300 p-4">
                      <input
                        type="text"
                        name="hotSpotTempMax"
                        value={formData.hotSpotTempMax}
                        onChange={handleInputChange}
                        className="w-32 p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                        placeholder="<140"
                      />
                    </td>
                  </tr>,
                  <tr key="row-58">
                    <td className="border border-gray-300 p-4 font-bold" rowSpan="3">{nextBushingIndex++}</td>
                    <td className="border border-gray-300 p-4"></td>
                    <td className="border border-gray-300 p-4">
                      <input
                        type="number"
                        name="overVoltage1Percent"
                        value={formData.overVoltage1Percent}
                        onChange={handleInputChange}
                        className="w-20 p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500 mr-2"
                        placeholder="140"
                      />% rated voltage for
                      <input
                        type="text"
                        name="overVoltage1Duration"
                        value={formData.overVoltage1Duration}
                        onChange={handleInputChange}
                        className="w-24 p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500 mx-2"
                        placeholder="5 seconds"
                      />
                    </td>
                  </tr>,
                  <tr key="row-59">
                    <td className="border border-gray-300 p-4 font-bold">Over fluxing operating capability</td>
                    <td className="border border-gray-300 p-4">
                      <input
                        type="number"
                        name="overVoltage2Percent"
                        value={formData.overVoltage2Percent}
                        onChange={handleInputChange}
                        className="w-20 p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500 mr-2"
                        placeholder="125"
                      />% rated voltage for
                      <input
                        type="text"
                        name="overVoltage2Duration"
                        value={formData.overVoltage2Duration}
                        onChange={handleInputChange}
                        className="w-24 p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500 mx-2"
                        placeholder="60 seconds"
                      />
                    </td>
                  </tr>,
                  <tr key="row-60">
                    <td className="border border-gray-300 p-4"></td>
                    <td className="border border-gray-300 p-4">
                      <input
                        type="number"
                        name="overVoltage3Percent"
                        value={formData.overVoltage3Percent}
                        onChange={handleInputChange}
                        className="w-20 p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500 mr-2"
                        placeholder="110"
                      />% rated voltage
                      <input
                        type="text"
                        name="overVoltage3Duration"
                        value={formData.overVoltage3Duration}
                        onChange={handleInputChange}
                        className="w-24 p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500 mx-2"
                        placeholder="Continuous"
                      />
                    </td>
                  </tr>,
                  <tr key="row-61">
                    <td className="border border-gray-300 p-4 font-bold" rowSpan="2">{nextBushingIndex++}</td>
                    <td className="border border-gray-300 p-4 font-bold">Regulation of full load and 75 Deg.C winding temp expressed as a percentage of normal voltage</td>
                    <td className="border border-gray-300 p-4"></td>
                  </tr>,
                  <tr key="row-62">
                    <td className="border border-gray-300 p-4 font-bold">At unity power factor</td>
                    <td className="border border-gray-300 p-4">
                      <input
                        type="text"
                        name="regulationUPF"
                        value={(() => {
                          // Use the highest kVA for regulation calculation
                          const k = formData.kvaList.length > 0 ? Math.max(...formData.kvaList) : parseFloat(formData.kva);
                          const ll100 = parseFloat(formData.loadLosses100);
                          const z = parseFloat(formData.impedanceVoltage);
                          if (isNaN(k) || k <= 0 || isNaN(ll100) || isNaN(z) || z <= 0) return '';
                          // Calculate equivalent resistance in percentage
                          const resistancePercent = (ll100 * 100) / k;
                          // Calculate equivalent reactance in percentage
                          const reactancePercent = Math.sqrt(Math.max(0, z * z - resistancePercent * resistancePercent));
                          // Power factor = 1.0
                          const cosPhi = 1.0;
                          const sinPhi = 0.0;
                          // Linear term
                          const linearTerm = resistancePercent * cosPhi + reactancePercent * sinPhi;
                          // Quadratic term for higher accuracy
                          const quadraticTerm = ((reactancePercent * cosPhi - resistancePercent * sinPhi) ** 2) / 200;
                          // Total regulation
                          const regulation = linearTerm + quadraticTerm;
                          return isNaN(regulation) ? '' : regulation.toFixed(4);
                        })()}
                        readOnly
                        className="w-20 p-1 border rounded bg-gray-100 text-gray-800 focus:outline-none"
                        placeholder="%"
                      />
                    </td>
                  </tr>,
                  <tr key="row-63">
                    <td className="border border-gray-300 p-4"></td>
                    <td className="border border-gray-300 p-4 font-bold">At 0.8 pf (lagging)</td>
                    <td className="border border-gray-300 p-4">
                      <input
                        type="text"
                        name="regulationPF08"
                        value={(() => {
                          // Use the highest kVA for regulation calculation
                          const k = formData.kvaList.length > 0 ? Math.max(...formData.kvaList) : parseFloat(formData.kva);
                          const ll100 = parseFloat(formData.loadLosses100);
                          const z = parseFloat(formData.impedanceVoltage);
                          if (isNaN(k) || k <= 0 || isNaN(ll100) || isNaN(z) || z <= 0) return '';
                          // Calculate equivalent resistance in percentage
                          const resistancePercent = (ll100 * 100) / k;
                          // Calculate equivalent reactance in percentage
                          const reactancePercent = Math.sqrt(Math.max(0, z * z - resistancePercent * resistancePercent));
                          // Power factor = 0.8
                          const cosPhi = 0.8;
                          const sinPhi = Math.sqrt(1 - cosPhi * cosPhi);
                          // Linear term
                          const linearTerm = resistancePercent * cosPhi + reactancePercent * sinPhi;
                          // Quadratic term for higher accuracy
                          const quadraticTerm = ((reactancePercent * cosPhi - resistancePercent * sinPhi) ** 2) / 200;
                          // Total regulation
                          const regulation = linearTerm + quadraticTerm;
                          return isNaN(regulation) ? '' : regulation.toFixed(4);
                        })()}
                        readOnly
                        className="w-20 p-1 border rounded bg-gray-100 text-gray-800 focus:outline-none"
                        placeholder="%"
                      />
                    </td>
                  </tr>,
                  <tr key="row-64">
                    <td className="border border-gray-300 p-4 font-bold">{nextBushingIndex++}</td>
                    <td className="border border-gray-300 p-4 font-bold">Permissible overloading capacity of transformer</td>
                    <td className="border border-gray-300 p-4">
                      <div className="space-y-2">
              <div>
                          <span className="font-semibold">HV:</span><br />
                          <input
                            type="text"
                            name="hvOverloadingCapacity"
                            value={formData.hvOverloadingCapacity || ''}
                            onChange={handleInputChange}
                            className="w-full p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                            placeholder="Enter HV overloading capacity"
                          />
                          {errors.hvOverloadingCapacity && <div className="error-message">{errors.hvOverloadingCapacity}</div>}
              </div>
                <div>
                          <span className="font-semibold">LV:</span><br />
                          <input
                            type="text"
                            name="lvOverloadingCapacity"
                            value={formData.lvOverloadingCapacity || ''}
                            onChange={handleInputChange}
                            className="w-full p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                            placeholder="Enter LV overloading capacity"
                          />
                          {errors.lvOverloadingCapacity && <div className="error-message">{errors.lvOverloadingCapacity}</div>}
                </div>
                      </div>
                    </td>
                  </tr>,
                  <tr key="row-65">
                    <td className="border border-gray-300 p-4 font-bold">{nextBushingIndex++}</td>
                    <td className="border border-gray-300 p-4 font-bold">Insulating and cooling medium</td>
                    <td className="border border-gray-300 p-4">
                      <input
                        type="text"
                        name="insulatingMedium"
                        value={formData.insulatingMedium}
                        onChange={handleInputChange}
                        className="w-full p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                      />
                      {errors.insulatingMedium && <div className="error-message">{errors.insulatingMedium}</div>}
                    </td>
                  </tr>,

                  <tr key="row-70">
                    <td className="border border-gray-300 p-4 font-bold">{nextBushingIndex++}</td>
                    <td className="border border-gray-300 p-4 font-bold">Electrostatic shields are provided to obtain uniform</td>
                    <td className="border border-gray-300 p-4">
                      <input
                        type="text"
                        name="electrostaticShields"
                        value={formData.electrostaticShields}
                        onChange={handleInputChange}
                        className="w-32 p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                        placeholder="Yes"
                      />
                      {errors.electrostaticShields && <div className="error-message">{errors.electrostaticShields}</div>}
                    </td>
                   </tr>,
                    
                  ]}
                </tbody>
            </table>
            {Object.keys(errors).length > 0 && (
                <div className="bg-red-100 text-red-700 border border-red-400 rounded px-4 py-2 mb-4 text-center max-w-xl mx-auto">
                      Please fill all required fields marked with <span className="text-red-500">*</span>.
                  </div>
                 )}
            <div className="mt-4">
              <label className="inline-flex items-center">
                <input
                  type="checkbox"
                  className="form-checkbox h-5 w-5 text-blue-600"
                  checked={showDimensionsWeight}
                  onChange={e => setShowDimensionsWeight(e.target.checked)}
                />
                <span className="ml-2 text-gray-700">Enter Additional Details (Dimensions & Weight)</span>
              </label>
            </div>
            {showDimensionsWeight && (
              <table className="w-full border-collapse border border-gray-300 text-sm mt-4">
                <thead>
                  <tr className="bg-blue-100">
                    <th className="border border-gray-300 p-4">Sr. No.</th>
                    <th className="border border-gray-300 p-4">Description</th>
                    <th className="border border-gray-300 p-4">Particulars</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td className="border border-gray-300 p-4 font-bold">{nextBushingIndex++}</td>
                    <td className="border border-gray-300 p-4 font-bold">Dimensions <span className="text-red-500">*</span></td>
                    <td className="border border-gray-300 p-4">
                      a) Length (enter in mm): <input type="text" name="length" value={formData.length} onChange={handleInputChange} className="w-full p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500 mb-1" />
                      {errors.length && <div className="error-message">{errors.length}</div>}
                      <br />
                      b) Width (enter in mm): <input type="text" name="width" value={formData.width} onChange={handleInputChange} className="w-full p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500 mb-1" />
                      {errors.width && <div className="error-message">{errors.width}</div>}
                      <br />
                      c) Height (enter in mm): <input type="text" name="height" value={formData.height} onChange={handleInputChange} className="w-full p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500" />
                      {errors.height && <div className="error-message">{errors.height}</div>}
                      <br />
                      d) Untanking height (enter in mm): <input type="text" name="untankingHeight" value={formData.untankingHeight} onChange={handleInputChange} className="w-full p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500" />
                      {errors.untankingHeight && <div className="error-message">{errors.untankingHeight}</div>}
                    </td>
                  </tr>
                  <tr>
                    <td className="border border-gray-300 p-4 font-bold">{nextBushingIndex++}</td>
                    <td className="border border-gray-300 p-4 font-bold">Weight Details <span className="text-red-500">*</span></td>
                    <td className="border border-gray-300 p-4">
                      a) Core & Windings (enter in kg): <input type="text" name="coreWindingsWeight" value={formData.coreWindingsWeight} onChange={handleInputChange} className="w-full p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500 mb-1" />
                      {errors.coreWindingsWeight && <div className="error-message">{errors.coreWindingsWeight}</div>}
                      <br />
                      b) Tank & Fittings (enter in kg): <input type="text" name="tankFittingsWeight" value={formData.tankFittingsWeight} onChange={handleInputChange} className="w-full p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500 mb-1" />
                      {errors.tankFittingsWeight && <div className="error-message">{errors.tankFittingsWeight}</div>}
                      <br />
                      c) Oil Mass (enter in kg): <input type="text" name="oilMass" value={formData.oilMass} onChange={handleInputChange} className="w-full p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500 mb-1" />
                      {errors.oilMass && <div className="error-message">{errors.oilMass}</div>}
                      <br />
                       d) Oil Mass (Enter in litre): <input type="text" name="oilMassLitre" value={formData.oilMassLitre} onChange={handleInputChange} className="w-full p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500 mb-1" />
                       {errors.oilMassLitre && <div className="error-message">{errors.oilMassLitre}</div>}
                       <br />
                      d) Total Weight (in kg): <input type="text" name="totalWeight" value={formData.totalWeight} readOnly className="w-full p-1 border rounded bg-gray-100 text-gray-800 focus:outline-none" />
                    </td>
                  </tr>
                </tbody>
              </table>
            )}
            <div className="mt-4">
              <label className="inline-flex items-center">
                <input
                  type="checkbox"
                  className="form-checkbox h-5 w-5 text-blue-600"
                  checked={editFittings}
                  onChange={e => {
                    const checked = e.target.checked;
                    setEditFittings(checked);
                    if (checked) {
                      setSelectedFittings(allStandardFittings); // all selected by default
                    } else {
                      setSelectedFittings(allStandardFittings); // keep all selected when not editing
                    }
                  }}
                />
                <span className="ml-2 text-gray-700">Edit list of Fittings/Accessories</span>
              </label>
                  </div>
{editFittings && (
  <div className="mt-4 p-4 border rounded-lg max-h-96 overflow-y-auto bg-gray-50">
    <div className="font-semibold mb-2">Select Standard Fittings/Accessories:</div>
    <div className="grid grid-cols-1 sm:grid-cols-2 gap-2">
      {allStandardFittings.map((item, idx) => (
        <div key={idx} className="flex items-center gap-2">
          <input
            type="checkbox"
            checked={selectedFittings.includes(item)}
            onChange={() => {
              if (selectedFittings.includes(item)) {
                setSelectedFittings(selectedFittings.filter(f => f !== item));
              } else {
                setSelectedFittings([...selectedFittings, item]);
              }
            }}
            className="mr-2"
          />
          <span>{item}</span>
          {selectedFittings.includes(item) && (
            <input
              type="text"
              value={fittingQuantities[item] || ''}
              onChange={e => {
                const val = e.target.value;
                setFittingQuantities(q => ({ ...q, [item]: val }));
              }}
              className="w-24 ml-2 p-1 border rounded"
              placeholder="Qty or words"
            />
          )}
        </div>
      ))}
    </div>
  </div>
)}
            <div className="mt-4">
              <label className="inline-flex items-center">
                  <input
                  type="checkbox"
                  className="form-checkbox h-5 w-5 text-blue-600"
                  checked={showAdditionalFittings}
                  onChange={e => setShowAdditionalFittings(e.target.checked)}
                />
                <span className="ml-2 text-gray-700">Enter Additional Fittings/Accessories</span>
              </label>
                </div>
            {showAdditionalFittings && (
              <div className="mt-4 p-4 border rounded-lg">
                <div className="flex gap-2 mb-4">
                    <input
                      type="text"
                      value={newFitting}
                    onChange={e => setNewFitting(e.target.value)}
                    placeholder="Enter fitting/accessory"
                    className="flex-1 p-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                  />
                  <button
                    onClick={() => {
                      if (newFitting.trim()) {
                        setAdditionalFittings(prev => [...prev, { desc: newFitting.trim(), qty: newFittingQty }]);
                        setNewFitting('');
                        setNewFittingQty(1);
                      }
                    }}
                    className="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700"
                  >
                    Add
                  </button>
                </div>
                <div className="space-y-2">
                  {additionalFittings.map((fitting, index) => (
                    <div key={index} className="flex items-center justify-between p-2 bg-gray-50 rounded">
                      <span>{fitting.desc}</span>
                      <input
                        type="number"
                        min={1}
                        value={fitting.qty}
                        onChange={e => {
                          const val = Math.max(1, parseInt(e.target.value) || 1);
                          setAdditionalFittings(prev => prev.map((f, i) => i === index ? { ...f, qty: val } : f));
                        }}
                        className="w-16 ml-2 p-1 border rounded"
                      />
                      <button
                        onClick={() => setAdditionalFittings(prev => prev.filter((_, i) => i !== index))}
                        className="text-red-600 hover:text-red-800 ml-2"
                      >
                        Remove
                      </button>
                    </div>
                  ))}
                </div>
                </div>
              )}
               </div>
            <div className="mt-4 flex justify-center">
              <button
                onClick={calculateParameters}
                className="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500"
              >
                Calculate Parameters
              </button>
          </div>

          {report && (
            <div id="report-section" className="bg-white p-6 rounded-lg shadow-md">
              <div className="relative mb-6">
                <div className="flex justify-center">
                <img
                  src="https://images.squarespace-cdn.com/content/v1/67c6cd6aa7237560f57b1238/5dc6f094-8e85-4639-9c96-e5aa5e773ec0/BCS-Mahati-with-C_TM-revised-02.png?format=1500w"
                  alt="Company Logo"
                  className="h-16 max-w-full object-contain"
                   /> 
                </div>
                           {registerOutput && (
                          <div className="absolute top-0 right-0 text-2xl font-bold text-blue-700">REV-{registerOutput}</div>
                          )}
                </div>
              <h2 className="text-xl font-bold mb-4 text-center">ANNEXURE  {report.annexureNumber}</h2>
              <h3 className="text-lg font-semibold mb-4 text-center">TECHNICAL PARTICULARS FOR {
                report.kvaList && report.kvaList.length > 0
                  ? report.kvaList.join('/') + ' kVA'
                  : (report.kva + ' kVA')
              }, {report.hvVoltage}/{report.lvVoltage} kV EHV POWER TRANSFORMER WITH {getTapChangerText(report.tapChangerType).toUpperCase()}</h3>
              <table className="w-full border-collapse border border-gray-300 text-sm mb-6">
                <thead>
                  <tr className="bg-blue-100">
                    <th className="border border-gray-300 px-4 py-2">Sr. No.</th>
                    <th className="border border-gray-300 px-4 py-2">Description</th>
                    <th className="border border-gray-300 px-4 py-2">Unit</th>
                    <th className="border border-gray-300 px-4 py-2">Particulars</th>
                  </tr>
                </thead>
                <tbody className="space-y-2">
                  <tr>
                    <td className="border border-gray-300 px-4 py-2 font-bold">{outputIndex++}</td>
                    <td className="border border-gray-300 px-4 py-2 font-bold">Name of manufacturer </td>
                    <td className="border border-gray-300 px-4 py-2"></td>
                    <td className="border border-gray-300 px-4 py-2">{report.manufacturer}</td>
                  </tr>
                  <tr>
                    <td className="border border-gray-300 px-4 py-2 font-bold">{outputIndex++}</td>
                    <td className="border border-gray-300 px-4 py-2 font-bold">Customer</td>
                    <td className="border border-gray-300 px-4 py-2"></td>
                    <td className="border border-gray-300 px-4 py-2">{report.customer || '-'}</td>
                  </tr>
                  <tr>
                    <td className="border border-gray-300 px-4 py-2 font-bold">{outputIndex++}</td>
                    <td className="border border-gray-300 px-4 py-2 font-bold">Reference Standard </td>
                    <td className="border border-gray-300 px-4 py-2"></td>
                    <td className="border border-gray-300 px-4 py-2">{report.referenceStandards}</td>
                  </tr>
                  <tr>
                    <td className="border border-gray-300 px-4 py-2 font-bold">{outputIndex++}</td>
                    <td className="border border-gray-300 px-4 py-2 font-bold">Winding Material </td>
                    <td className="border border-gray-300 px-4 py-2"></td>
                    <td className="border border-gray-300 px-4 py-2">{report.windingMaterial}</td>
                  </tr>
                  <tr>
                    <td className="border border-gray-300 px-4 py-2 font-bold">{outputIndex++}</td>
                    <td className="border border-gray-300 px-4 py-2 font-bold">Service </td>
                    <td className="border border-gray-300 px-4 py-2"></td>
                    <td className="border border-gray-300 px-4 py-2">{report.service}</td>
                  </tr>
                  <tr>
                    <td className="border border-gray-300 px-4 py-2 font-bold">{outputIndex++}</td>
                    <td className="border border-gray-300 px-4 py-2 font-bold">kVA Rating</td>
                    <td className="border border-gray-300 px-4 py-2">kVA</td>
                    <td className="border border-gray-300 px-4 py-2">{report.kvaList && report.kvaList.length > 0 ? report.kvaList.join('/') : report.kva}</td>
                  </tr>
                  <tr>
                    <td className="border border-gray-300 px-4 py-2 font-bold">{outputIndex++}</td>
                    <td className="border border-gray-300 px-4 py-2 font-bold">Number of Transformer Required</td>
                    <td className="border border-gray-300 px-4 py-2"></td>
                    <td className="border border-gray-300 px-4 py-2">{report.numTransformers}</td>
                  </tr>
                  <tr>
                    <td className="border border-gray-300 px-4 py-2 font-bold">{outputIndex++}</td>
                    <td className="border border-gray-300 px-4 py-2 font-bold">Rated Voltage<br />a) HV Winding
                    {(!report.extraVoltageFields || !report.extraVoltageFields.lv1lv2) && (<><br />b) LV Winding</>)}
                    {report.extraVoltageFields && report.extraVoltageFields.lv1lv2 ? <><br />b) LV1<br />c) LV2</> : null}
                    {report.extraVoltageFields && report.extraVoltageFields.mv ? <><br />d) MV</> : null}
                    {report.extraVoltageFields && report.extraVoltageFields.tertiary ? <><br />e) Tertiary</> : null}
                    </td>
                    <td className="border border-gray-300 px-4 py-2"><br />kV
                      {(!report.extraVoltageFields || !report.extraVoltageFields.lv1lv2) && (<><br />kV</>)}
                      {report.extraVoltageFields && report.extraVoltageFields.lv1lv2 ? <><br />kV<br />kV</> : null}
                      {report.extraVoltageFields && report.extraVoltageFields.mv ? <><br />kV</> : null}
                      {report.extraVoltageFields && report.extraVoltageFields.tertiary ? <><br />kV</> : null}
                    </td>
                    <td className="border border-gray-300 px-4 py-2"><br />{report.hvVoltage}
                      {(!report.extraVoltageFields || !report.extraVoltageFields.lv1lv2) && (<><br />{report.lvVoltage}</>)}
                      {report.extraVoltageFields && report.extraVoltageFields.lv1lv2 ? <><br />{report.lv1Voltage}<br />{report.lv2Voltage}</> : null}
                      {report.extraVoltageFields && report.extraVoltageFields.mv ? <><br />{report.mvVoltage}</> : null}
                      {report.extraVoltageFields && report.extraVoltageFields.tertiary ? <><br />{report.tertiaryVoltage}</> : null}
                    </td>
                  </tr>
                  <tr>
                    <td className="border border-gray-300 px-4 py-2 font-bold">{outputIndex++}</td>
                    <td className="border border-gray-300 px-4 py-2 font-bold">Rated Current</td>
                    <td className="border border-gray-300 px-4 py-2">Amps.</td>
                    <td className="border border-gray-300 px-4 py-2">
                      {report.kvaList && report.kvaList.length > 0 ? (
                        <table className="w-full border border-gray-300 text-xs">
                          <thead>
                            <tr className="bg-gray-100">
                              <th className="border border-gray-300 p-1">KVA</th>
                              <th className="border border-gray-300 p-1">HV (A)</th>
                              {/* Only show LV if LV1/LV2 is NOT checked */}
                              {!report.extraVoltageFields || !report.extraVoltageFields.lv1lv2 ? (
                                <th className="border border-gray-300 p-1">LV (A)</th>
                              ) : null}
                              {/* Show LV1/LV2 if selected */}
                              {report.extraVoltageFields && report.extraVoltageFields.lv1lv2 ? (
                                <>
                                  <th className="border border-gray-300 p-1">LV1 (A)</th>
                                  <th className="border border-gray-300 p-1">LV2 (A)</th>
                                </>
                              ) : null}
                              {/* Show MV if selected */}
                              {report.extraVoltageFields && report.extraVoltageFields.mv ? (
                                <th className="border border-gray-300 p-1">MV (A)</th>
                              ) : null}
                              {/* Show Tertiary if selected */}
                              {report.extraVoltageFields && report.extraVoltageFields.tertiary ? (
                                <th className="border border-gray-300 p-1">Tertiary (A)</th>
                              ) : null}
                            </tr>
                          </thead>
                          <tbody>
                            {report.kvaList.map((kva, idx) => {
                              const phases = parseInt(report.phases);
                              const hvVoltage = parseFloat(report.hvVoltage) * 1000;
                              const lvVoltage = parseFloat(report.lvVoltage) * 1000;
                              const lv1Voltage = parseFloat(report.lv1Voltage) * 1000;
                              const lv2Voltage = parseFloat(report.lv2Voltage) * 1000;
                              const mvVoltage = parseFloat(report.mvVoltage) * 1000;
                              const tertiaryVoltage = parseFloat(report.tertiaryVoltage) * 1000;
                              let hvCurrent = '', lvCurrent = '', lv1Current = '', lv2Current = '', mvCurrent = '', tertiaryCurrent = '';
                              if (!isNaN(hvVoltage) && hvVoltage > 0 && !isNaN(phases) && phases > 0) {
                                hvCurrent = (phases === 3)
                                  ? ((kva * 1000) / (Math.sqrt(3) * hvVoltage)).toFixed(2)
                                  : ((kva * 1000) / hvVoltage).toFixed(2);
                              }
                              if (!isNaN(lvVoltage) && lvVoltage > 0 && !isNaN(phases) && phases > 0) {
                                lvCurrent = (phases === 3)
                                  ? ((kva * 1000) / (Math.sqrt(3) * lvVoltage)).toFixed(2)
                                  : ((kva * 1000) / lvVoltage).toFixed(2);
                              }
                              if (!isNaN(lv1Voltage) && lv1Voltage > 0 && !isNaN(phases) && phases > 0) {
                                const lvKva = (lv2Voltage && lv2Voltage > 0) ? (kva / 2) : kva;
                                lv1Current = (phases === 3)
                                  ? ((lvKva * 1000) / (Math.sqrt(3) * lv1Voltage)).toFixed(2)
                                  : ((lvKva * 1000) / lv1Voltage).toFixed(2);
                              }
                              if (!isNaN(lv2Voltage) && lv2Voltage > 0 && !isNaN(phases) && phases > 0) {
                                const lvKva = (lv1Voltage && lv1Voltage > 0) ? (kva / 2) : kva;
                                lv2Current = (phases === 3)
                                ? ((lvKva * 1000) / (Math.sqrt(3) * lv2Voltage)).toFixed(2)
                                : ((lvKva * 1000) / lv2Voltage).toFixed(2);
                              
                              }
                              if (!isNaN(mvVoltage) && mvVoltage > 0 && !isNaN(phases) && phases > 0) {
                                mvCurrent = (phases === 3)
                                  ? ((kva * 1000) / (Math.sqrt(3) * mvVoltage)).toFixed(2)
                                  : ((kva * 1000) / mvVoltage).toFixed(2);
                              }
                              if (!isNaN(tertiaryVoltage) && tertiaryVoltage > 0 && !isNaN(phases) && phases > 0) {
                                tertiaryCurrent = (phases === 3)
                                  ? ((kva * 1000) / (Math.sqrt(3) * tertiaryVoltage)).toFixed(2)
                                  : ((kva * 1000) / tertiaryVoltage).toFixed(2);
                              }
                              return (
                                <tr key={idx}>
                                  <td className="border border-gray-300 p-1">{kva}</td>
                                  <td className="border border-gray-300 p-1">{hvCurrent}</td>
                                  {/* Only show LV if LV1/LV2 is NOT checked */}
                                  {!report.extraVoltageFields || !report.extraVoltageFields.lv1lv2 ? (
                                    <td className="border border-gray-300 p-1">{lvCurrent}</td>
                                  ) : null}
                                  {/* Show LV1/LV2 if selected */}
                                  {report.extraVoltageFields && report.extraVoltageFields.lv1lv2 ? (
                                    <>
                                      <td className="border border-gray-300 p-1">{lv1Current}</td>
                                      <td className="border border-gray-300 p-1">{lv2Current}</td>
                                    </>
                                  ) : null}
                                  {/* Show MV if selected */}
                                  {report.extraVoltageFields && report.extraVoltageFields.mv ? (
                                    <td className="border border-gray-300 p-1">{mvCurrent}</td>
                                  ) : null}
                                  {/* Show Tertiary if selected */}
                                  {report.extraVoltageFields && report.extraVoltageFields.tertiary ? (
                                    <td className="border border-gray-300 p-1">{tertiaryCurrent}</td>
                                  ) : null}
                                </tr>
                              );
                            })}
                          </tbody>
                        </table>
                      ) : (
                        <>
                          {report.hvCurrent && <>HV: {report.hvCurrent} A<br /></>}
                          {/* Only show LV if LV1/LV2 is NOT checked */}
                          {!report.extraVoltageFields || !report.extraVoltageFields.lv1lv2 ? (
                            <>{report.lvCurrent && <>LV: {report.lvCurrent} A<br /></>}</>
                          ) : null}
                          {/* Show LV1/LV2 if selected */}
                          {report.extraVoltageFields && report.extraVoltageFields.lv1lv2 ? (
                            <>
                              {report.lv1Current && <>LV1: {report.lv1Current} A<br /></>}
                              {report.lv2Current && <>LV2: {report.lv2Current} A<br /></>}
                            </>
                          ) : null}
                          {/* Show MV if selected */}
                          {report.extraVoltageFields && report.extraVoltageFields.mv ? (
                            <>{report.mvCurrent && <>MV: {report.mvCurrent} A<br /></>}</>
                          ) : null}
                          {/* Show Tertiary if selected */}
                          {report.extraVoltageFields && report.extraVoltageFields.tertiary ? (
                            <>{report.tertiaryCurrent && <>Tertiary: {report.tertiaryCurrent} A<br /></>}</>
                          ) : null}
                        </>
                      )}
                    </td>
                  </tr>
                  <tr>
                    <td className="border border-gray-300 px-4 py-2 font-bold">{outputIndex++}</td>
                    <td className="border border-gray-300 px-4 py-2 font-bold">Rated Frequency</td>
                    <td className="border border-gray-300 px-4 py-2">Hz</td>
                    <td className="border border-gray-300 px-4 py-2">{report.frequency}</td>
                  </tr>
                  <tr>
                    <td className="border border-gray-300 px-4 py-2 font-bold">{outputIndex++}</td>
                    <td className="border border-gray-300 px-4 py-2 font-bold">Number of Phase</td>
                    <td className="border border-gray-300 px-4 py-2">Ph.</td>
                    <td className="border border-gray-300 px-4 py-2">{report.phases}</td>
                  </tr>
                  <tr>
                    <td className="border border-gray-300 px-4 py-2 font-bold">{outputIndex++}</td>
                    <td className="border border-gray-300 px-4 py-2 font-bold">Voltage Variation</td>
                    <td className="border border-gray-300 px-4 py-2"></td>
                    <td className="border border-gray-300 px-4 py-2">{report.voltageVariation}%</td>
                  </tr>
                  <tr>
                    <td className="border border-gray-300 px-4 py-2 font-bold">{outputIndex++}</td>
                    <td className="border border-gray-300 px-4 py-2 font-bold">Frequency Variation</td>
                    <td className="border border-gray-300 px-4 py-2"></td>
                    <td className="border border-gray-300 px-4 py-2">{report.frequencyVariation}%</td>
                  </tr>
                  <tr>
                    <td className="border border-gray-300 px-4 py-2 font-bold">{outputIndex++}</td>
                    <td className="border border-gray-300 px-4 py-2 font-bold"> Winding Connections<br />a) HV
                       {/* Only show LV if LV1/LV2 is NOT checked */}
                       {(!report.extraVoltageFields || !report.extraVoltageFields.lv1lv2) && (<><br />b) LV</>)}
                       {/* Show LV1/LV2 if selected */}
                       {report.extraVoltageFields && report.extraVoltageFields.lv1lv2 ? <><br />b) LV1<br />c) LV2</> : null}
                       {report.extraVoltageFields && report.extraVoltageFields.mv ? <><br />{report.extraVoltageFields.lv1lv2 ? 'd' : 'c'}) MV</> : null}
                       {report.extraVoltageFields && report.extraVoltageFields.tertiary ? <><br />{report.extraVoltageFields.lv1lv2 ? (report.extraVoltageFields.mv ? 'e' : 'd') : (report.extraVoltageFields.mv ? 'd' : 'c')}) Tertiary</> : null}
                    </td>
                    <td className="border border-gray-300 px-4 py-2"></td>
                    <td className="border border-gray-300 px-4 py-2">
                      <br />{report.hvConnection}
                      {/* Only show LV if LV1/LV2 is NOT checked */}
                      {(!report.extraVoltageFields || !report.extraVoltageFields.lv1lv2) && (<><br />{report.lvConnection}</>)}
                      {/* Show LV1/LV2 if selected */}
                      {report.extraVoltageFields && report.extraVoltageFields.lv1lv2 ? <><br />{report.lv1Connection || '-'}<br />{report.lv2Connection || '-'}</> : null}
                      {report.extraVoltageFields && report.extraVoltageFields.mv ? <><br />{report.mvConnection || '-'}</> : null}
                      {report.extraVoltageFields && report.extraVoltageFields.tertiary ? <><br />{report.tertiaryConnection || '-'}</> : null}
                    </td>
                  </tr>
                  <tr>
                    <td className="border border-gray-300 px-4 py-2 font-bold">{outputIndex++}</td>
                    <td className="border border-gray-300 px-4 py-2 font-bold">Vector Group</td>
                    <td className="border border-gray-300 px-4 py-2"></td>
                    <td className="border border-gray-300 px-4 py-2">{Array.isArray(report.vectorGroup) ? report.vectorGroup.join(', ') : report.vectorGroup}</td>
                  </tr>
                  <tr>
                    <td className="border border-gray-300 px-4 py-2 font-bold">{outputIndex++}</td>
                    <td className="border border-gray-300 px-4 py-2 font-bold">Type of Cooling</td>
                    <td className="border border-gray-300 px-4 py-2"></td>
                    <td className="border border-gray-300 px-4 py-2">
                      {report.kvaList && report.kvaList.length > 1
                        ? report.kvaList.map((kva, idx) => (
                            <div key={kva} className="mb-1">
                              <span className="font-semibold">{kva} kVA:</span> {Array.isArray(report.coolingType?.[idx]) && report.coolingType[idx].length > 0 ? report.coolingType[idx].join(', ') : '-'}
                            </div>
                          ))
                        : (Array.isArray(report.coolingType?.[0]) && report.coolingType[0].length > 0 ? report.coolingType[0].join(', ') : '-')}
                    </td>
                  </tr>
                  <tr>
                    <td className="border border-gray-300 px-4 py-2 font-bold">{outputIndex++}</td>
                    <td className="border border-gray-300 px-4 py-2 font-bold">Temperature rise above <span>{report.ambientTemp || '___'}</span> C ambient<br />a) Oil<br />b) Winding</td>
                    <td className="border border-gray-300 px-4 py-2"><br /> C<br /> C</td>
                    <td className="border border-gray-300 px-4 py-2"><br />{report.topOilTemp}<br />{report.windingTemp}</td>
                  </tr>
                  <tr>
                    <td className="border border-gray-300 px-4 py-2 font-bold" rowSpan="4">{outputIndex++}</td>
                    <td className="border border-gray-300 px-4 py-2 font-bold">Losses in kW (Subject to IS Tol)</td>
                    <td className="border border-gray-300 px-4 py-2"></td>
                    <td className="border border-gray-300 px-4 py-2"></td>
                  </tr>
                  <tr>
                    <td className="border border-gray-300 px-4 py-2 font-bold">No Load Loss(With Tolerance%, if any)</td>
                    <td className="border border-gray-300 px-4 py-2">kW</td>
                    <td className="border border-gray-300 px-4 py-2">{report.noLoadLosses} kW, {report.noLoadLossTolerance ? `(${report.noLoadLossTolerance.trim().endsWith('%') ? report.noLoadLossTolerance : report.noLoadLossTolerance + '%'})` : ''}</td>
                  </tr>
                  <tr>
                    <td className="border border-gray-300 px-4 py-2 font-bold">Load Loss at 100% rated voltage & frequency @ 75 C(With Tolerance%, if any)</td>
                    <td className="border border-gray-300 px-4 py-2">kW</td>
                    <td className="border border-gray-300 px-4 py-2">{report.loadLosses100} kW, {report.loadLossTolerance ? `(${report.loadLossTolerance.trim().endsWith('%') ? report.loadLossTolerance : report.loadLossTolerance + '%'})` : ''}</td>
                  </tr>
                  <tr>
                    <td className="border border-gray-300 px-4 py-2 font-bold">Auxiliary Loss</td>
                    <td className="border border-gray-300 px-4 py-2">kW</td>
                    <td className="border border-gray-300 px-4 py-2">{report.auxiliaryLoss}</td>
                  </tr>
                  <tr>
                    <td className="border border-gray-300 px-4 py-2 font-bold">{outputIndex++}</td>
                    <td className="border border-gray-300 px-4 py-2 font-bold">Total Losses</td>
                    <td className="border border-gray-300 px-4 py-2">kW</td>
                    <td className="border border-gray-300 px-4 py-2">{
                      ((parseFloat(report.noLoadLosses) || 0) +
                       (parseFloat(report.loadLosses100) || 0) +
                       (parseFloat(report.auxiliaryLoss) || 0)).toFixed(2)
                    } kW</td>
                  </tr>
                  <tr>
                    <td className="border border-gray-300 px-4 py-2 font-bold">{outputIndex++}</td>
                    <td className="border border-gray-300 px-4 py-2 font-bold">Impedance Voltage at 75 C at Normal tap<br/><span className='text-xs text-gray-500'>Tolerance, if any on the above values</span></td>
                    <td className="border border-gray-300 px-4 py-2">%</td>
                    <td className="border border-gray-300 px-4 py-2">{report.impedanceVoltage}, {report.impedanceTolerance ? `(${report.impedanceTolerance.trim().endsWith('%') ? report.impedanceTolerance : report.impedanceTolerance + '%'})` : ''}</td>
                  </tr>
                  <tr>
                    <td className="border border-gray-300 px-4 py-2 font-bold">{outputIndex++}</td>
                    <td className="border border-gray-300 px-4 py-2 font-bold">Impedance For</td>
                    <td className="border border-gray-300 px-4 py-2"></td>
                    <td className="border border-gray-300 px-4 py-2">{report.impedanceFor || '-'}</td>
                  </tr>
                  <tr>
                    <td className="border border-gray-300 px-4 py-2 font-bold">{outputIndex++}</td>
                    <td className="border border-gray-300 px-4 py-2 font-bold">Flux density at 90% rated voltage</td>
                    <td className="border border-gray-300 px-4 py-2">Tesla</td>
                    <td className="border border-gray-300 px-4 py-2">{report.fluxDensity90} T</td>
                  </tr>
                  <tr>
                    <td className="border border-gray-300 px-4 py-2 font-bold">{outputIndex++}</td>
                    <td className="border border-gray-300 px-4 py-2 font-bold">Flux density at 100% rated voltage</td>
                    <td className="border border-gray-300 px-4 py-2">Tesla</td>
                    <td className="border border-gray-300 px-4 py-2">{report.fluxDensity100} T</td>
                  </tr>
                  <tr>
                    <td className="border border-gray-300 px-4 py-2 font-bold">{outputIndex++}</td>
                    <td className="border border-gray-300 px-4 py-2 font-bold">Flux density at 110% rated voltage</td>
                    <td className="border border-gray-300 px-4 py-2">Tesla</td>
                    <td className="border border-gray-300 px-4 py-2">{report.fluxDensity110} T</td>
                  </tr>
                  <tr>
                    <td className="border border-gray-300 px-4 py-2 font-bold">{outputIndex++}</td>
                    <td className="border border-gray-300 px-4 py-2 font-bold">Current density<br />A. HV Winding<br />
                      {report.extraVoltageFields && report.extraVoltageFields.lv1lv2 ? (
                        <>
                          B. LV1 Winding<br />C. LV2 Winding
                        </>
                      ) : (
                        <>B. LV Winding</>
                      )}
                    </td>
                    <td className="border border-gray-300 px-4 py-2"></td>
                    <td className="border border-gray-300 px-4 py-2">
                      <br />
                      {'<'} {report.currentDensityHV} A/sq.mm
                      <br />
                      {report.extraVoltageFields && report.extraVoltageFields.lv1lv2 ? (
                        <>
                          {'<'} {report.currentDensityLV1} A/sq.mm (LV1)
                          <br />
                          {'<'} {report.currentDensityLV2} A/sq.mm (LV2)
                        </>
                      ) : (
                        <>{'<'} {report.currentDensityLV} A/sq.mm</>
                      )}
                    </td>
                  </tr>
                  <tr>
                    <td className="border border-gray-300 px-4 py-2 font-bold">{outputIndex++}</td>
                    <td className="border border-gray-300 px-4 py-2 font-bold">HV Bushings<br />a. Make<br />b. Rated voltage class & Current rating</td>
                    <td className="border border-gray-300 px-4 py-2"></td>
                    <td className="border border-gray-300 px-4 py-2"><br />{report.hvBushingMake && report.hvBushingMake.join(', ')}<br />{report.hvBushingRating}</td>
                  </tr>
                  {/* LV Bushings row only if LV1/LV2 is not selected */}
                  {(!report.extraVoltageFields || !report.extraVoltageFields.lv1lv2) && (
                    <tr>
                      <td className="border border-gray-300 px-4 py-2 font-bold">{outputIndex++}</td>
                      <td className="border border-gray-300 px-4 py-2 font-bold">LV Bushings<br />a. Make<br />b. Rated voltage class & Current rating</td>
                      <td className="border border-gray-300 px-4 py-2"></td>
                      <td className="border border-gray-300 px-4 py-2">
                        <br />{report.lvBushingMake && report.lvBushingMake.join(', ')}<br />{report.lvBushingRating}
                      </td>
                    </tr>
                  )}
                  {(() => {
                    let rows = [];
                    let idx = outputIndex;
                    if (report.mvBushingMake && report.mvBushingMake.length > 0) {
                      rows.push(
                        <tr key="row-mv-bushing-report">
                          <td className="border border-gray-300 px-4 py-2 font-bold">{idx}</td>
                          <td className="border border-gray-300 px-4 py-2 font-bold">MV Bushings<br />a. Make<br />b. Rated voltage class & Current rating</td>
                          <td className="border border-gray-300 px-4 py-2"></td>
                          <td className="border border-gray-300 px-4 py-2"><br />{report.mvBushingMake && report.mvBushingMake.join(', ')}<br />{report.mvBushingRating}</td>
                        </tr>
                      );
                      idx++;
                    }
                    if (report.lv1BushingMake && report.lv1BushingMake.length > 0) {
                      rows.push(
                        <tr key="row-lv1-bushing-report">
                          <td className="border border-gray-300 px-4 py-2 font-bold">{idx}</td>
                          <td className="border border-gray-300 px-4 py-2 font-bold">LV1 Bushings<br />a. Make<br />b. Rated voltage class & Current rating</td>
                          <td className="border border-gray-300 px-4 py-2"></td>
                          <td className="border border-gray-300 px-4 py-2"><br />{report.lv1BushingMake && report.lv1BushingMake.join(', ')}<br />{report.lv1BushingRating}</td>
                        </tr>
                      );
                      idx++;
                    }
                    if (report.lv2BushingMake && report.lv2BushingMake.length > 0) {
                      rows.push(
                        <tr key="row-lv2-bushing-report">
                          <td className="border border-gray-300 px-4 py-2 font-bold">{idx}</td>
                          <td className="border border-gray-300 px-4 py-2 font-bold">LV2 Bushings<br />a. Make<br />b. Rated voltage class & Current rating</td>
                          <td className="border border-gray-300 px-4 py-2"></td>
                          <td className="border border-gray-300 px-4 py-2"><br />{report.lv2BushingMake && report.lv2BushingMake.join(', ')}<br />{report.lv2BushingRating}</td>
                        </tr>
                      );
                      idx++;
                    }
                    if (report.tertiaryBushingMake && report.tertiaryBushingMake.length > 0) {
                      rows.push(
                        <tr key="row-tertiary-bushing-report">
                          <td className="border border-gray-300 px-4 py-2 font-bold">{idx}</td>
                          <td className="border border-gray-300 px-4 py-2 font-bold">Tertiary Bushings<br />a. Make<br />b. Rated voltage class & Current rating</td>
                          <td className="border border-gray-300 px-4 py-2"></td>
                          <td className="border border-gray-300 px-4 py-2"><br />{report.tertiaryBushingMake && report.tertiaryBushingMake.join(', ')}<br />{report.tertiaryBushingRating}</td>
                        </tr>
                      );
                      idx++;
                    }
                    outputIndex=idx;
                    return rows;
                  })()}
                  <tr>
                    <td className="border border-gray-300 px-4 py-2 font-bold">{outputIndex++}</td>
                    <td className="border border-gray-300 px-4 py-2 font-bold">Marshalling Box degree of protection</td>
                    <td className="border border-gray-300 px-4 py-2"></td>
                    <td className="border border-gray-300 px-4 py-2">{report.marshallingBoxProtection}</td>
                  </tr>
                  <tr>
                    <td className="border border-gray-300 px-4 py-2 font-bold">{outputIndex++}</td>
                    <td className="border border-gray-300 px-4 py-2 font-bold">Magnetisation current at rated voltage & frequency</td>
                    <td className="border border-gray-300 px-4 py-2"></td>
                    <td className="border border-gray-300 px-4 py-2">{report.magnetisationCurrent}</td>
                  </tr>
                  <tr>
                    <td className="border border-gray-300 px-4 py-2 font-bold">{outputIndex++}</td>
                    <td className="border border-gray-300 px-4 py-2 font-bold">Efficiency</td>
                    <td className="border border-gray-300 px-4 py-2">%</td>
                    <td className="border border-gray-300 px-4 py-2">
                      <div className="mb-2 text-sm text-gray-600">
                        Efficiency calculated @ {report.kvaList && report.kvaList.length > 0 ? Math.max(...report.kvaList) : report.kva} kVA base
                      </div>
                      <table className="w-full border-collapse border border-gray-300 text-xs mt-2">
                        <thead>
                          <tr>
                            <th className="border border-gray-300 p-2">Load (%)</th>
                            <th className="border border-gray-300 p-2">UPF</th>
                            <th className="border border-gray-300 p-2">0.8 PF</th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr>
                            <td className="border border-gray-300 p-2">100</td>
                            <td className="border border-gray-600 p-2">{report.efficiencyUPF100} %</td>
                            <td className="border border-gray-300 p-2">{report.efficiencyPF08_100} %</td>
                          </tr>
                          <tr>
                            <td className="border border-gray-300 p-2">75</td>
                            <td className="border border-gray-300 p-2">{report.efficiencyUPF75} %</td>
                            <td className="border border-gray-300 p-2">{report.efficiencyPF08_75} %</td>
                          </tr>
                          <tr>
                            <td className="border border-gray-300 p-2">50</td>
                            <td className="border border-gray-300 p-2">{report.efficiencyUPF50} %</td>
                            <td className="border border-gray-300 p-2">{report.efficiencyPF08_50} %</td>
                          </tr>
                          <tr>
                            <td className="border border-gray-300 p-2">25</td>
                            <td className="border border-gray-300 p-2">{report.efficiencyUPF25} %</td>
                            <td className="border border-gray-300 p-2">{report.efficiencyPF08_25} %</td>
                          </tr>
                        </tbody>
                      </table>
                    </td>
                  </tr>
                  <tr>
                    <td className="border border-gray-300 px-4 py-2 font-bold">{outputIndex++}</td>
                    <td className="border border-gray-300 px-4 py-2 font-bold">Voltage Regulation at Normal Tap</td>
                    <td className="border border-gray-300 px-4 py-2">%</td>
                    <td className="border border-gray-300 px-4 py-2">
                      At UPF: {report.regulationUPF === undefined || report.regulationUPF === null || report.regulationUPF === 'NaN' ? '-' : report.regulationUPF} %<br />
                      At 0.8 PF: {report.regulationPF08 === undefined || report.regulationPF08 === null || report.regulationPF08 === 'NaN' ? '-' : report.regulationPF08} %
                    </td>
                  </tr>
                  <tr>
                    <td className="border border-gray-300 px-4 py-2 font-bold">{outputIndex++}</td>
                    <td className="border border-gray-300 px-4 py-2 font-bold">Insulation level<br />a) Power Frequency withstand voltage<br />&nbsp;&nbsp;&nbsp;- HV
                      {(!report.extraVoltageFields || !report.extraVoltageFields.lv1lv2) && (<><br />&nbsp;&nbsp;&nbsp;- LV</>)}
                      {report.extraVoltageFields && report.extraVoltageFields.lv1lv2 && (<><br />&nbsp;&nbsp;&nbsp;- LV1<br />&nbsp;&nbsp;&nbsp;- LV2</>)}
                      {report.extraVoltageFields && report.extraVoltageFields.mv && (<><br />&nbsp;&nbsp;&nbsp;- MV</>)}
                      {report.extraVoltageFields && report.extraVoltageFields.tertiary && (<><br />&nbsp;&nbsp;&nbsp;- Tertiary</>)}
                      <br />b) Induced Over Voltage withstand<br />&nbsp;&nbsp;&nbsp;- HV
                      {(!report.extraVoltageFields || !report.extraVoltageFields.lv1lv2) && (<><br />&nbsp;&nbsp;&nbsp;- LV</>)}
                      {report.extraVoltageFields && report.extraVoltageFields.lv1lv2 && (<><br />&nbsp;&nbsp;&nbsp;- LV1<br />&nbsp;&nbsp;&nbsp;- LV2</>)}
                      {report.extraVoltageFields && report.extraVoltageFields.mv && (<><br />&nbsp;&nbsp;&nbsp;- MV</>)}
                      {report.extraVoltageFields && report.extraVoltageFields.tertiary && (<><br />&nbsp;&nbsp;&nbsp;- Tertiary</>)}
                      <br />c) Impulse withstand voltage<br />&nbsp;&nbsp;&nbsp;- HV
                      {(!report.extraVoltageFields || !report.extraVoltageFields.lv1lv2) && (<><br />&nbsp;&nbsp;&nbsp;- LV</>)}
                      {report.extraVoltageFields && report.extraVoltageFields.lv1lv2 && (<><br />&nbsp;&nbsp;&nbsp;- LV1<br />&nbsp;&nbsp;&nbsp;- LV2</>)}
                      {report.extraVoltageFields && report.extraVoltageFields.mv && (<><br />&nbsp;&nbsp;&nbsp;- MV</>)}
                      {report.extraVoltageFields && report.extraVoltageFields.tertiary && (<><br />&nbsp;&nbsp;&nbsp;- Tertiary</>)}
                    </td>
                    <td className="border border-gray-300 px-4 py-2">
                      <br /><br />kVrms
                      {(!report.extraVoltageFields || !report.extraVoltageFields.lv1lv2) && (<><br />kVrms</>)}
                      {report.extraVoltageFields && report.extraVoltageFields.lv1lv2 && (<><br />kVrms<br />kVrms</>)}
                      {report.extraVoltageFields && report.extraVoltageFields.mv && (<><br />kVrms</>)}
                      {report.extraVoltageFields && report.extraVoltageFields.tertiary && (<><br />kVrms</>)}
                      <br /><br />kVrms
                      {(!report.extraVoltageFields || !report.extraVoltageFields.lv1lv2) && (<><br />kVrms</>)}
                      {report.extraVoltageFields && report.extraVoltageFields.lv1lv2 && (<><br />kVrms<br />kVrms</>)}
                      {report.extraVoltageFields && report.extraVoltageFields.mv && (<><br />kVrms</>)}
                      {report.extraVoltageFields && report.extraVoltageFields.tertiary && (<><br />kVrms</>)}
                      <br /><br />kVp
                      {(!report.extraVoltageFields || !report.extraVoltageFields.lv1lv2) && (<><br />kVp</>)}
                      {report.extraVoltageFields && report.extraVoltageFields.lv1lv2 && (<><br />kVp<br />kVp</>)}
                      {report.extraVoltageFields && report.extraVoltageFields.mv && (<><br />kVp</>)}
                      {report.extraVoltageFields && report.extraVoltageFields.tertiary && (<><br />kVp</>)}
                    </td>
                    <td className="border border-gray-300 px-4 py-2">
                      <br /><br />{report.hvPowerFreq}
                      {(!report.extraVoltageFields || !report.extraVoltageFields.lv1lv2) && (<><br />{report.lvPowerFreq}</>)}
                      {report.extraVoltageFields && report.extraVoltageFields.lv1lv2 && (<><br />{report.lv1PowerFreq}<br />{report.lv2PowerFreq}</>)}
                      {report.extraVoltageFields && report.extraVoltageFields.mv && (<><br />{report.mvPowerFreq}</>)}
                      {report.extraVoltageFields && report.extraVoltageFields.tertiary && (<><br />{report.tertiaryPowerFreq}</>)}
                      <br /><br />{report.hvInduced}
                      {(!report.extraVoltageFields || !report.extraVoltageFields.lv1lv2) && (<><br />{report.lvInduced}</>)}
                      {report.extraVoltageFields && report.extraVoltageFields.lv1lv2 && (<><br />{report.lv1Induced}<br />{report.lv2Induced}</>)}
                      {report.extraVoltageFields && report.extraVoltageFields.mv && (<><br />{report.mvInduced}</>)}
                      {report.extraVoltageFields && report.extraVoltageFields.tertiary && (<><br />{report.tertiaryInduced}</>)}
                      <br /><br />{report.hvImpulse}
                      {(!report.extraVoltageFields || !report.extraVoltageFields.lv1lv2) && (<><br />{report.lvImpulse}</>)}
                      {report.extraVoltageFields && report.extraVoltageFields.lv1lv2 && (<><br />{report.lv1Impulse}<br />{report.lv2Impulse}</>)}
                      {report.extraVoltageFields && report.extraVoltageFields.mv && (<><br />{report.mvImpulse}</>)}
                      {report.extraVoltageFields && report.extraVoltageFields.tertiary && (<><br />{report.tertiaryImpulse}</>)}
                    </td>
                  </tr>
                  <tr>
                    <td className="border border-gray-300 px-4 py-2 font-bold">{outputIndex++}</td>
                    <td className="border border-gray-300 px-4 py-2 font-bold">Type of Tap Changer</td>
                    <td className="border border-gray-300 px-4 py-2"></td>
                    <td className="border border-gray-300 px-4 py-2">{report.tapChangerType}</td>
                  </tr>
                  <tr key="row-36">
                    <td className="border border-gray-300 px-4 py-2 font-bold">{outputIndex++}</td>
                    <td className="border border-gray-300 px-4 py-2 font-bold">Tap Changer<br />a) Make<br />b) Current Rating<br />c) Voltage Rating<br />d) Control<br />e) Tapping Range<br />f) Steps/Position</td>
                    <td className="border border-gray-300 px-4 py-2"></td>
                    <td className="border border-gray-300 px-4 py-2"><br />{report.tapChangerMake && report.tapChangerMake.join(', ')}<br />{report.tapChangerCurrentRating}<br />{report.tapChangerVoltageRating}<br />{report.tapChangerControl && report.tapChangerControl.length > 0 ? report.tapChangerControl.join(', ') : <span className="text-gray-400">Select Control Type</span>}<br />{report.tappingRange}<br />{report.tapSteps}</td>
                  </tr>
                  <tr>
                    <td className="border border-gray-300 px-4 py-2 font-bold">{outputIndex++}</td>
                    <td className="border border-gray-300 px-4 py-2 font-bold">Winding Insulation Material Class</td>
                    <td className="border border-gray-300 px-4 py-2"></td>
                    <td className="border border-gray-300 px-4 py-2">{report.insulationClass}</td>
                  </tr>
                  <tr>
                    <td className="border border-gray-300 px-4 py-2 font-bold">{outputIndex++}</td>
                    <td className="border border-gray-300 px-4 py-2 font-bold">Withstand time without injury with three phase dead short circuit</td>
                    <td className="border border-gray-300 px-4 py-2">Sec</td>
                    <td className="border border-gray-300 px-4 py-2">{report.withstandTime} Sec.</td>
                  </tr>
                  <tr>
                    <td className="border border-gray-300 px-4 py-2 font-bold">{outputIndex++}</td>
                    <td className="border border-gray-300 px-4 py-2 font-bold">Neutral terminal Bushing Current Transformer</td>
                    <td className="border border-gray-300 px-4 py-2"></td>
                    <td className="border border-gray-300 px-4 py-2">{report.neutralCT}</td>
                  </tr>
                  <tr>
                    <td className="border border-gray-300 px-4 py-2 font-bold">{outputIndex++}</td>
                    <td className="border border-gray-300 px-4 py-2 font-bold">Permissible overloading:</td>
                    <td className="border border-gray-300 px-4 py-2"></td>
                    <td className="border border-gray-300 px-4 py-2" colSpan="2">
                      a. HV winding: {report.hvOverloadingCapacity ? report.hvOverloadingCapacity : '-'} &nbsp;&nbsp;<br></br>
                      b. LV winding:  {report. lvOverloadingCapacity ? report.lvOverloadingCapacity : '-'}
                    </td>
                  </tr>
                  {/* Minimum Clearances Row */}
                  {report.minimumClearances && (
                    <tr>
                      <td className="border border-gray-300 px-4 py-2 font-bold">{outputIndex++}</td>
                      <td className="border border-gray-300 px-4 py-2 font-bold">Minimum Clearances<br/>
                        <span className="font-normal">(as per BIL value)</span>
                      </td>
                      <td className="border border-gray-300 p-4"></td>
                      <td className="border border-gray-300 p-4">
                        <table className="w-full border border-gray-200 text-xs">
                          <thead>
                            <tr className="bg-gray-50">
                              <th className="border border-gray-200 p-1">Winding</th>
                              <th className="border border-gray-200 p-1">BIL (kV peak)</th>
                              <th className="border border-gray-200 p-1">Phase to Phase (mm)</th>
                              <th className="border border-gray-200 p-1">Phase to Earth (mm)</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td className="border border-gray-200 p-1">HV</td>
                              <td className="border border-gray-200 p-1">{report.hvImpulse}</td>
                              <td className="border border-gray-200 p-1">{report.minimumClearances.HV.phaseToPhase}</td>
                              <td className="border border-gray-200 p-1">{report.minimumClearances.HV.phaseToEarth}</td>
                            </tr>
                            {/* Only show LV if LV1/LV2 is NOT checked */}
                            {!report.extraVoltageFields || !report.extraVoltageFields.lv1lv2 ? (
                              <tr>
                                <td className="border border-gray-200 p-1">LV</td>
                                <td className="border border-gray-200 p-1">{report.lvImpulse}</td>
                                <td className="border border-gray-200 p-1">{report.minimumClearances.LV.phaseToPhase}</td>
                                <td className="border border-gray-200 p-1">{report.minimumClearances.LV.phaseToEarth}</td>
                              </tr>
                            ) : null}
                            {/* Show LV1/LV2 if selected */}
                            {report.extraVoltageFields && report.extraVoltageFields.lv1lv2 ? (
                              <>
                                <tr>
                                  <td className="border border-gray-200 p-1">LV1</td>
                                  <td className="border border-gray-200 p-1">{report.lv1Impulse}</td>
                                  <td className="border border-gray-200 p-1">{report.minimumClearances.LV1?.phaseToPhase}</td>
                                  <td className="border border-gray-200 p-1">{report.minimumClearances.LV1?.phaseToEarth}</td>
                                </tr>
                                <tr>
                                  <td className="border border-gray-200 p-1">LV2</td>
                                  <td className="border border-gray-200 p-1">{report.lv2Impulse}</td>
                                  <td className="border border-gray-200 p-1">{report.minimumClearances.LV2?.phaseToPhase}</td>
                                  <td className="border border-gray-200 p-1">{report.minimumClearances.LV2?.phaseToEarth}</td>
                                </tr>
                              </>
                            ) : null}
                            {/* Show MV if selected */}
                            {report.extraVoltageFields && report.extraVoltageFields.mv ? (
                              <tr>
                                <td className="border border-gray-200 p-1">MV</td>
                                <td className="border border-gray-200 p-1">{report.mvImpulse}</td>
                                <td className="border border-gray-200 p-1">{report.minimumClearances.MV?.phaseToPhase}</td>
                                <td className="border border-gray-200 p-1">{report.minimumClearances.MV?.phaseToEarth}</td>
                              </tr>
                            ) : null}
                            {/* Show Tertiary if selected */}
                            {report.extraVoltageFields && report.extraVoltageFields.tertiary ? (
                              <tr>
                                <td className="border border-gray-200 p-1">Tertiary</td>
                                <td className="border border-gray-200 p-1">{report.tertiaryImpulse}</td>
                                <td className="border border-gray-200 p-1">{report.minimumClearances.Tertiary?.phaseToPhase}</td>
                                <td className="border border-gray-200 p-1">{report.minimumClearances.Tertiary?.phaseToEarth}</td>
                              </tr>
                            ) : null}
                          </tbody>
                        </table>
                      </td>
                    </tr>
                  )}
                  <tr>
                    <td className="border border-gray-300 px-4 py-2 font-bold">{outputIndex++}</td>
                     <td className="border border-gray-300 px-4 py-2 font-bold"> Terminals<br /> a) HV
                             {report.extraVoltageFields && report.extraVoltageFields.mv ? (<><br />b) MV</>) : null}
                             {report.extraVoltageFields && report.extraVoltageFields.lv1lv2 ? (<><br />{report.extraVoltageFields.mv ? 'c' : 'b'}) LV1<br />{report.extraVoltageFields.mv ? 'd' : 'c'}) LV2</>) : (<><br />{report.extraVoltageFields.mv ? 'c' : 'b'}) LV</>)}
                             {report.extraVoltageFields && report.extraVoltageFields.tertiary ? (<><br />{report.extraVoltageFields.lv1lv2 ? (report.extraVoltageFields.mv ? 'e' : 'd') : (report.extraVoltageFields.mv ? 'd' : 'c')}) Tertiary</>) : null}
                     </td>
                     <td className="border border-gray-300 p-4"></td>
                     <td className="border border-gray-300 p-4"><br />
                             {report.hvBushingMake && report.hvBushingMake.length > 0 ? report.hvBushingMake.join(', ') : '-'}<br />
                             {report.extraVoltageFields && report.extraVoltageFields.mv ? (
                            <>{report.mvBushingMake && report.mvBushingMake.length > 0 ? report.mvBushingMake.join(', ') : '-'}<br /></>
                              ) : null}
                           {report.extraVoltageFields && report.extraVoltageFields.lv1lv2 ? (
                            <>
                             {report.lv1BushingMake && report.lv1BushingMake.length > 0 ? report.lv1BushingMake.join(', ') : '-'}<br />
                             {report.lv2BushingMake && report.lv2BushingMake.length > 0 ? report.lv2BushingMake.join(', ') : '-'}
                              </>
                            ) : (
                             <>{report.lvBushingMake && report.lvBushingMake.length > 0 ? report.lvBushingMake.join(', ') : '-'}</>
                             )}
                              {report.extraVoltageFields && report.extraVoltageFields.tertiary ? (
                            <><br />{report.tertiaryBushingMake && report.tertiaryBushingMake.length > 0 ? report.tertiaryBushingMake.join(', ') : '-'}</>
                            ) : null}
                    </td>
                  </tr>
                  <tr>
                    <td className="border border-gray-300 px-4 py-2 font-bold">{outputIndex++}</td>
                    <td className="border border-gray-300 px-4 py-2 font-bold">Termination Arrangement<br />a) HV
                    {/* Only show LV if LV1/LV2 is NOT checked */}
                    {!report.extraVoltageFields || !report.extraVoltageFields.lv1lv2 ? (<><br />b) LV</>) : null}
                    {/* Show LV1/LV2 if selected */}
                    {report.extraVoltageFields && report.extraVoltageFields.lv1lv2 ? (<><br />b) LV1<br />c) LV2</>) : null}
                    {report.extraVoltageFields && report.extraVoltageFields.mv ? (<><br />{report.extraVoltageFields.lv1lv2 ? 'd' : 'c'}) MV</>) : null}
                    {report.extraVoltageFields && report.extraVoltageFields.tertiary ? (<><br />{report.extraVoltageFields.lv1lv2 ? (report.extraVoltageFields.mv ? 'e' : 'd') : (report.extraVoltageFields.mv ? 'd' : 'c')}) Tertiary</>) : null}
                    </td>
                    <td className="border border-gray-300 p-4"></td>
                    <td className="border border-gray-300 px-4 py-2"><br />
                   {Array.isArray(report.hvTerminationArrangement) ? report.hvTerminationArrangement.join(', ') : report.hvTerminationArrangement || '-'}<br/>
  
                   {!report.extraVoltageFields.lv1lv2 ? (
                              <> {Array.isArray(report.lvTerminationArrangement) ? report.lvTerminationArrangement.join(', ') : report.lvTerminationArrangement || '-'}<br/></>
                         ) : (
                           <>
                                 {Array.isArray(report.lv1TerminationArrangement) ? report.lv1TerminationArrangement.join(', ') : report.lv1TerminationArrangement || '-'}<br/>
                                 {Array.isArray(report.lv2TerminationArrangement) ? report.lv2TerminationArrangement.join(', ') : report.lv2TerminationArrangement || '-'}<br/>
                           </>
                         )}
  
                      {report.extraVoltageFields.mv && (
                              <> {Array.isArray(report.mvTerminationArrangement) ? report.mvTerminationArrangement.join(', ') : report.mvTerminationArrangement || '-'}<br/></>
                        )}
  
                     {report.extraVoltageFields.tertiary && (
                              <>{Array.isArray(report.tertiaryTerminationArrangement) ? report.tertiaryTerminationArrangement.join(', ') : report.tertiaryTerminationArrangement || '-'}</>
                          )}
                   </td>
                  </tr>
                  <tr>
                    <td className="border border-gray-300 px-4 py-2 font-bold">{outputIndex++}</td>
                    <td className="border border-gray-300 px-4 py-2 font-bold">Paint type & shade</td>
                    <td className="border border-gray-300 px-4 py-2"></td>
                    <td className="border border-gray-300 px-4 py-2">{report.paint}</td>
                  </tr>
                  <tr>
                    <td className="border border-gray-300 px-4 py-2 font-bold">{outputIndex++}</td>
                    <td className="border border-gray-300 px-4 py-2 font-bold">Transformer Oil</td>
                    <td className="border border-gray-300 px-4 py-2"></td>
                    <td className="border border-gray-300 px-4 py-2">{report.transformerOil || '-'}</td>
                   </tr>
                  {report.showDimensionsWeight && (
                    <>
                      <tr>
                        <td className="border border-gray-300 px-4 py-2 font-bold">{outputIndex++}</td>
                        <td className="border border-gray-300 px-4 py-2 font-bold">Overall Dimensions<br />a) Length<br />b) Width<br />c) Height<br />d) Untanking height:</td>
                        <td className="border border-gray-300 px-4 py-2"><br />mm<br />mm<br />mm</td>
                        <td className="border border-gray-300 px-4 py-2"><br />{report.length}<br />{report.width}<br />{report.height}<br />{report.untankingHeight ? ` ${report.untankingHeight} mm` : ''}</td>
                      </tr>
                      <tr>
                        <td className="border border-gray-300 px-4 py-2 font-bold">{outputIndex++}</td>
                        <td className="border border-gray-300 px-4 py-2 font-bold">Weight Details<br />a) Core & Windings<br />b) Tank & Fittings<br />c) Oil Mass(in kg)<br />d) Oil Mass(in litre)<br />e) Total Weight</td>
                        <td className="border border-gray-300 px-4 py-2"><br />kg<br />kg<br />kg<br />ltr<br />kg</td>
                        <td className="border border-gray-300 px-4 py-2"><br />{report.coreWindingsWeight}<br />{report.tankFittingsWeight}<br />{report.oilMass}<br />{report.oilMassLitre}<br />{report.totalWeight}</td>
                      </tr>
                    </>
                  )}
                  <tr>
                    <td className="border border-gray-300 px-4 py-2 font-bold">{outputIndex++}</td>
                    <td className="border border-gray-300 px-4 py-2 font-bold">Service</td>
                    <td className="border border-gray-300 px-4 py-2"></td>
                    <td className="border border-gray-300 px-4 py-2">{report.service}</td>
                  </tr>
                  <tr>
                    <td className="border border-gray-300 px-4 py-2 font-bold">{outputIndex++}</td>
                    <td className="border border-gray-300 px-4 py-2 font-bold">Details of Tanks</td>
                    <td className="border border-gray-300 px-4 py-2"></td>
                    <td className="border border-gray-300 px-4 py-2">
                      
                      <div className="mb-2">
                        <span className="font-semibold"> Approximate thickness of sheet:</span>
                        <div className="ml-4">
                          <div>a. Sides: {report.detailsOfTanks?.thicknessSides || '-'} mm</div>
                          <div>b. Bottom: {report.detailsOfTanks?.thicknessBottom || '-'} mm</div>
                          <div>c. Top Cover: {report.detailsOfTanks?.thicknessTopCover || '-'} mm</div>
                          <div>d. Cooling Tubes / Radiators: {report.detailsOfTanks?.thicknessRadiators || '-'} mm</div>
                        </div>
                      </div>
                <div>
                        <span className="font-semibold">c. Material of Tank:</span> {report.detailsOfTanks?.materialOfTank || '-'}
                </div>
                      <div>
                        <span className="font-semibold">d. Construction:</span> {report.detailsOfTanks?.construction || '-'}
                      </div>
                    </td>
                  </tr>
                  <tr>
                    <td className="border border-gray-300 px-4 py-2 font-bold">{outputIndex++}</td>
                    <td className="border border-gray-300 px-4 py-2 font-bold">Core lamination:</td>
                    <td className="border border-gray-300 px-4 py-2"></td>
                    <td className="border border-gray-300 px-4 py-2">
                      <span className="font-semibold">a. Material of core laminations:</span> {report.coreLaminationMaterial ? report.coreLaminationMaterial : '-'}<br /><br></br>
                      <span className="font-semibold"> b. Thickness of core laminations :</span>{report.coreLaminationThickness ? report.coreLaminationThickness : '-'}<br /><br />
                      <span className="font-semibold">c. Type of construction:</span> {report.constructionType ? report.constructionType : '-'}<br /><br />
                      <span className="font-semibold">d. Type of core joints:</span> {report.coreJointType ? report.coreJointType : '-'}
                    </td>
                  </tr>
                  <tr>
                    <td className="border border-gray-300 px-4 py-2 font-bold">{outputIndex++}</td>
                    <td className="border border-gray-300 px-4 py-2 font-bold">Insulating material used for:</td>
                    <td className="border border-gray-300 px-4 py-2"></td>
                    <td className="border border-gray-300 px-4 py-2">
                      <span className="font-semibold"> a. HV winding:</span> {(report.insulatingMaterialHV && report.insulatingMaterialHV.length > 0) ? report.insulatingMaterialHV.join(', ') : '-'}<br />
                      {report.extraVoltageFields && report.extraVoltageFields.lv1lv2 ? (
                        <>
                        <span className="font-semibold"> b. LV1 winding:</span> {(report.insulatingMaterialLV1 && report.insulatingMaterialLV1.length > 0) ? report.insulatingMaterialLV1.join(', ') : '-'}<br />
                          <span className="font-semibold">c. LV2 winding:</span> {(report.insulatingMaterialLV2 && report.insulatingMaterialLV2.length > 0) ? report.insulatingMaterialLV2.join(', ') : '-'}<br />
                        </>
                      ) : (
                        <><span className="font-semibold">b. LV winding:</span> {(report.insulatingMaterialLV && report.insulatingMaterialLV.length > 0) ? report.insulatingMaterialLV.join(', ') : '-'}<br /></>
                      )}
                      {report.extraVoltageFields && report.extraVoltageFields.mv && (
                        <>{report.extraVoltageFields.lv1lv2 ? 'd.' : 'c.'} <span className="font-semibold">MV winding:</span> {(report.insulatingMaterialMV && report.insulatingMaterialMV.length > 0) ? report.insulatingMaterialMV.join(', ') : '-'}<br /></>
                      )}
                      {report.extraVoltageFields && report.extraVoltageFields.tertiary && (
                        <>{report.extraVoltageFields.lv1lv2 ? (report.extraVoltageFields.mv ? 'e.' : 'd.') : (report.extraVoltageFields.mv ? 'd.' : 'c.')} <span className="font-semibold">Tertiary winding:</span> {(report.insulatingMaterialTertiary && report.insulatingMaterialTertiary.length > 0) ? report.insulatingMaterialTertiary.join(', ') : '-'}<br /></>
                      )}
                    </td>
                  </tr>
                  <tr>
                    <td className="border border-gray-300 px-4 py-2 font-bold">{outputIndex++}</td>
                    <td className="border border-gray-300 px-4 py-2 font-bold">Insulating material used between:</td>
                    <td className="border border-gray-300 px-4 py-2"></td>
                    <td className="border border-gray-300 px-4 py-2">
                      <span className="font-semibold">a. HV and {report.extraVoltageFields && report.extraVoltageFields.lv1lv2 ? 'LV1' : 'LV'} winding:</span> {(report.insulatingMaterialBetweenHVLV1 && report.insulatingMaterialBetweenHVLV1.length > 0) ? report.insulatingMaterialBetweenHVLV1.join(', ') : (report.insulatingMaterialBetweenHVLV && report.insulatingMaterialBetweenHVLV.length > 0) ? report.insulatingMaterialBetweenHVLV.join(', ') : '-'}<br />
                      {report.extraVoltageFields && report.extraVoltageFields.lv1lv2 && (
                        <><span className="font-semibold">b. HV and LV2 winding:</span> {(report.insulatingMaterialBetweenHVLV2 && report.insulatingMaterialBetweenHVLV2.length > 0) ? report.insulatingMaterialBetweenHVLV2.join(', ') : '-'}<br /></>
                      )}
                      {report.extraVoltageFields && report.extraVoltageFields.mv && (
                        <><span className="font-semibold">{report.extraVoltageFields.lv1lv2 ? 'c.' : 'b.'} HV and MV winding:</span> {(report.insulatingMaterialBetweenHVMV && report.insulatingMaterialBetweenHVMV.length > 0) ? report.insulatingMaterialBetweenHVMV.join(', ') : '-'}<br /></>
                      )}
                      {report.extraVoltageFields && report.extraVoltageFields.tertiary && (
                        <><span className="font-semibold">{report.extraVoltageFields.lv1lv2 ? (report.extraVoltageFields.mv ? 'd.' : 'c.') : (report.extraVoltageFields.mv ? 'd.' : 'c.')}HV and Tertiary winding:</span> {(report.insulatingMaterialBetweenHVTertiary && report.insulatingMaterialBetweenHVTertiary.length > 0) ? report.insulatingMaterialBetweenHVTertiary.join(', ') : '-'}<br /></>
                      )}
                      {report.extraVoltageFields && report.extraVoltageFields.lv1lv2 ? (
                        <>
                        <span className="font-semibold">{report.extraVoltageFields.mv || report.extraVoltageFields.tertiary ? (report.extraVoltageFields.mv && report.extraVoltageFields.tertiary ? 'e.' : 'd.') : 'c.'} LV1 winding and core:</span> {(report.insulatingMaterialBetweenLV1Core && report.insulatingMaterialBetweenLV1Core.length > 0) ? report.insulatingMaterialBetweenLV1Core.join(', ') : '-'}<br />
                        <span className="font-semibold">{report.extraVoltageFields.mv || report.extraVoltageFields.tertiary ? (report.extraVoltageFields.mv && report.extraVoltageFields.tertiary ? 'f.' : 'e.') : 'd.'} LV2 winding and core:</span> {(report.insulatingMaterialBetweenLV2Core && report.insulatingMaterialBetweenLV2Core.length > 0) ? report.insulatingMaterialBetweenLV2Core.join(', ') : '-'}<br />
                        </>
                      ) : (
                        <><span className="font-semibold">{report.extraVoltageFields && (report.extraVoltageFields.mv || report.extraVoltageFields.tertiary) ? 'c.' : 'b.'} LV winding and core:</span> {(report.insulatingMaterialBetweenLVCore && report.insulatingMaterialBetweenLVCore.length > 0) ? report.insulatingMaterialBetweenLVCore.join(', ') : '-'}<br /></>
                      )}
                      {report.extraVoltageFields && report.extraVoltageFields.mv && (
                        <><span className="font-semibold">{report.extraVoltageFields.lv1lv2 ? (report.extraVoltageFields.tertiary ? 'g.' : 'f.') : (report.extraVoltageFields.tertiary ? 'd.' : 'c.')} MV winding and core:</span> {(report.insulatingMaterialBetweenMVCore && report.insulatingMaterialBetweenMVCore.length > 0) ? report.insulatingMaterialBetweenMVCore.join(', ') : '-'}<br /></>
                      )}
                      {report.extraVoltageFields && report.extraVoltageFields.tertiary && (
                        <><span className="font-semibold">{report.extraVoltageFields.lv1lv2 ? 'h.' : report.extraVoltageFields.mv ? 'e.' : 'c.'}Tertiary winding and core:</span> {(report.insulatingMaterialBetweenTertiaryCore && report.insulatingMaterialBetweenTertiaryCore.length > 0) ? report.insulatingMaterialBetweenTertiaryCore.join(', ') : '-'}<br /></>
                      )}
                    </td>
                  </tr>
                  <tr>
                    <td className="border border-gray-300 px-4 py-2 font-bold">{outputIndex++}</td>
                    <td className="border border-gray-300 px-4 py-2 font-bold">Type of axial coil supports:</td>
                    <td className="border border-gray-300 px-4 py-2"></td>
                    <td className="border border-gray-300 px-4 py-2">
                      <span className="font-semibold">a. HV winding:</span> {(report.axialCoilSupportHV && report.axialCoilSupportHV.length > 0) ? report.axialCoilSupportHV.join(', ') : '-'}<br />
                      {report.extraVoltageFields && report.extraVoltageFields.lv1lv2 ? (
                        <>
                        <span className="font-semibold"> b. LV1 winding: </span>{(report.axialCoilSupportLV1 && report.axialCoilSupportLV1.length > 0) ? report.axialCoilSupportLV1.join(', ') : '-'}<br />
                          <span className="font-semibold"> c. LV2 winding:</span> {(report.axialCoilSupportLV2 && report.axialCoilSupportLV2.length > 0) ? report.axialCoilSupportLV2.join(', ') : '-'}<br />
                        </>
                      ) : (
                        <><span className="font-semibold">b. LV winding:</span> {(report.axialCoilSupportLV && report.axialCoilSupportLV.length > 0) ? report.axialCoilSupportLV.join(', ') : '-'}<br /></>
                      )}
                      {report.extraVoltageFields && report.extraVoltageFields.mv && (
                        <>{report.extraVoltageFields.lv1lv2 ? 'd.' : 'c.'}<span className="font-semibold"> MV winding:</span> {(report.axialCoilSupportMV && report.axialCoilSupportMV.length > 0) ? report.axialCoilSupportMV.join(', ') : '-'}<br /></>
                      )}
                      {report.extraVoltageFields && report.extraVoltageFields.tertiary && (
                        <>{report.extraVoltageFields.lv1lv2 ? (report.extraVoltageFields.mv ? 'e.' : 'd.') : (report.extraVoltageFields.mv ? 'd.' : 'c.')}<span className="font-semibold"> Tertiary winding:</span> {(report.axialCoilSupportTertiary && report.axialCoilSupportTertiary.length > 0) ? report.axialCoilSupportTertiary.join(', ') : '-'}<br /></>
                      )}
                    </td>
                  </tr>
                  <tr>
                    <td className="border border-gray-300 px-4 py-2 font-bold">{outputIndex++}</td>
                    <td className="border border-gray-300 px-4 py-2 font-bold">Type of radial coil supports:</td>
                    <td className="border border-gray-300 px-4 py-2"></td>
                    <td className="border border-gray-300 px-4 py-2">
                      <span className="font-semibold">a. HV winding:</span> {(report.radialCoilSupportHV && report.radialCoilSupportHV.length > 0) ? report.radialCoilSupportHV.join(', ') : '-'}<br />
                      {report.extraVoltageFields && report.extraVoltageFields.lv1lv2 ? (
                        <>
                        <span className="font-semibold"> b. LV1 winding:</span> {(report.radialCoilSupportLV1 && report.radialCoilSupportLV1.length > 0) ? report.radialCoilSupportLV1.join(', ') : '-'}<br />
                        <span className="font-semibold"> c. LV2 winding:</span> {(report.radialCoilSupportLV2 && report.radialCoilSupportLV2.length > 0) ? report.radialCoilSupportLV2.join(', ') : '-'}<br />
                        </>
                      ) : (
                        <><span className="font-semibold">b. LV winding:</span> {(report.radialCoilSupportLV && report.radialCoilSupportLV.length > 0) ? report.radialCoilSupportLV.join(', ') : '-'}<br /></>
                      )}
                      {report.extraVoltageFields && report.extraVoltageFields.mv && (
                        <>{report.extraVoltageFields.lv1lv2 ? 'd.' : 'c.'}<span className="font-semibold"> MV winding:</span> {(report.radialCoilSupportMV && report.radialCoilSupportMV.length > 0) ? report.radialCoilSupportMV.join(', ') : '-'}<br /></>
                      )}
                      {report.extraVoltageFields && report.extraVoltageFields.tertiary && (
                        <>{report.extraVoltageFields.lv1lv2 ? (report.extraVoltageFields.mv ? 'e.' : 'd.') : (report.extraVoltageFields.mv ? 'd.' : 'c.')}<span className="font-semibold"> Tertiary winding:</span> {(report.radialCoilSupportTertiary && report.radialCoilSupportTertiary.length > 0) ? report.radialCoilSupportTertiary.join(', ') : '-'}<br /></>
                      )}
                    </td>
                  </tr>
                  <tr>
                    <td className="border border-gray-300 px-4 py-2 font-bold">{outputIndex++}</td>
                    <td className="border border-gray-300 px-4 py-2 font-bold">No. of bi-directional wheels provided</td>
                    <td className="border border-gray-300 px-4 py-2"></td>
                    <td className="border border-gray-300 px-4 py-2">{report.numBiDirectionalWheels}</td>
                  </tr>
                  <tr>
                    <td className="border border-gray-300 px-4 py-2 font-bold" rowSpan="3">{outputIndex++}</td>
                    <td className="border border-gray-300 px-4 py-2 font-bold">Track gauge required for the wheels</td>
                    <td className="border border-gray-300 px-4 py-2">mm</td>
                    <td className="border border-gray-300 px-4 py-2"></td>
                  </tr>
                  <tr>
                    <td className="border border-gray-300 px-4 py-2 font-bold">a. Trans axis</td>
                    <td className="border border-gray-300 px-4 py-2"></td>
                    <td className="border border-gray-300 px-4 py-2">{report.trackGaugeTransAxis}</td>
                  </tr>
                  <tr>
                    <td className="border border-gray-300 px-4 py-2 font-bold">b. Long axis</td>
                    <td className="border border-gray-300 px-4 py-2"></td>
                    <td className="border border-gray-300 px-4 py-2">{report.trackGaugeLongAxis}</td>
                  </tr>
                  <tr>
                    <td className="border border-gray-300 px-4 py-2 font-bold">{outputIndex++}</td>
                    <td className="border border-gray-300 px-4 py-2 font-bold">MOG make and type</td>
                    <td className="border border-gray-300 px-4 py-2"></td>
                    <td className="border border-gray-300 px-4 py-2">
                      Make: {(report.mogMake && report.mogMake.length > 0) ? report.mogMake.join(', ') : '-'}<br />
                      Type: {(Array.isArray(report.mogType) && report.mogType.length > 0)
                        ? report.mogType.join(', ')
                        : (report.mogType || '-')}
                    </td>
                  </tr>
                  <tr>
                    <td className="border border-gray-300 px-4 py-2 font-bold">{outputIndex++}</td>
                    <td className="border border-gray-300 px-4 py-2 font-bold">Gas and oil operated relay make and type</td>
                    <td className="border border-gray-300 px-4 py-2"></td>
                    <td className="border border-gray-300 px-4 py-2">
                      Make: {(report.relayMake && report.relayMake.length > 0) ? report.relayMake.join(', ') : '-'}<br />
                      Type: {(Array.isArray(report.relayType) && report.relayType.length > 0)
                        ? report.relayType.join(', ')
                        : (report.relayType || '-')}
                    </td>
                  </tr>
                  <tr>
                    <td className="border border-gray-300 px-4 py-2 font-bold" rowSpan="1">{outputIndex++}</td>
                    <td className="border border-gray-300 px-4 py-2 font-bold">Temperature Indicators:<br/>Make and Type</td>
                    <td className="border border-gray-300 px-4 py-2"></td>
                    <td className="border border-gray-300 px-4 py-2">
                      Make: {(Array.isArray(report.tempControllerMake) && report.tempControllerMake.length > 0) ? report.tempControllerMake.join(', ') : '-'}<br />
                      Type: {Array.isArray(report.tempControllerType)
                        ? report.tempControllerType.join(', ')
                        : (report.tempControllerType ? report.tempControllerType : '-')}
                    </td>
                  </tr>
                  <tr>
                    <td className="border border-gray-300 px-4 py-2 font-bold">{outputIndex++}</td>
                    <td className="border border-gray-300 px-4 py-2 font-bold">Pressure Relief Device (PRD)</td>
                    <td className="border border-gray-300 px-4 py-2"></td>
                    <td className="border border-gray-300 px-4 py-2">
                      {Array.isArray(report.prdMake) && report.prdMake.length > 0 ? report.prdMake.join(', ') : (report.prdMake || '-')}
                    </td>
                  </tr>
                  <tr>
                    <td className="border border-gray-300 px-4 py-2 font-bold">{outputIndex++}</td>
                    <td className="border border-gray-300 px-4 py-2 font-bold">Transformers will be transported with oil / gas</td>
                    <td className="border border-gray-300 px-4 py-2"></td>
                    <td className="border border-gray-300 px-4 py-2">{report.transportWith}</td>
                  </tr>
                  <tr>
                    <td className="border border-gray-300 px-4 py-2 font-bold">{outputIndex++}</td>
                    <td className="border border-gray-300 px-4 py-2 font-bold">Limit of hot spot temperature for which the transformers are designed</td>
                    <td className="border border-gray-300 px-4 py-2">C</td>
                    <td className="border border-gray-300 px-4 py-2">{report.hotSpotTempLimit}</td>
                  </tr>
                  <tr>
                    <td className="border border-gray-300 px-4 py-2 font-bold">{outputIndex++}</td>
                    <td className="border border-gray-300 px-4 py-2 font-bold">Maximum hot spot temperature under normal conditions of loading (at MCR)</td>
                    <td className="border border-gray-300 px-4 py-2">C</td>
                    <td className="border border-gray-300 px-4 py-2">{report.hotSpotTempMax}</td>
                  </tr>
                  <tr>
                    <td className="border border-gray-300 px-4 py-2 font-bold" rowSpan="3">{outputIndex++}</td>
                    <td className="border border-gray-300 px-4 py-2 "></td>
                    <td className="border border-gray-300 px-4 py-2"></td>
                    <td className="border border-gray-300 px-4 py-2">{report.overVoltage1Percent}% rated voltage for {report.overVoltage1Duration}</td>
                  </tr>
                  <tr>
                    <td className="border border-gray-300 px-4 py-2 font-bold">Over voltage operating capability and duration</td>
                    <td className="border border-gray-300 px-4 py-2">% rated voltage for seconds</td>
                    <td className="border border-gray-300 px-4 py-2">{report.overVoltage2Percent}% rated voltage for {report.overVoltage2Duration}</td>
                  </tr>
                  <tr>
                    <td className="border border-gray-300 px-4 py-2"></td>
                    <td className="border border-gray-300 px-4 py-2"></td>
                    <td className="border border-gray-300 px-4 py-2">{report.overVoltage3Percent}% rated voltage {report.overVoltage3Duration}</td>
                  </tr>
                  <tr>
                    <td className="border border-gray-300 px-4 py-2 font-bold" rowSpan="3">{outputIndex++}</td>
                    <td className="border border-gray-300 px-4 py-2 font-bold">Regulation of full load and 75 Deg.C winding temp expressed as a percentage of normal voltage</td>
                    <td className="border border-gray-300 px-4 py-2">%</td>
                    <td className="border border-gray-300 px-4 py-2"></td>
                  </tr>
                  <tr>
                    <td className="border border-gray-300 px-4 py-2 font-bold">At unity power factor</td>
                    <td className="border border-gray-300 px-4 py-2"></td>
                    <td className="border border-gray-300 px-4 py-2">{report.regulationUPF} %</td>
                  </tr>
                  <tr>
                    <td className="border border-gray-300 px-4 py-2 font-bold">At 0.8 pf (lagging)</td>
                    <td className="border border-gray-300 px-4 py-2"></td>
                    <td className="border border-gray-300 px-4 py-2">{report.regulationPF08} %</td>
                  </tr>
                  <tr>
                    <td className="border border-gray-300 px-4 py-2 font-bold">{outputIndex++}</td>
                    <td className="border border-gray-300 px-4 py-2 font-bold">Confirm overloading capacity of transformer and all associated</td>

                    <td className="border border-gray-300 px-4 py-2">{report.confirmOverloading}</td>
                  </tr>
                  <tr>
                    <td className="border border-gray-300 px-4 py-2 font-bold" rowSpan="1">{outputIndex++}</td>
                    <td className="border border-gray-300 px-4 py-2 font-bold">Insulating and cooling medium</td>
                    <td className="border border-gray-300 px-4 py-2"></td>
                    <td className="border border-gray-300 px-4 py-2">{report.insulatingMedium}</td>
                  </tr>
                  <tr>
                    <td className="border border-gray-300 px-4 py-2 font-bold">{outputIndex++}</td>
                    <td className="border border-gray-300 px-4 py-2 font-bold">Electrostatic shields are provided to obtain uniform</td>
                    <td className="border border-gray-300 px-4 py-2"></td>
                    <td className="border border-gray-300 px-4 py-2">{report.electrostaticShields || '-'}</td>
                  </tr>
                  {showDimensionsWeight && report.length && report.width && report.height && report.totalWeight && (
                    <tr>
                      <td className="border border-gray-300 px-4 py-2 font-bold">{outputIndex++}</td>
                      <td className="border border-gray-300 px-4 py-2 font-bold" colSpan="3">
                        Note: Weights and dimensions are approximate and may vary at the time of final design.
                      </td>
                    </tr>
                  )}
                </tbody>
              </table>
              <h3 className="text-lg font-semibold mt-4 mb-2 page-break">List of Accessories/Fittings</h3>
              <table className="w-full border-collapse border border-gray-300 text-sm mb-4">
                <thead>
                  <tr className="bg-blue-100">
                    <th className="border border-gray-300 p-2">Sr. No.</th>
                    <th className="border border-gray-300 p-2">Description</th>
                    <th className="border border-gray-300 p-2">Quantity</th>
                  </tr>
                </thead>
                <tbody>
                  {[
                    // Add dynamic termination types at the top based on selected arrangements
                    ...(report.hvTerminationArrangement && report.hvTerminationArrangement.length > 0 ? [{ desc: getTerminationDescription('HV Termination', report.hvTerminationArrangement), qty: 1 }] : []),
                    // Show LV Termination only when LV1/LV2 is NOT selected
                    ...(!report.extraVoltageFields?.lv1lv2 && report.lvTerminationArrangement && report.lvTerminationArrangement.length > 0 ? [{ desc: getTerminationDescription('LV Termination', report.lvTerminationArrangement), qty: 1 }] : []),
                    // Show LV1 Termination only when LV1/LV2 IS selected
                    ...(report.extraVoltageFields?.lv1lv2 && report.lv1TerminationArrangement && report.lv1TerminationArrangement.length > 0 ? [{ desc: getTerminationDescription('LV1 Termination', report.lv1TerminationArrangement), qty: 1 }] : []),
                    // Show LV2 Termination only when LV1/LV2 IS selected
                    ...(report.extraVoltageFields?.lv1lv2 && report.lv2TerminationArrangement && report.lv2TerminationArrangement.length > 0 ? [{ desc: getTerminationDescription('LV2 Termination', report.lv2TerminationArrangement), qty: 1 }] : []),
                    // Show MV Termination only when MV is selected
                    ...(report.extraVoltageFields?.mv && report.mvTerminationArrangement && report.mvTerminationArrangement.length > 0 ? [{ desc: getTerminationDescription('MV Termination', report.mvTerminationArrangement), qty: 1 }] : []),
                    // Show Tertiary Termination only when Tertiary is selected
                    ...(report.extraVoltageFields?.tertiary && report.tertiaryTerminationArrangement && report.tertiaryTerminationArrangement.length > 0 ? [{ desc: getTerminationDescription('Tertiary Termination', report.tertiaryTerminationArrangement), qty: 1 }] : []),
                    // Add other selected fittings (excluding termination entries)
                    ...(report.selectedFittings && report.selectedFittings.length > 0 ? report.selectedFittings
                      .filter(f => f !== 'HV Termination' && f !== 'LV Termination' && f !== 'LV1 Termination' && f !== 'LV2 Termination' && f !== 'MV Termination' && f !== 'Tertiary Termination')
                      .map(f => ({ desc: f, qty: report.fittingQuantities?.[f] || 1 })) 
                      : allStandardFittings.map(f => ({ desc: f, qty: report.fittingQuantities?.[f] || 1 }))),
                    // Add dynamic tap changer based on selected type
                    ...(report.tapChangerType ? [{ desc: getTapChangerText(report.tapChangerType), qty: 1 }] : []),
                    ...(report.additionalFittings || [])
                  ].map((item, idx) => (
                    <tr key={idx}>
                      <td className="border border-gray-300 p-2 text-center">{idx + 1}</td>
                      <td className="border border-gray-300 p-2">{item.desc}</td>
                      <td className="border border-gray-300 p-2 text-center">{item.qty}</td>
                    </tr>
                  ))}
                </tbody>
              </table>
              <div className="mt-4 flex justify-center print-button">
                <button
                  onClick={() => window.print()}
                  className="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-green-500"
                >
                  Print Report
                </button>
              </div>
            </div>

          
          )}
        </div>
      );
    }

    root.render(<App />);
  </script>
</body>
</html>
